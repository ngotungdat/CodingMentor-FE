{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\MonaMedia\\\\Project\\\\IELTS-NguyenHuyen-FE\\\\IELTS-Nguyen-Huyen\\\\src\\\\components\\\\Elements\\\\Editor\\\\Editor.tsx\";\nimport { BorderOutlined, PlusOutlined } from '@ant-design/icons';\nimport { Input, Modal } from 'antd';\nimport 'bootstrap/js/src/dropdown';\nimport 'bootstrap/js/src/modal';\nimport 'bootstrap/js/src/tooltip';\nimport React, { useEffect, useRef, useState } from 'react';\nimport ReactHtmlParser from 'react-html-parser';\nimport ReactSummernote from 'react-summernote';\nimport 'react-summernote/dist/react-summernote.css';\nimport { studentApi } from '~/apiBase';\nimport { useWrap } from '~/context/wrap';\n\nconst EditorSummernote = props => {\n  var _editorRef$current4;\n\n  const {\n    getDataEditor,\n    isReset,\n    questionContent,\n    addQuestion,\n    deleteSingleQuestion,\n    deleteAllQuestion,\n    questionData\n  } = props;\n  const {\n    showNoti\n  } = useWrap();\n  const editorRef = useRef(null);\n  const inputModalRef = useRef(null);\n  const {\n    0: valueEditor,\n    1: setValueEditor\n  } = useState(questionContent); // -- For translate --\n\n  const {\n    0: textSelect,\n    1: setTextSelect\n  } = useState(null);\n  const {\n    0: textTranslate,\n    1: setTextTranslate\n  } = useState(null);\n  const {\n    0: isModalVisible,\n    1: setIsModalVisible\n  } = useState(false);\n  const {\n    0: dataTranslate,\n    1: setDataTranslate\n  } = useState([]);\n  const {\n    0: isAddTranslate,\n    1: setIsAddTranslate\n  } = useState(false);\n  useEffect(() => {\n    if (questionData !== null && questionData !== void 0 && questionData.ExerciseList) {\n      getCurrentQuestion();\n    }\n  }, []); // ON CHANGE\n\n  const onChange = async content => {\n    var _editorRef$current, _editorRef$current$no;\n\n    let temp = await convertTextChange(content); // Cái bùa này ép editor nó nhận \"<\" với \">\"\n\n    const res = await formatText(temp); // Cái này để khi xóa câu hỏi hay thêm tào lao thì nó sắp xếp lại FICA\n    // Do Stuff:: Rewrite input index\n\n    let inputs = (_editorRef$current = editorRef.current) === null || _editorRef$current === void 0 ? void 0 : (_editorRef$current$no = _editorRef$current.noteEditable) === null || _editorRef$current$no === void 0 ? void 0 : _editorRef$current$no.find('input.space-editor');\n    Array.from(inputs).forEach((element, index) => {\n      element.setAttribute('placeholder', `(${index + 1})`);\n      element.setAttribute('id', `${index}`);\n    }); // Do Stuff:: maping input with External Question\n\n    let currentInputIDArray = Array.from(inputs).map(element => element.id);\n    let diffIDArray = Array.from(questionData === null || questionData === void 0 ? void 0 : questionData.ExerciseList).filter(item => !currentInputIDArray.includes(item.inputID.toString()));\n    diffIDArray.forEach(item => {\n      !!deleteSingleQuestion && deleteSingleQuestion(item.inputID);\n    }); // Do Stuff:: làm qq gi do chưa check\n\n    let tagRT = document.querySelectorAll('.note-editable ruby'); // let tagP = document.querySelectorAll('.note-editable p')\n\n    if (tagRT.length > 0) {\n      tagRT.forEach((item, index) => {\n        const hasNote = item.contains(item.querySelector('rt'));\n\n        if (!hasNote) {\n          item.replaceWith(...item.childNodes);\n        }\n      });\n    }\n\n    getDataEditor(res);\n  }; // Click thêm input\n\n\n  const handleAddSpace = () => {\n    var _editorRef$current2, _editorRef$current2$n;\n\n    // Do Stuff 1:: create Input ID\n    let inputs = (_editorRef$current2 = editorRef.current) === null || _editorRef$current2 === void 0 ? void 0 : (_editorRef$current2$n = _editorRef$current2.noteEditable) === null || _editorRef$current2$n === void 0 ? void 0 : _editorRef$current2$n.find('input.space-editor');\n    let inputID = inputs.length || 0; // Do Stuff 2:: create Input Element\n\n    const tempNode = document.createElement('input');\n    tempNode.setAttribute('id', inputID);\n    tempNode.classList.add('space-editor');\n    tempNode.setAttribute('placeholder', `(${inputID + 1})`); // Do Stuff final\n\n    editorRef.current.insertNode(tempNode);\n    addQuestion(inputID);\n  };\n\n  const getCurrentQuestion = () => {\n    let temp = [];\n\n    for (let i = 0; i < (questionData === null || questionData === void 0 ? void 0 : questionData.ExerciseList.length); i++) {\n      var _questionData$Exercis;\n\n      temp.push(parseInt(questionData === null || questionData === void 0 ? void 0 : (_questionData$Exercis = questionData.ExerciseList[i]) === null || _questionData$Exercis === void 0 ? void 0 : _questionData$Exercis.inputID));\n    }\n  }; // BY CHAU\n\n\n  const convertTextChange = e => {\n    let temp = e;\n    e.includes('&lt;') && (temp = temp.replace('&lt;', '<'));\n    e.includes('&gt;') && (temp = temp.replace('&gt;', '>'));\n    return temp;\n  }; // KHI MÀ \"valueEditor\" THAY ĐỔI THÌ CHẠY VÔ ĐÂY\n\n\n  const formatText = async e => {\n    let newText = '';\n    let current = 0; // <input id=\"0\" class=\"space-editor\" placeholder=\"(1)\">\n\n    for (let i = 0; i < e.length; i++) {\n      if (e[i - 1] == '\"' && e[i - 2] == '=' && e[i - 6] == 't' && e[i - 7] == 'u') {\n        // Nếu nó là cái \"input\"\n        newText = newText + current;\n        current++;\n      } else {\n        if (e[i - 1] == '(' && e[i - 2] == '\"' && e[i - 3] == '=' && e[i - 4] == 'r' && e[i - 5] == 'e') {\n          // Nếu nó là cái \"placeholder\"\n          newText = newText + current;\n        } else {\n          // Nếu nó không là gì hết\n          newText = newText + e[i];\n        }\n      }\n    }\n\n    return newText;\n  }; // UPLOAD IMAGES\n\n\n  const onImageUpload = async fileList => {\n    showNoti('warning', 'Đang tải hình ảnh lên..');\n\n    try {\n      let res = await studentApi.uploadImage(fileList[0]);\n      res.status == 200 && ReactSummernote.insertImage(res.data.data);\n    } catch (error) {\n      showNoti('danger', 'Không thể tải hình ảnh lên');\n    }\n  }; // Xóa tất cả câu hỏi\n\n\n  useEffect(() => {\n    var _editorRef$current3;\n\n    ((_editorRef$current3 = editorRef.current) === null || _editorRef$current3 === void 0 ? void 0 : _editorRef$current3.isEmpty()) && deleteAllQuestion();\n  }, [(_editorRef$current4 = editorRef.current) === null || _editorRef$current4 === void 0 ? void 0 : _editorRef$current4.isEmpty()]); // ------------------------------------------------------------------------------------------------------\n  // Phần dưới này dành cho cái phiên âm\n  // Fucking this for translate\n\n  const showModal = type => {\n    setIsModalVisible(true);\n    const {\n      noteEditable: currentContent,\n      editor: currentEditor\n    } = editorRef.current;\n    const selectionRange = currentEditor.summernote('createRange');\n    setTextSelect(selectionRange);\n    setTimeout(() => {\n      var _inputModalRef$curren;\n\n      (_inputModalRef$curren = inputModalRef.current) === null || _inputModalRef$curren === void 0 ? void 0 : _inputModalRef$curren.focus({\n        cursor: 'start'\n      });\n    }, 100);\n    type == 'add' ? setIsAddTranslate(true) : setIsAddTranslate(false);\n  };\n\n  const handleOk = () => {\n    isAddTranslate ? !!textSelect && handleAddTranslate() : handleFixTranslate();\n    setIsModalVisible(false);\n  };\n\n  const handleCancel = () => {\n    setIsModalVisible(false);\n    setTextSelect(null);\n    setTextTranslate(null);\n  };\n\n  const onChange_GetTranslateText = e => {\n    let text = e.target.value;\n    setTextTranslate(text);\n  };\n\n  const onKeyDownInput = e => {\n    if (e.key === 'Enter') {\n      handleAddTranslate();\n      setIsModalVisible(false);\n    }\n  }; // HANDLE FIX TRANSLATE\n\n\n  const handleFixTranslate = () => {\n    let elementNote = document.querySelectorAll('#editor-element .note-editable .text-note-of-translate');\n    elementNote.forEach((item, index) => {\n      let noteID = parseInt(item.getAttribute('data-note'));\n      let textItem = item.innerHTML;\n      let indexData = dataTranslate.findIndex(e => e.noteID === noteID);\n\n      if (dataTranslate[indexData].textTranslate !== textItem) {\n        item.innerHTML = dataTranslate[indexData].textTranslate;\n        item.setAttribute('title', dataTranslate[indexData].textTranslate);\n      }\n    });\n  }; // HANDLE ADD TRANSLATE\n\n\n  const handleAddTranslate = () => {\n    const {\n      noteEditable: currentContent,\n      editor: currentEditor\n    } = editorRef.current;\n\n    if (currentEditor.summernote('isEmpty') === false && !!textSelect.toString()) {\n      let noteID = null;\n\n      if (dataTranslate.length < 1) {\n        noteID = 0;\n      } else {\n        noteID = dataTranslate[dataTranslate.length - 1].noteID + 1;\n      }\n\n      textSelect.pasteHTML(`<ruby>${textSelect.toString()}<rt style=\"font-size: 70%;\">${textTranslate}</rt></ruby>`);\n      setTextSelect(null);\n      getDataEditor(currentContent.html());\n    }\n\n    setTextTranslate(null);\n    setTextSelect(null);\n  };\n\n  const onFixTextTranslate = (e, noteID) => {\n    var _dataTranslate$index, _dataTranslate$index2, _dataTranslate$index3, _dataTranslate$index4, _dataTranslate$index5, _dataTranslate$index6;\n\n    let text = e.target.value;\n    let index = dataTranslate.findIndex(item => item.noteID == noteID);\n    let oldText = `<input class=\"input-prevent-translate\"/><span title=\"${(_dataTranslate$index = dataTranslate[index]) === null || _dataTranslate$index === void 0 ? void 0 : _dataTranslate$index.textTranslate}\" class=\"text-normal-of-translate\">${(_dataTranslate$index2 = dataTranslate[index]) === null || _dataTranslate$index2 === void 0 ? void 0 : _dataTranslate$index2.textSelect}<span data-note=\"${(_dataTranslate$index3 = dataTranslate[index]) === null || _dataTranslate$index3 === void 0 ? void 0 : _dataTranslate$index3.noteID}\" class=\"text-note-of-translate\">${(_dataTranslate$index4 = dataTranslate[index]) === null || _dataTranslate$index4 === void 0 ? void 0 : _dataTranslate$index4.textTranslate}</span></span><input class=\"input-prevent-translate\"/>`;\n    let newText = `<input class=\"input-prevent-translate\"/><span title=\"${text}\" class=\"text-normal-of-translate\">${(_dataTranslate$index5 = dataTranslate[index]) === null || _dataTranslate$index5 === void 0 ? void 0 : _dataTranslate$index5.textSelect}<span data-note=\"${(_dataTranslate$index6 = dataTranslate[index]) === null || _dataTranslate$index6 === void 0 ? void 0 : _dataTranslate$index6.noteID}\" class=\"text-note-of-translate\">${text}</span></span><input class=\"input-prevent-translate\"/>`;\n    dataTranslate[index].textTranslate = text;\n\n    if (valueEditor.includes(oldText)) {\n      setValueEditor(valueEditor.replace(oldText, newText));\n      getDataEditor(valueEditor.replace(oldText, newText));\n    }\n\n    setDataTranslate([...dataTranslate]);\n  };\n\n  useEffect(() => {\n    let elementNote = document.querySelectorAll('#editor-element .note-editable .text-normal-of-translate');\n\n    if (elementNote.length > 0) {\n      elementNote.forEach(item => {\n        let noteID = item.lastChild.attributes[0].nodeValue;\n        let textSelect = item.firstChild.nodeValue;\n        let textTranslate = item.lastChild.childNodes[0].nodeValue;\n        dataTranslate.push({\n          noteID: parseInt(noteID),\n          textSelect: textSelect,\n          textTranslate: textTranslate\n        });\n      });\n      setDataTranslate([...dataTranslate]);\n    }\n  }, []); // RÊN ĐƠ\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Modal, {\n      title: \"Phi\\xEAn \\xE2m\",\n      visible: isModalVisible,\n      okText: \"L\\u01B0u\",\n      cancelText: \"H\\u1EE7y\",\n      onOk: handleOk,\n      onCancel: handleCancel,\n      children: isAddTranslate ? textSelect ? /*#__PURE__*/_jsxDEV(Input, {\n        ref: inputModalRef,\n        allowClear: true,\n        id: \"input-translate\",\n        className: \"style-input\",\n        value: textTranslate,\n        onChange: onChange_GetTranslateText,\n        onKeyDown: onKeyDownInput\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 7\n      }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          fontWeight: 500\n        },\n        children: \"Vui l\\xF2ng ch\\u1ECDn n\\u1ED9i dung c\\u1EA7n phi\\xEAn \\xE2m\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 7\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"detail-translate\",\n        children: /*#__PURE__*/_jsxDEV(\"table\", {\n          children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              className: \"text-center\",\n              children: \"N\\u1ED9i dung\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 260,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              className: \"text-center\",\n              children: \"Phi\\xEAn \\xE2m\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: dataTranslate.map((item, index) => /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: item.textSelect\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 266,\n                columnNumber: 11\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"text-center\",\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  className: \"show-text-translate\",\n                  type: \"text\",\n                  value: item.textTranslate,\n                  onChange: e => onFixTextTranslate(e, item.noteID),\n                  onKeyDown: e => {\n                    if (e.key === 'Enter') {\n                      handleFixTranslate();\n                      setIsModalVisible(false);\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 268,\n                  columnNumber: 12\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 267,\n                columnNumber: 11\n              }, this)]\n            }, index, true, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 10\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 8\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 7\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 6\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wrap-editor custom\",\n      id: \"editor-element\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex align-items-center mb-2\",\n        style: {\n          display: 'flex',\n          flexDirection: 'row',\n          width: '100%',\n          justifyContent: 'flex-end'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-editor d-flex align-items-center mr-2\",\n          onClick: () => showModal('add'),\n          children: [/*#__PURE__*/_jsxDEV(PlusOutlined, {\n            className: \"mr-2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 7\n          }, this), \" Th\\xEAm Phi\\xEAn \\xE2m\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-editor d-flex align-items-center\",\n          onClick: handleAddSpace,\n          children: [/*#__PURE__*/_jsxDEV(BorderOutlined, {\n            className: \"mr-2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 7\n          }, this), \" Th\\xEAm input\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(ReactSummernote, {\n        class: \"summernote\",\n        ref: editorRef,\n        value: valueEditor,\n        children: ReactHtmlParser(valueEditor),\n        options: {\n          lang: 'vn',\n          height: 500,\n          dialogsInBody: true,\n          toolbar: [['style', ['style']], ['font', ['bold', 'underline', 'clear']], ['fontname', ['fontname']], ['para', ['ul', 'ol', 'paragraph']], ['table', ['table']], ['insert', ['link', 'picture', 'video']], ['view', ['fullscreen', 'codeview']]]\n        },\n        onChange: e => onChange(e),\n        onImageUpload: onImageUpload\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true);\n};\n\nexport default EditorSummernote;","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/components/Elements/Editor/Editor.tsx"],"names":["BorderOutlined","PlusOutlined","Input","Modal","React","useEffect","useRef","useState","ReactHtmlParser","ReactSummernote","studentApi","useWrap","EditorSummernote","props","getDataEditor","isReset","questionContent","addQuestion","deleteSingleQuestion","deleteAllQuestion","questionData","showNoti","editorRef","inputModalRef","valueEditor","setValueEditor","textSelect","setTextSelect","textTranslate","setTextTranslate","isModalVisible","setIsModalVisible","dataTranslate","setDataTranslate","isAddTranslate","setIsAddTranslate","ExerciseList","getCurrentQuestion","onChange","content","temp","convertTextChange","res","formatText","inputs","current","noteEditable","find","Array","from","forEach","element","index","setAttribute","currentInputIDArray","map","id","diffIDArray","filter","item","includes","inputID","toString","tagRT","document","querySelectorAll","length","hasNote","contains","querySelector","replaceWith","childNodes","handleAddSpace","tempNode","createElement","classList","add","insertNode","i","push","parseInt","e","replace","newText","onImageUpload","fileList","uploadImage","status","insertImage","data","error","isEmpty","showModal","type","currentContent","editor","currentEditor","selectionRange","summernote","setTimeout","focus","cursor","handleOk","handleAddTranslate","handleFixTranslate","handleCancel","onChange_GetTranslateText","text","target","value","onKeyDownInput","key","elementNote","noteID","getAttribute","textItem","innerHTML","indexData","findIndex","pasteHTML","html","onFixTextTranslate","oldText","lastChild","attributes","nodeValue","firstChild","fontWeight","display","flexDirection","width","justifyContent","lang","height","dialogsInBody","toolbar"],"mappings":"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","sourcesContent":["import { BorderOutlined, EditOutlined, PlusOutlined } from '@ant-design/icons'\r\nimport { Input, Modal } from 'antd'\r\nimport 'bootstrap/js/src/dropdown'\r\nimport 'bootstrap/js/src/modal'\r\nimport 'bootstrap/js/src/tooltip'\r\nimport React, { useEffect, useRef, useState } from 'react'\r\nimport ReactHtmlParser from 'react-html-parser'\r\nimport ReactSummernote from 'react-summernote'\r\nimport 'react-summernote/dist/react-summernote.css'\r\nimport { studentApi } from '~/apiBase'\r\nimport { useWrap } from '~/context/wrap'\r\n\r\ntype dataTranslate = Array<{\r\n\tnoteID: number\r\n\ttextSelect: string\r\n\ttextTranslate: string\r\n}>\r\n\r\nconst EditorSummernote = (props) => {\r\n\tconst { getDataEditor, isReset, questionContent, addQuestion, deleteSingleQuestion, deleteAllQuestion, questionData } = props\r\n\tconst { showNoti } = useWrap()\r\n\tconst editorRef = useRef<any>(null)\r\n\tconst inputModalRef = useRef<any>(null)\r\n\tconst [valueEditor, setValueEditor] = useState<any>(questionContent)\r\n\t// -- For translate --\r\n\tconst [textSelect, setTextSelect] = useState<any>(null)\r\n\tconst [textTranslate, setTextTranslate] = useState<any>(null)\r\n\tconst [isModalVisible, setIsModalVisible] = useState<boolean>(false)\r\n\tconst [dataTranslate, setDataTranslate] = useState<dataTranslate>([])\r\n\tconst [isAddTranslate, setIsAddTranslate] = useState<boolean>(false)\r\n\r\n\tuseEffect(() => {\r\n\t\tif (questionData?.ExerciseList) {\r\n\t\t\tgetCurrentQuestion()\r\n\t\t}\r\n\t}, [])\r\n\r\n\t// ON CHANGE\r\n\tconst onChange = async (content: any) => {\r\n\t\tlet temp: string = await convertTextChange(content) // Cái bùa này ép editor nó nhận \"<\" với \">\"\r\n\t\tconst res: any = await formatText(temp) // Cái này để khi xóa câu hỏi hay thêm tào lao thì nó sắp xếp lại FICA\r\n\t\t// Do Stuff:: Rewrite input index\r\n\t\tlet inputs = editorRef.current?.noteEditable?.find('input.space-editor')\r\n\t\tArray.from(inputs).forEach((element: HTMLElement, index: number) => {\r\n\t\t\telement.setAttribute('placeholder', `(${index + 1})`)\r\n\t\t\telement.setAttribute('id', `${index}`)\r\n\t\t})\r\n\t\t// Do Stuff:: maping input with External Question\r\n\t\tlet currentInputIDArray = Array.from(inputs).map((element: HTMLElement) => element.id)\r\n\t\tlet diffIDArray = Array.from(questionData?.ExerciseList).filter((item: any) => !currentInputIDArray.includes(item.inputID.toString()))\r\n\t\tdiffIDArray.forEach((item: any) => {\r\n\t\t\t!!deleteSingleQuestion && deleteSingleQuestion(item.inputID)\r\n\t\t})\r\n\t\t// Do Stuff:: làm qq gi do chưa check\r\n\t\tlet tagRT = document.querySelectorAll('.note-editable ruby')\r\n\t\t// let tagP = document.querySelectorAll('.note-editable p')\r\n\t\tif (tagRT.length > 0) {\r\n\t\t\ttagRT.forEach((item: any, index) => {\r\n\t\t\t\tconst hasNote = item.contains(item.querySelector('rt'))\r\n\t\t\t\tif (!hasNote) {\r\n\t\t\t\t\titem.replaceWith(...item.childNodes)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\tgetDataEditor(res)\r\n\t}\r\n\r\n\t// Click thêm input\r\n\tconst handleAddSpace = () => {\r\n\t\t// Do Stuff 1:: create Input ID\r\n\t\tlet inputs = editorRef.current?.noteEditable?.find('input.space-editor')\r\n\t\tlet inputID: any = inputs.length || 0\r\n\t\t// Do Stuff 2:: create Input Element\r\n\t\tconst tempNode = document.createElement('input')\r\n\t\ttempNode.setAttribute('id', inputID)\r\n\t\ttempNode.classList.add('space-editor')\r\n\t\ttempNode.setAttribute('placeholder', `(${inputID + 1})`)\r\n\t\t// Do Stuff final\r\n\t\teditorRef.current.insertNode(tempNode)\r\n\t\taddQuestion(inputID)\r\n\t}\r\n\r\n\tconst getCurrentQuestion = () => {\r\n\t\tlet temp: any = []\r\n\t\tfor (let i = 0; i < questionData?.ExerciseList.length; i++) {\r\n\t\t\ttemp.push(parseInt(questionData?.ExerciseList[i]?.inputID))\r\n\t\t}\r\n\t}\r\n\r\n\t// BY CHAU\r\n\tconst convertTextChange = (e: string) => {\r\n\t\tlet temp: string = e\r\n\t\te.includes('&lt;') && (temp = temp.replace('&lt;', '<'))\r\n\t\te.includes('&gt;') && (temp = temp.replace('&gt;', '>'))\r\n\t\treturn temp\r\n\t}\r\n\r\n\t// KHI MÀ \"valueEditor\" THAY ĐỔI THÌ CHẠY VÔ ĐÂY\r\n\tconst formatText = async (e: any) => {\r\n\t\tlet newText: any = ''\r\n\t\tlet current: number = 0\r\n\t\t// <input id=\"0\" class=\"space-editor\" placeholder=\"(1)\">\r\n\t\tfor (let i = 0; i < e.length; i++) {\r\n\t\t\tif (e[i - 1] == '\"' && e[i - 2] == '=' && e[i - 6] == 't' && e[i - 7] == 'u') {\r\n\t\t\t\t// Nếu nó là cái \"input\"\r\n\t\t\t\tnewText = newText + current\r\n\t\t\t\tcurrent++\r\n\t\t\t} else {\r\n\t\t\t\tif (e[i - 1] == '(' && e[i - 2] == '\"' && e[i - 3] == '=' && e[i - 4] == 'r' && e[i - 5] == 'e') {\r\n\t\t\t\t\t// Nếu nó là cái \"placeholder\"\r\n\t\t\t\t\tnewText = newText + current\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Nếu nó không là gì hết\r\n\t\t\t\t\tnewText = newText + e[i]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn newText\r\n\t}\r\n\r\n\t// UPLOAD IMAGES\r\n\tconst onImageUpload = async (fileList: any) => {\r\n\t\tshowNoti('warning', 'Đang tải hình ảnh lên..')\r\n\t\ttry {\r\n\t\t\tlet res: any = await studentApi.uploadImage(fileList[0])\r\n\t\t\tres.status == 200 && ReactSummernote.insertImage(res.data.data)\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', 'Không thể tải hình ảnh lên')\r\n\t\t}\r\n\t}\r\n\r\n\t// Xóa tất cả câu hỏi\r\n\tuseEffect(() => {\r\n\t\teditorRef.current?.isEmpty() && deleteAllQuestion()\r\n\t}, [editorRef.current?.isEmpty()])\r\n\r\n\t// ------------------------------------------------------------------------------------------------------\r\n\t// Phần dưới này dành cho cái phiên âm\r\n\t// Fucking this for translate\r\n\tconst showModal = (type: any) => {\r\n\t\tsetIsModalVisible(true)\r\n\t\tconst { noteEditable: currentContent, editor: currentEditor } = editorRef.current\r\n\t\tconst selectionRange = currentEditor.summernote('createRange')\r\n\t\tsetTextSelect(selectionRange)\r\n\t\tsetTimeout(() => {\r\n\t\t\tinputModalRef.current?.focus({\r\n\t\t\t\tcursor: 'start'\r\n\t\t\t})\r\n\t\t}, 100)\r\n\t\ttype == 'add' ? setIsAddTranslate(true) : setIsAddTranslate(false)\r\n\t}\r\n\r\n\tconst handleOk = () => {\r\n\t\tisAddTranslate ? !!textSelect && handleAddTranslate() : handleFixTranslate()\r\n\t\tsetIsModalVisible(false)\r\n\t}\r\n\r\n\tconst handleCancel = () => {\r\n\t\tsetIsModalVisible(false)\r\n\t\tsetTextSelect(null)\r\n\t\tsetTextTranslate(null)\r\n\t}\r\n\r\n\tconst onChange_GetTranslateText = (e: any) => {\r\n\t\tlet text: string = e.target.value\r\n\t\tsetTextTranslate(text)\r\n\t}\r\n\r\n\tconst onKeyDownInput = (e: any) => {\r\n\t\tif (e.key === 'Enter') {\r\n\t\t\thandleAddTranslate()\r\n\t\t\tsetIsModalVisible(false)\r\n\t\t}\r\n\t}\r\n\r\n\t// HANDLE FIX TRANSLATE\r\n\tconst handleFixTranslate = () => {\r\n\t\tlet elementNote: any = document.querySelectorAll('#editor-element .note-editable .text-note-of-translate')\r\n\t\telementNote.forEach((item: any, index: any) => {\r\n\t\t\tlet noteID: number = parseInt(item.getAttribute('data-note'))\r\n\t\t\tlet textItem: any = item.innerHTML\r\n\t\t\tlet indexData: number = dataTranslate.findIndex((e: any) => e.noteID === noteID)\r\n\t\t\tif (dataTranslate[indexData].textTranslate !== textItem) {\r\n\t\t\t\titem.innerHTML = dataTranslate[indexData].textTranslate\r\n\t\t\t\titem.setAttribute('title', dataTranslate[indexData].textTranslate)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t// HANDLE ADD TRANSLATE\r\n\tconst handleAddTranslate = () => {\r\n\t\tconst { noteEditable: currentContent, editor: currentEditor } = editorRef.current\r\n\t\tif (currentEditor.summernote('isEmpty') === false && !!textSelect.toString()) {\r\n\t\t\tlet noteID: any = null\r\n\t\t\tif (dataTranslate.length < 1) {\r\n\t\t\t\tnoteID = 0\r\n\t\t\t} else {\r\n\t\t\t\tnoteID = dataTranslate[dataTranslate.length - 1].noteID + 1\r\n\t\t\t}\r\n\t\t\ttextSelect.pasteHTML(`<ruby>${textSelect.toString()}<rt style=\"font-size: 70%;\">${textTranslate}</rt></ruby>`)\r\n\t\t\tsetTextSelect(null)\r\n\t\t\tgetDataEditor(currentContent.html())\r\n\t\t}\r\n\t\tsetTextTranslate(null)\r\n\t\tsetTextSelect(null)\r\n\t}\r\n\r\n\tconst onFixTextTranslate = (e: any, noteID: any) => {\r\n\t\tlet text: any = e.target.value\r\n\t\tlet index: any = dataTranslate.findIndex((item: any) => item.noteID == noteID)\r\n\t\tlet oldText: string = `<input class=\"input-prevent-translate\"/><span title=\"${dataTranslate[index]?.textTranslate}\" class=\"text-normal-of-translate\">${dataTranslate[index]?.textSelect}<span data-note=\"${dataTranslate[index]?.noteID}\" class=\"text-note-of-translate\">${dataTranslate[index]?.textTranslate}</span></span><input class=\"input-prevent-translate\"/>`\r\n\t\tlet newText: string = `<input class=\"input-prevent-translate\"/><span title=\"${text}\" class=\"text-normal-of-translate\">${dataTranslate[index]?.textSelect}<span data-note=\"${dataTranslate[index]?.noteID}\" class=\"text-note-of-translate\">${text}</span></span><input class=\"input-prevent-translate\"/>`\r\n\t\tdataTranslate[index].textTranslate = text\r\n\t\tif (valueEditor.includes(oldText)) {\r\n\t\t\tsetValueEditor(valueEditor.replace(oldText, newText))\r\n\t\t\tgetDataEditor(valueEditor.replace(oldText, newText))\r\n\t\t}\r\n\t\tsetDataTranslate([...dataTranslate])\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tlet elementNote: any = document.querySelectorAll('#editor-element .note-editable .text-normal-of-translate')\r\n\t\tif (elementNote.length > 0) {\r\n\t\t\telementNote.forEach((item: any) => {\r\n\t\t\t\tlet noteID: any = item.lastChild.attributes[0].nodeValue\r\n\t\t\t\tlet textSelect: any = item.firstChild.nodeValue\r\n\t\t\t\tlet textTranslate: any = item.lastChild.childNodes[0].nodeValue\r\n\t\t\t\tdataTranslate.push({\r\n\t\t\t\t\tnoteID: parseInt(noteID),\r\n\t\t\t\t\ttextSelect: textSelect,\r\n\t\t\t\t\ttextTranslate: textTranslate\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\tsetDataTranslate([...dataTranslate])\r\n\t\t}\r\n\t}, [])\r\n\r\n\t// RÊN ĐƠ\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<Modal title=\"Phiên âm\" visible={isModalVisible} okText=\"Lưu\" cancelText=\"Hủy\" onOk={handleOk} onCancel={handleCancel}>\r\n\t\t\t\t{isAddTranslate ? (\r\n\t\t\t\t\ttextSelect ? (\r\n\t\t\t\t\t\t<Input\r\n\t\t\t\t\t\t\tref={inputModalRef}\r\n\t\t\t\t\t\t\tallowClear\r\n\t\t\t\t\t\t\tid=\"input-translate\"\r\n\t\t\t\t\t\t\tclassName=\"style-input\"\r\n\t\t\t\t\t\t\tvalue={textTranslate}\r\n\t\t\t\t\t\t\tonChange={onChange_GetTranslateText}\r\n\t\t\t\t\t\t\tonKeyDown={onKeyDownInput}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<p style={{ fontWeight: 500 }}>Vui lòng chọn nội dung cần phiên âm</p>\r\n\t\t\t\t\t)\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<div className=\"detail-translate\">\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t<th className=\"text-center\">Nội dung</th>\r\n\t\t\t\t\t\t\t\t<th className=\"text-center\">Phiên âm</th>\r\n\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t{dataTranslate.map((item, index) => (\r\n\t\t\t\t\t\t\t\t\t<tr key={index}>\r\n\t\t\t\t\t\t\t\t\t\t<td>{item.textSelect}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td className=\"text-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"show-text-translate\"\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={item.textTranslate}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => onFixTextTranslate(e, item.noteID)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonKeyDown={(e) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Enter') {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleFixTranslate()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsModalVisible(false)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t</Modal>\r\n\r\n\t\t\t<div className=\"wrap-editor custom\" id=\"editor-element\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"d-flex align-items-center mb-2\"\r\n\t\t\t\t\tstyle={{ display: 'flex', flexDirection: 'row', width: '100%', justifyContent: 'flex-end' }}\r\n\t\t\t\t>\r\n\t\t\t\t\t<button className=\"btn-editor d-flex align-items-center mr-2\" onClick={() => showModal('add')}>\r\n\t\t\t\t\t\t<PlusOutlined className=\"mr-2\" /> Thêm Phiên âm\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t{/* <button className=\"btn-editor fix-translate d-flex align-items-center mr-2\" onClick={() => showModal('fix')}>\r\n\t\t\t\t\t\t<EditOutlined className=\"mr-2\" /> Sửa phiên âm\r\n\t\t\t\t\t</button> */}\r\n\t\t\t\t\t<button className=\"btn-editor d-flex align-items-center\" onClick={handleAddSpace}>\r\n\t\t\t\t\t\t<BorderOutlined className=\"mr-2\" /> Thêm input\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<ReactSummernote\r\n\t\t\t\t\tclass=\"summernote\"\r\n\t\t\t\t\tref={editorRef}\r\n\t\t\t\t\tvalue={valueEditor}\r\n\t\t\t\t\tchildren={ReactHtmlParser(valueEditor)}\r\n\t\t\t\t\toptions={{\r\n\t\t\t\t\t\tlang: 'vn',\r\n\t\t\t\t\t\theight: 500,\r\n\t\t\t\t\t\tdialogsInBody: true,\r\n\t\t\t\t\t\ttoolbar: [\r\n\t\t\t\t\t\t\t['style', ['style']],\r\n\t\t\t\t\t\t\t['font', ['bold', 'underline', 'clear']],\r\n\t\t\t\t\t\t\t['fontname', ['fontname']],\r\n\t\t\t\t\t\t\t['para', ['ul', 'ol', 'paragraph']],\r\n\t\t\t\t\t\t\t['table', ['table']],\r\n\t\t\t\t\t\t\t['insert', ['link', 'picture', 'video']],\r\n\t\t\t\t\t\t\t['view', ['fullscreen', 'codeview']]\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tonChange={(e: string) => onChange(e)}\r\n\t\t\t\t\tonImageUpload={onImageUpload}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t)\r\n}\r\n\r\nexport default EditorSummernote\r\n"]},"metadata":{},"sourceType":"module"}