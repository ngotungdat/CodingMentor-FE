{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _toConsumableArray from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"D:\\\\MonaMedia\\\\Project\\\\IELTS-NguyenHuyen-FE\\\\IELTS-Nguyen-Huyen\\\\src\\\\components\\\\Global\\\\CourseList\\\\CourseListDetail\\\\CourseDetailCalendar\\\\CourseDetailCalendar.tsx\",\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport moment from 'moment';\nimport PropTypes from 'prop-types';\nimport React, { useEffect, useState } from 'react';\nimport 'react-big-calendar/lib/css/react-big-calendar.css';\nimport { courseDetailApi, documentScheduleApi } from '~/apiBase';\nimport TitlePage from '~/components/TitlePage';\nimport { useWrap } from '~/context/wrap';\nimport CDCalendar from './Calendar';\nCourseDetailCalendar.propTypes = {\n  courseID: PropTypes.number,\n  isAdmin: PropTypes.bool\n};\nCourseDetailCalendar.defaultProps = {\n  courseID: 0,\n  isAdmin: false\n};\n\nfunction CourseDetailCalendar(props) {\n  _s();\n\n  var ID = props.courseID,\n      isAdmin = props.isAdmin;\n\n  var _useWrap = useWrap(),\n      showNoti = _useWrap.showNoti;\n\n  var _useState = useState([]),\n      calendarList = _useState[0],\n      setCalendarList = _useState[1];\n\n  var _useState2 = useState(false),\n      isLoaded = _useState2[0],\n      setIsLoaded = _useState2[1];\n\n  var _useState3 = useState({\n    type: '',\n    status: false\n  }),\n      isLoading = _useState3[0],\n      setIsLoading = _useState3[1]; // -----------CALENDAR-----------\n\n\n  var calendarDateFormat = function calendarDateFormat(calendarArr) {\n    var rs = calendarArr.map(function (c, idx) {\n      var ID = c.ID,\n          CourseID = c.CourseID,\n          CourseName = c.CourseName,\n          RoomName = c.RoomName,\n          BranchName = c.BranchName,\n          TeacherName = c.TeacherName,\n          SubjectName = c.SubjectName,\n          StartTime = c.StartTime,\n          EndTime = c.EndTime,\n          LinkDocument = c.LinkDocument,\n          TeacherAttendanceID = c.TeacherAttendanceID,\n          IsExam = c.IsExam;\n      var studyTimeStart = moment(StartTime).format('HH:mm');\n      var studyTimeEnd = moment(EndTime).format('HH:mm');\n      var studyTime = \"\".concat(studyTimeStart, \" - \").concat(studyTimeEnd);\n      return {\n        id: +ID,\n        title: '',\n        start: moment(StartTime).toDate(),\n        end: moment(EndTime).toDate(),\n        TeacherAttendanceID: TeacherAttendanceID,\n        resource: {\n          ID: ID,\n          CourseID: CourseID,\n          RoomName: RoomName,\n          BranchName: BranchName,\n          TeacherName: TeacherName,\n          SubjectName: SubjectName,\n          LinkDocument: LinkDocument,\n          StudyTimeName: studyTime,\n          IsExam: IsExam,\n          TeacherAttendanceID: TeacherAttendanceID\n        }\n      };\n    });\n    return rs;\n  };\n\n  var fetchCalendarList = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              setIsLoading({\n                type: 'FETCH_COURSE_DETAIL_CALENDAR',\n                status: true\n              });\n              _context.next = 4;\n              return courseDetailApi.getAll({\n                CourseID: ID\n              });\n\n            case 4:\n              res = _context.sent;\n\n              if (res.status === 200) {\n                setCalendarList(res.data.data);\n                setIsLoaded(true);\n              }\n\n              if (res.status === 204) {\n                showNoti('danger', 'Danh sách trống');\n              }\n\n              _context.next = 12;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](0);\n              showNoti('error', _context.t0.message);\n\n            case 12:\n              _context.prev = 12;\n              setIsLoading({\n                type: 'FETCH_COURSE_DETAIL_CALENDAR',\n                status: false\n              });\n              return _context.finish(12);\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 9, 12, 15]]);\n    }));\n\n    return function fetchCalendarList() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    fetchCalendarList();\n  }, []);\n\n  var onUploadDocument = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data) {\n      var formData, newData, res, newCalendarList, idx;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setIsLoading({\n                type: 'ADD_DATA',\n                status: true\n              });\n              _context2.prev = 1;\n              formData = new FormData();\n              newData = _objectSpread(_objectSpread({}, data), {}, {\n                File: data.File[0].originFileObj\n              });\n              Object.keys(newData).forEach(function (key) {\n                return formData.append(key, newData[key]);\n              });\n              _context2.next = 7;\n              return documentScheduleApi.add(formData);\n\n            case 7:\n              res = _context2.sent;\n\n              if (res.status === 200) {\n                newCalendarList = _toConsumableArray(calendarList);\n                idx = newCalendarList.findIndex(function (c) {\n                  return c.ID === newData.CourseScheduleID;\n                });\n                newCalendarList.splice(idx, 1, _objectSpread(_objectSpread({}, newCalendarList[idx]), {}, {\n                  LinkDocument: res.data.data.LinkDocument\n                }));\n                setCalendarList(newCalendarList);\n                showNoti('success', res.data.message);\n              }\n\n              return _context2.abrupt(\"return\", res);\n\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2[\"catch\"](1);\n              showNoti('danger', _context2.t0.message);\n\n            case 15:\n              _context2.prev = 15;\n              setIsLoading({\n                type: 'ADD_DATA',\n                status: false\n              });\n              return _context2.finish(15);\n\n            case 18:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 12, 15, 18]]);\n    }));\n\n    return function onUploadDocument(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(TitlePage, {\n      title: \"Chi ti\\u1EBFt kh\\xF3a h\\u1ECDc\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"hide-rbc-event\",\n      children: isAdmin ? /*#__PURE__*/_jsxDEV(CDCalendar, {\n        isLoading: isLoading,\n        isGetRecordList: true,\n        isUploadDocument: true,\n        isLoaded: isLoading.type === 'FETCH_COURSE_DETAIL_CALENDAR' && isLoading.status ? false : true,\n        eventList: calendarDateFormat(calendarList),\n        handleUploadDocument: onUploadDocument\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 6\n      }, this) : /*#__PURE__*/_jsxDEV(CDCalendar, {\n        isLoading: isLoading,\n        isLoaded: isLoading.type === 'FETCH_COURSE_DETAIL_CALENDAR' && isLoading.status ? false : true,\n        eventList: calendarDateFormat(calendarList)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 6\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true);\n}\n\n_s(CourseDetailCalendar, \"zzZyYrQDg/y8zApmU1e05OJ4Yfo=\", false, function () {\n  return [useWrap];\n});\n\n_c = CourseDetailCalendar;\nexport default CourseDetailCalendar;\n\nvar _c;\n\n$RefreshReg$(_c, \"CourseDetailCalendar\");","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/components/Global/CourseList/CourseListDetail/CourseDetailCalendar/CourseDetailCalendar.tsx"],"names":["moment","PropTypes","React","useEffect","useState","courseDetailApi","documentScheduleApi","TitlePage","useWrap","CDCalendar","CourseDetailCalendar","propTypes","courseID","number","isAdmin","bool","defaultProps","props","ID","showNoti","calendarList","setCalendarList","isLoaded","setIsLoaded","type","status","isLoading","setIsLoading","calendarDateFormat","calendarArr","rs","map","c","idx","CourseID","CourseName","RoomName","BranchName","TeacherName","SubjectName","StartTime","EndTime","LinkDocument","TeacherAttendanceID","IsExam","studyTimeStart","format","studyTimeEnd","studyTime","id","title","start","toDate","end","resource","StudyTimeName","fetchCalendarList","getAll","res","data","message","onUploadDocument","formData","FormData","newData","File","originFileObj","Object","keys","forEach","key","append","add","newCalendarList","findIndex","CourseScheduleID","splice"],"mappings":"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","sourcesContent":["import moment from 'moment';\r\nimport PropTypes from 'prop-types';\r\nimport React, { useEffect, useState } from 'react';\r\nimport 'react-big-calendar/lib/css/react-big-calendar.css';\r\nimport { courseDetailApi, documentScheduleApi } from '~/apiBase';\r\nimport TitlePage from '~/components/TitlePage';\r\nimport { useWrap } from '~/context/wrap';\r\nimport CDCalendar from './Calendar';\r\n\r\nCourseDetailCalendar.propTypes = {\r\n\tcourseID: PropTypes.number,\r\n\tisAdmin: PropTypes.bool\r\n};\r\nCourseDetailCalendar.defaultProps = {\r\n\tcourseID: 0,\r\n\tisAdmin: false\r\n};\r\n\r\nfunction CourseDetailCalendar(props) {\r\n\tconst { courseID: ID, isAdmin } = props;\r\n\tconst { showNoti } = useWrap();\r\n\tconst [calendarList, setCalendarList] = useState<ICourseDetailSchedule[]>([]);\r\n\tconst [isLoaded, setIsLoaded] = useState(false);\r\n\tconst [isLoading, setIsLoading] = useState({\r\n\t\ttype: '',\r\n\t\tstatus: false\r\n\t});\r\n\t// -----------CALENDAR-----------\r\n\tconst calendarDateFormat = (calendarArr: ICourseDetailSchedule[]) => {\r\n\t\tconst rs = calendarArr.map((c, idx) => {\r\n\t\t\tconst {\r\n\t\t\t\tID,\r\n\t\t\t\tCourseID,\r\n\t\t\t\tCourseName,\r\n\t\t\t\tRoomName,\r\n\t\t\t\tBranchName,\r\n\t\t\t\tTeacherName,\r\n\t\t\t\tSubjectName,\r\n\t\t\t\tStartTime,\r\n\t\t\t\tEndTime,\r\n\t\t\t\tLinkDocument,\r\n\t\t\t\tTeacherAttendanceID,\r\n\t\t\t\tIsExam\r\n\t\t\t} = c;\r\n\t\t\tconst studyTimeStart = moment(StartTime).format('HH:mm');\r\n\t\t\tconst studyTimeEnd = moment(EndTime).format('HH:mm');\r\n\t\t\tconst studyTime = `${studyTimeStart} - ${studyTimeEnd}`;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tid: +ID,\r\n\t\t\t\ttitle: '',\r\n\t\t\t\tstart: moment(StartTime).toDate(),\r\n\t\t\t\tend: moment(EndTime).toDate(),\r\n\t\t\t\tTeacherAttendanceID,\r\n\t\t\t\tresource: {\r\n\t\t\t\t\tID,\r\n\t\t\t\t\tCourseID,\r\n\t\t\t\t\tRoomName,\r\n\t\t\t\t\tBranchName,\r\n\t\t\t\t\tTeacherName,\r\n\t\t\t\t\tSubjectName,\r\n\t\t\t\t\tLinkDocument,\r\n\t\t\t\t\tStudyTimeName: studyTime,\r\n\t\t\t\t\tIsExam,\r\n\t\t\t\t\tTeacherAttendanceID\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn rs;\r\n\t};\r\n\tconst fetchCalendarList = async () => {\r\n\t\ttry {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'FETCH_COURSE_DETAIL_CALENDAR',\r\n\t\t\t\tstatus: true\r\n\t\t\t});\r\n\t\t\tconst res = await courseDetailApi.getAll({ CourseID: ID });\r\n\t\t\tif (res.status === 200) {\r\n\t\t\t\tsetCalendarList(res.data.data);\r\n\t\t\t\tsetIsLoaded(true);\r\n\t\t\t}\r\n\t\t\tif (res.status === 204) {\r\n\t\t\t\tshowNoti('danger', 'Danh sách trống');\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('error', error.message);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'FETCH_COURSE_DETAIL_CALENDAR',\r\n\t\t\t\tstatus: false\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tfetchCalendarList();\r\n\t}, []);\r\n\r\n\tconst onUploadDocument = async (data: { CourseScheduleID: number; File: Array<any> }) => {\r\n\t\tsetIsLoading({\r\n\t\t\ttype: 'ADD_DATA',\r\n\t\t\tstatus: true\r\n\t\t});\r\n\t\ttry {\r\n\t\t\tconst formData = new FormData();\r\n\t\t\tconst newData = {\r\n\t\t\t\t...data,\r\n\t\t\t\tFile: data.File[0].originFileObj\r\n\t\t\t};\r\n\t\t\tObject.keys(newData).forEach((key) => formData.append(key, newData[key]));\r\n\t\t\tconst res = await documentScheduleApi.add(formData);\r\n\t\t\tif (res.status === 200) {\r\n\t\t\t\tconst newCalendarList = [...calendarList];\r\n\t\t\t\tconst idx = newCalendarList.findIndex((c) => c.ID === newData.CourseScheduleID);\r\n\t\t\t\tnewCalendarList.splice(idx, 1, {\r\n\t\t\t\t\t...newCalendarList[idx],\r\n\t\t\t\t\tLinkDocument: res.data.data.LinkDocument\r\n\t\t\t\t});\r\n\t\t\t\tsetCalendarList(newCalendarList);\r\n\t\t\t\tshowNoti('success', res.data.message);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error.message);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'ADD_DATA',\r\n\t\t\t\tstatus: false\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<TitlePage title=\"Chi tiết khóa học\" />\r\n\r\n\t\t\t<div className=\"hide-rbc-event\">\r\n\t\t\t\t{isAdmin ? (\r\n\t\t\t\t\t<CDCalendar\r\n\t\t\t\t\t\tisLoading={isLoading}\r\n\t\t\t\t\t\tisGetRecordList={true}\r\n\t\t\t\t\t\tisUploadDocument={true}\r\n\t\t\t\t\t\tisLoaded={isLoading.type === 'FETCH_COURSE_DETAIL_CALENDAR' && isLoading.status ? false : true}\r\n\t\t\t\t\t\teventList={calendarDateFormat(calendarList)}\r\n\t\t\t\t\t\thandleUploadDocument={onUploadDocument}\r\n\t\t\t\t\t/>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<CDCalendar\r\n\t\t\t\t\t\tisLoading={isLoading}\r\n\t\t\t\t\t\tisLoaded={isLoading.type === 'FETCH_COURSE_DETAIL_CALENDAR' && isLoading.status ? false : true}\r\n\t\t\t\t\t\teventList={calendarDateFormat(calendarList)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\nexport default CourseDetailCalendar;\r\n"]},"metadata":{},"sourceType":"module"}