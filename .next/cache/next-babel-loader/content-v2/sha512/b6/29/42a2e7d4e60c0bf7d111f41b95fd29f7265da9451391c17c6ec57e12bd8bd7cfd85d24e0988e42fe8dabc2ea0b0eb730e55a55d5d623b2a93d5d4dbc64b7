{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\MonaMedia\\\\Project\\\\IELTS-NguyenHuyen-FE\\\\IELTS-Nguyen-Huyen\\\\src\\\\components\\\\Global\\\\Package\\\\PackageDetail\\\\PackageDetail.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Tooltip } from 'antd';\nimport Link from 'next/link';\nimport { useRouter } from 'next/router';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { Eye } from 'react-feather';\nimport { examTopicApi, packageApi } from '~/apiBase';\nimport { packageDetailApi } from '~/apiBase/package/package-detail';\nimport DeleteTableRow from '~/components/Elements/DeleteTableRow/DeleteTableRow';\nimport PowerTable from '~/components/PowerTable';\nimport { useWrap } from '~/context/wrap';\nimport { fmSelectArr } from '~/utils/functions';\nimport PackageDetailForm from './PackageDetailForm/PackageDetailForm';\n\nconst PackageDetail = () => {\n  const router = useRouter();\n  const {\n    slug: ID\n  } = router.query;\n  const {\n    0: packageDetailList,\n    1: setPackageDetailList\n  } = useState([]);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState({\n    type: '',\n    status: false\n  });\n  const {\n    0: totalPage,\n    1: setTotalPage\n  } = useState(null);\n  const {\n    showNoti\n  } = useWrap();\n  const {\n    0: packageInfo,\n    1: setPackageInfo\n  } = useState(null);\n  const {\n    0: optionExamTopicList,\n    1: setOptionExamTopicList\n  } = useState([]); // FILTER\n\n  const listFieldInit = {\n    pageIndex: 1,\n    pageSize: 10,\n    SetPackageID: ID\n  };\n  let refValue = useRef({\n    pageIndex: 1,\n    pageSize: 10\n  });\n  const {\n    0: filters,\n    1: setFilters\n  } = useState(listFieldInit); // PAGINATION\n\n  const getPagination = (pageIndex, pageSize) => {\n    if (!pageSize) pageSize = 10;\n    refValue.current = _objectSpread(_objectSpread({}, refValue.current), {}, {\n      pageSize,\n      pageIndex\n    });\n    setFilters(_objectSpread(_objectSpread({}, filters), refValue.current));\n  }; // RESET SEARCH\n\n\n  const onResetSearch = () => {\n    setFilters(_objectSpread(_objectSpread({}, listFieldInit), {}, {\n      pageSize: refValue.current.pageSize\n    }));\n  }; // GET DATA IN FIRST TIME\n\n\n  const fetchPackageDetailList = async () => {\n    setIsLoading({\n      type: 'GET_ALL',\n      status: true\n    });\n\n    try {\n      let res = await packageDetailApi.getAll(filters);\n\n      if (res.status === 200) {\n        if (res.data.totalRow && res.data.data.length) {\n          setPackageDetailList(res.data.data);\n          setTotalPage(res.data.totalRow);\n        }\n      } else if (res.status === 204) {\n        showNoti('danger', 'Không tìm thấy');\n      }\n    } catch (error) {\n      showNoti('danger', error.message);\n    } finally {\n      setIsLoading({\n        type: 'GET_ALL',\n        status: false\n      });\n    }\n  };\n\n  const fetchPackage = async () => {\n    setIsLoading({\n      type: 'GET_ALL',\n      status: true\n    });\n\n    try {\n      let res = await packageApi.getByID(ID);\n\n      if (res.status === 200) {\n        setPackageInfo(res.data.data);\n      } else if (res.status === 204) {\n        showNoti('danger', 'Không tìm thấy');\n      }\n    } catch (error) {\n      showNoti('danger', error.message);\n    } finally {\n      setIsLoading({\n        type: 'GET_ALL',\n        status: false\n      });\n    }\n  };\n\n  const fetchExam = async () => {\n    setIsLoading({\n      type: 'GET_ALL',\n      status: true\n    });\n\n    try {\n      let res = await examTopicApi.getAll({\n        selectAll: true,\n        Type: 2\n      });\n\n      if (res.status === 200) {\n        const fmOptionExamTopicList = fmSelectArr(res.data.data, 'Name', 'ID');\n        setOptionExamTopicList(fmOptionExamTopicList);\n      } else if (res.status === 204) {\n        showNoti('danger', 'Không tìm thấy');\n      }\n    } catch (error) {\n      showNoti('danger', error.message);\n    } finally {\n      setIsLoading({\n        type: 'GET_ALL',\n        status: false\n      });\n    }\n  };\n\n  useEffect(() => {\n    fetchPackage();\n    fetchExam();\n  }, []);\n  useEffect(() => {\n    fetchPackageDetailList();\n  }, [filters]);\n\n  const onCreatePackageDetail = async data => {\n    setIsLoading({\n      type: 'ADD_DATA',\n      status: true\n    });\n\n    try {\n      const newPackageDetail = {\n        SetPackageID: packageInfo.ID,\n        ExamTopicID: data.ExamTopicID\n      };\n      const res = await packageDetailApi.add(newPackageDetail);\n\n      if (res.status === 200) {\n        onResetSearch();\n        showNoti('success', res.data.message);\n        return res;\n      }\n    } catch (error) {\n      showNoti('danger', error.message);\n    } finally {\n      setIsLoading({\n        type: 'ADD_DATA',\n        status: false\n      });\n    }\n  };\n\n  const onDeletePackageDetail = idx => {\n    return async () => {\n      setIsLoading({\n        type: 'ADD_DATA',\n        status: true\n      });\n\n      try {\n        const delObj = packageDetailList[idx];\n\n        const newDelObj = _objectSpread(_objectSpread({}, delObj), {}, {\n          Enable: false\n        });\n\n        const res = await packageDetailApi.update(newDelObj);\n        res.status === 200 && showNoti('success', res.data.message);\n\n        if (packageDetailList.length === 1) {\n          filters.pageIndex === 1 ? (setFilters(_objectSpread(_objectSpread(_objectSpread({}, listFieldInit), refValue.current), {}, {\n            pageIndex: 1\n          })), setPackageDetailList([])) : setFilters(_objectSpread(_objectSpread(_objectSpread({}, filters), refValue.current), {}, {\n            pageIndex: filters.pageIndex - 1\n          }));\n          return;\n        }\n\n        fetchPackageDetailList();\n      } catch (error) {\n        showNoti('danger', error.message);\n      } finally {\n        setIsLoading({\n          type: 'ADD_DATA',\n          status: false\n        });\n      }\n    };\n  };\n\n  const columns = [{\n    title: 'Tên đề thi',\n    dataIndex: 'ExamTopicName'\n  }, {\n    title: 'Môn',\n    dataIndex: 'SubjectName'\n  }, {\n    title: 'Level',\n    dataIndex: 'SetPackageLevel',\n    render: SetPackageLevel => `HSK ${SetPackageLevel}`\n  }, {\n    title: 'Thời gian',\n    dataIndex: 'Time',\n    render: time => `${time} phút`\n  }, {\n    title: 'Hình thức',\n    dataIndex: 'TypeName'\n  }, {\n    align: 'center',\n    render: (packageItem, record, idx) => /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Link, {\n        href: {\n          pathname: `/question-bank/exam-list/exam-detail/${packageItem.ExamTopicID}`\n        },\n        children: /*#__PURE__*/_jsxDEV(Tooltip, {\n          title: \"Chi ti\\u1EBFt \\u0111\\u1EC1 thi\",\n          children: /*#__PURE__*/_jsxDEV(\"a\", {\n            className: \"btn btn-icon\",\n            children: /*#__PURE__*/_jsxDEV(Eye, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 9\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 8\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 7\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(DeleteTableRow, {\n        handleDelete: onDeletePackageDetail(idx)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true)\n  }];\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(PowerTable, {\n      currentPage: filters.pageIndex,\n      totalPage: totalPage,\n      getPagination: getPagination,\n      loading: isLoading,\n      Size: \"package-list-table\",\n      addClass: \"basic-header\",\n      dataSource: packageDetailList,\n      columns: columns,\n      TitlePage: \"Danh s\\xE1ch b\\u1ED9 \\u0111\\u1EC1\",\n      TitleCard: /*#__PURE__*/_jsxDEV(PackageDetailForm, {\n        isLoading: isLoading,\n        packageInfo: packageInfo,\n        optionExamTopicList: optionExamTopicList,\n        handleSubmit: onCreatePackageDetail\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 6\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 4\n    }, this)\n  }, void 0, false);\n};\n\nexport default PackageDetail;","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/components/Global/Package/PackageDetail/PackageDetail.tsx"],"names":["Tooltip","Link","useRouter","React","useEffect","useRef","useState","Eye","examTopicApi","packageApi","packageDetailApi","DeleteTableRow","PowerTable","useWrap","fmSelectArr","PackageDetailForm","PackageDetail","router","slug","ID","query","packageDetailList","setPackageDetailList","isLoading","setIsLoading","type","status","totalPage","setTotalPage","showNoti","packageInfo","setPackageInfo","optionExamTopicList","setOptionExamTopicList","listFieldInit","pageIndex","pageSize","SetPackageID","refValue","filters","setFilters","getPagination","current","onResetSearch","fetchPackageDetailList","res","getAll","data","totalRow","length","error","message","fetchPackage","getByID","fetchExam","selectAll","Type","fmOptionExamTopicList","onCreatePackageDetail","newPackageDetail","ExamTopicID","add","onDeletePackageDetail","idx","delObj","newDelObj","Enable","update","columns","title","dataIndex","render","SetPackageLevel","time","align","packageItem","record","pathname"],"mappings":"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","sourcesContent":["import { Tooltip } from 'antd';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/router';\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { Eye } from 'react-feather';\r\nimport { examTopicApi, packageApi } from '~/apiBase';\r\nimport { packageDetailApi } from '~/apiBase/package/package-detail';\r\nimport DeleteTableRow from '~/components/Elements/DeleteTableRow/DeleteTableRow';\r\nimport PowerTable from '~/components/PowerTable';\r\nimport { useWrap } from '~/context/wrap';\r\nimport { fmSelectArr } from '~/utils/functions';\r\nimport PackageDetailForm from './PackageDetailForm/PackageDetailForm';\r\n\r\nconst PackageDetail = () => {\r\n\tconst router = useRouter();\r\n\tconst { slug: ID } = router.query;\r\n\tconst [packageDetailList, setPackageDetailList] = useState<ISetPackageDetail[]>([]);\r\n\tconst [isLoading, setIsLoading] = useState({\r\n\t\ttype: '',\r\n\t\tstatus: false\r\n\t});\r\n\tconst [totalPage, setTotalPage] = useState(null);\r\n\tconst { showNoti } = useWrap();\r\n\tconst [packageInfo, setPackageInfo] = useState<IPackage>(null);\r\n\tconst [optionExamTopicList, setOptionExamTopicList] = useState<IOptionCommon[]>([]);\r\n\t// FILTER\r\n\tconst listFieldInit = {\r\n\t\tpageIndex: 1,\r\n\t\tpageSize: 10,\r\n\r\n\t\tSetPackageID: ID\r\n\t};\r\n\tlet refValue = useRef({\r\n\t\tpageIndex: 1,\r\n\t\tpageSize: 10\r\n\t});\r\n\tconst [filters, setFilters] = useState(listFieldInit);\r\n\t// PAGINATION\r\n\tconst getPagination = (pageIndex: number, pageSize: number) => {\r\n\t\tif (!pageSize) pageSize = 10;\r\n\t\trefValue.current = {\r\n\t\t\t...refValue.current,\r\n\t\t\tpageSize,\r\n\t\t\tpageIndex\r\n\t\t};\r\n\t\tsetFilters({\r\n\t\t\t...filters,\r\n\t\t\t...refValue.current\r\n\t\t});\r\n\t};\r\n\t// RESET SEARCH\r\n\tconst onResetSearch = () => {\r\n\t\tsetFilters({\r\n\t\t\t...listFieldInit,\r\n\t\t\tpageSize: refValue.current.pageSize\r\n\t\t});\r\n\t};\r\n\t// GET DATA IN FIRST TIME\r\n\tconst fetchPackageDetailList = async () => {\r\n\t\tsetIsLoading({\r\n\t\t\ttype: 'GET_ALL',\r\n\t\t\tstatus: true\r\n\t\t});\r\n\t\ttry {\r\n\t\t\tlet res = await packageDetailApi.getAll(filters);\r\n\t\t\tif (res.status === 200) {\r\n\t\t\t\tif (res.data.totalRow && res.data.data.length) {\r\n\t\t\t\t\tsetPackageDetailList(res.data.data);\r\n\t\t\t\t\tsetTotalPage(res.data.totalRow);\r\n\t\t\t\t}\r\n\t\t\t} else if (res.status === 204) {\r\n\t\t\t\tshowNoti('danger', 'Không tìm thấy');\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error.message);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'GET_ALL',\r\n\t\t\t\tstatus: false\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\tconst fetchPackage = async () => {\r\n\t\tsetIsLoading({\r\n\t\t\ttype: 'GET_ALL',\r\n\t\t\tstatus: true\r\n\t\t});\r\n\t\ttry {\r\n\t\t\tlet res = await packageApi.getByID(ID);\r\n\t\t\tif (res.status === 200) {\r\n\t\t\t\tsetPackageInfo(res.data.data);\r\n\t\t\t} else if (res.status === 204) {\r\n\t\t\t\tshowNoti('danger', 'Không tìm thấy');\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error.message);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'GET_ALL',\r\n\t\t\t\tstatus: false\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\tconst fetchExam = async () => {\r\n\t\tsetIsLoading({\r\n\t\t\ttype: 'GET_ALL',\r\n\t\t\tstatus: true\r\n\t\t});\r\n\t\ttry {\r\n\t\t\tlet res = await examTopicApi.getAll({ selectAll: true, Type: 2 });\r\n\t\t\tif (res.status === 200) {\r\n\t\t\t\tconst fmOptionExamTopicList = fmSelectArr(res.data.data, 'Name', 'ID');\r\n\t\t\t\tsetOptionExamTopicList(fmOptionExamTopicList);\r\n\t\t\t} else if (res.status === 204) {\r\n\t\t\t\tshowNoti('danger', 'Không tìm thấy');\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error.message);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'GET_ALL',\r\n\t\t\t\tstatus: false\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tfetchPackage();\r\n\t\tfetchExam();\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tfetchPackageDetailList();\r\n\t}, [filters]);\r\n\r\n\tconst onCreatePackageDetail = async (data: { Name: string; ExamTopicID: number }) => {\r\n\t\tsetIsLoading({\r\n\t\t\ttype: 'ADD_DATA',\r\n\t\t\tstatus: true\r\n\t\t});\r\n\t\ttry {\r\n\t\t\tconst newPackageDetail = {\r\n\t\t\t\tSetPackageID: packageInfo.ID,\r\n\t\t\t\tExamTopicID: data.ExamTopicID\r\n\t\t\t};\r\n\t\t\tconst res = await packageDetailApi.add(newPackageDetail);\r\n\t\t\tif (res.status === 200) {\r\n\t\t\t\tonResetSearch();\r\n\t\t\t\tshowNoti('success', res.data.message);\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error.message);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'ADD_DATA',\r\n\t\t\t\tstatus: false\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\tconst onDeletePackageDetail = (idx: number) => {\r\n\t\treturn async () => {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'ADD_DATA',\r\n\t\t\t\tstatus: true\r\n\t\t\t});\r\n\t\t\ttry {\r\n\t\t\t\tconst delObj = packageDetailList[idx];\r\n\t\t\t\tconst newDelObj = {\r\n\t\t\t\t\t...delObj,\r\n\t\t\t\t\tEnable: false\r\n\t\t\t\t};\r\n\t\t\t\tconst res = await packageDetailApi.update(newDelObj);\r\n\t\t\t\tres.status === 200 && showNoti('success', res.data.message);\r\n\t\t\t\tif (packageDetailList.length === 1) {\r\n\t\t\t\t\tfilters.pageIndex === 1\r\n\t\t\t\t\t\t? (setFilters({\r\n\t\t\t\t\t\t\t\t...listFieldInit,\r\n\t\t\t\t\t\t\t\t...refValue.current,\r\n\t\t\t\t\t\t\t\tpageIndex: 1\r\n\t\t\t\t\t\t  }),\r\n\t\t\t\t\t\t  setPackageDetailList([]))\r\n\t\t\t\t\t\t: setFilters({\r\n\t\t\t\t\t\t\t\t...filters,\r\n\t\t\t\t\t\t\t\t...refValue.current,\r\n\t\t\t\t\t\t\t\tpageIndex: filters.pageIndex - 1\r\n\t\t\t\t\t\t  });\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tfetchPackageDetailList();\r\n\t\t\t} catch (error) {\r\n\t\t\t\tshowNoti('danger', error.message);\r\n\t\t\t} finally {\r\n\t\t\t\tsetIsLoading({\r\n\t\t\t\t\ttype: 'ADD_DATA',\r\n\t\t\t\t\tstatus: false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\tconst columns = [\r\n\t\t{\r\n\t\t\ttitle: 'Tên đề thi',\r\n\t\t\tdataIndex: 'ExamTopicName'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Môn',\r\n\t\t\tdataIndex: 'SubjectName'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Level',\r\n\t\t\tdataIndex: 'SetPackageLevel',\r\n\t\t\trender: (SetPackageLevel) => `HSK ${SetPackageLevel}`\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Thời gian',\r\n\t\t\tdataIndex: 'Time',\r\n\t\t\trender: (time) => `${time} phút`\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Hình thức',\r\n\t\t\tdataIndex: 'TypeName'\r\n\t\t},\r\n\t\t{\r\n\t\t\talign: 'center',\r\n\t\t\trender: (packageItem: ISetPackageDetail, record, idx) => (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\thref={{\r\n\t\t\t\t\t\t\tpathname: `/question-bank/exam-list/exam-detail/${packageItem.ExamTopicID}`\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Tooltip title=\"Chi tiết đề thi\">\r\n\t\t\t\t\t\t\t<a className=\"btn btn-icon\">\r\n\t\t\t\t\t\t\t\t<Eye />\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t\t<DeleteTableRow handleDelete={onDeletePackageDetail(idx)} />\r\n\t\t\t\t</>\r\n\t\t\t)\r\n\t\t}\r\n\t];\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<PowerTable\r\n\t\t\t\tcurrentPage={filters.pageIndex}\r\n\t\t\t\ttotalPage={totalPage}\r\n\t\t\t\tgetPagination={getPagination}\r\n\t\t\t\tloading={isLoading}\r\n\t\t\t\tSize=\"package-list-table\"\r\n\t\t\t\taddClass=\"basic-header\"\r\n\t\t\t\tdataSource={packageDetailList}\r\n\t\t\t\tcolumns={columns}\r\n\t\t\t\tTitlePage=\"Danh sách bộ đề\"\r\n\t\t\t\tTitleCard={\r\n\t\t\t\t\t<PackageDetailForm\r\n\t\t\t\t\t\tisLoading={isLoading}\r\n\t\t\t\t\t\tpackageInfo={packageInfo}\r\n\t\t\t\t\t\toptionExamTopicList={optionExamTopicList}\r\n\t\t\t\t\t\thandleSubmit={onCreatePackageDetail}\r\n\t\t\t\t\t/>\r\n\t\t\t\t}\r\n\t\t\t/>\r\n\t\t</>\r\n\t);\r\n};\r\n\r\nexport default PackageDetail;\r\n"]},"metadata":{},"sourceType":"module"}