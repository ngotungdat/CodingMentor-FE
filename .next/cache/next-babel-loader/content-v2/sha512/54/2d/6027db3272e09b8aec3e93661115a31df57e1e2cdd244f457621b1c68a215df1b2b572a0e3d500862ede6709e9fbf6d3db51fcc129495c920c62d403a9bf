{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport axios from 'axios';\nimport { getSession, signIn } from 'next-auth/client';\nimport _ from '~/appConfig';\nconst SHOW_LOG = true;\nconst NODE_STATUS = \"development\";\n\nconst isShowLog = e => {\n  if (e === '/api/Idioms/getRandoms' || e === '/api/Rules') {\n    return false;\n  } else {\n    return NODE_STATUS == 'production' && !!SHOW_LOG ? true : true;\n  }\n};\n\nfunction getUrl(config) {\n  return !!config.baseURL ? config.url.replace(config.baseURL, '').split('?')[0] : config.url;\n}\n\nexport const authHeader_X = async () => {\n  const session = await getSession();\n  return !!session && !!session.accessToken ? {\n    token: session.accessToken\n  } : {};\n};\nexport const authHeader_Bearer = async () => {\n  const session = await getSession();\n  return !!session && !!session.accessToken ? {\n    Authorization: 'Bearer ' + session.accessToken\n  } : {};\n};\nexport const instance = axios.create({\n  baseURL: _.hostURL,\n  headers: {\n    Accept: 'application/json'\n  }\n});\ninstance.interceptors.request.use(async config => {\n  const url = getUrl(config);\n\n  if (!url.toString().includes('/auth/')) {\n    const authHeader = await authHeader_X();\n    config.headers = _objectSpread(_objectSpread({}, config.headers), authHeader);\n  }\n\n  isShowLog(url) && console.log(`%c ${config === null || config === void 0 ? void 0 : config.method.toUpperCase()} - ${url}:`, 'color: #0086b3; font-weight: bold', config);\n  return config;\n}, error => {\n  var _error$response, _error$response2;\n\n  isShowLog('') && console.log(`%c ${error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status}  :`, 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data);\n  return Promise.reject(error);\n});\n\nconst checkResponse = error => {\n  var _error$response3, _error$response4;\n\n  switch (error === null || error === void 0 ? void 0 : (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.status) {\n    case 401:\n      setTimeout(() => {\n        signIn();\n      }, 1000);\n      break;\n\n    case 403:\n      console.log(`%ERROR 403:` + `%c DON'T HAVE PERMISSON`, 'color: red; font-weight: bold', 'color: yellow;');\n      alert('Bạn không có quyền thực hiện');\n      break;\n\n    case 400:\n      console.log(error === null || error === void 0 ? void 0 : (_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.message);\n      break;\n\n    case 500:\n      console.log(`% ERROR 500:` + `%c BACK-END`, 'color: red; font-weight: bold', 'color: yellow;');\n      break;\n\n    default:\n      console.log(`%c ${error === null || error === void 0 ? void 0 : error.response}  :`, 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : error.response);\n  }\n};\n\ninstance.interceptors.response.use(response => {\n  let url = getUrl(response === null || response === void 0 ? void 0 : response.config);\n  isShowLog(url) && console.log(` %c ${response === null || response === void 0 ? void 0 : response.status} - ${getUrl(response === null || response === void 0 ? void 0 : response.config)}:`, 'color: #008000; font-weight: bold', response);\n  return response;\n}, function (error) {\n  if (!!(error !== null && error !== void 0 && error.response)) {\n    var _error$response5, _error$response6, _error$response7;\n\n    checkResponse(error);\n    isShowLog('') && console.log(`%c ${error === null || error === void 0 ? void 0 : (_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : _error$response5.status}  :`, 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : (_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : _error$response6.data);\n    return !!(error !== null && error !== void 0 && (_error$response7 = error.response) !== null && _error$response7 !== void 0 && _error$response7.data) ? Promise.reject(error.response.data) : Promise.reject(error);\n  } else if (error.request) {\n    var _error$response8, _error$response9;\n\n    isShowLog('') && console.log(`%c ${JSON.stringify(error)}  :`, 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : (_error$response8 = error.response) === null || _error$response8 === void 0 ? void 0 : _error$response8.data);\n    return !!(error !== null && error !== void 0 && (_error$response9 = error.response) !== null && _error$response9 !== void 0 && _error$response9.data) ? Promise.reject(error.response.data) : Promise.reject(error);\n  } else {\n    var _error$response10;\n\n    isShowLog('') && console.log(`%c ${JSON.stringify(error)}  :`, 'color: red; font-weight: bold', 'Hình như là setting sai');\n    return !!(error !== null && error !== void 0 && (_error$response10 = error.response) !== null && _error$response10 !== void 0 && _error$response10.data) ? Promise.reject(error.response.data) : Promise.reject(error);\n  }\n});","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/apiBase/instance.ts"],"names":["axios","getSession","signIn","_","SHOW_LOG","NODE_STATUS","isShowLog","e","getUrl","config","baseURL","url","replace","split","authHeader_X","session","accessToken","token","authHeader_Bearer","Authorization","instance","create","hostURL","headers","Accept","interceptors","request","use","toString","includes","authHeader","console","log","method","toUpperCase","error","response","status","data","Promise","reject","checkResponse","setTimeout","alert","message","JSON","stringify"],"mappings":";;;;;;AAAA,OAAOA,KAAP,MAAyD,OAAzD;AACA,SAASC,UAAT,EAAqBC,MAArB,QAAmC,kBAAnC;AACA,OAAOC,CAAP,MAAc,aAAd;AAEA,MAAMC,QAAQ,GAAG,IAAjB;AACA,MAAMC,WAAgB,gBAAtB;;AAEA,MAAMC,SAAS,GAAIC,CAAD,IAAY;AAC7B,MAAIA,CAAC,KAAK,wBAAN,IAAkCA,CAAC,KAAK,YAA5C,EAA0D;AACzD,WAAO,KAAP;AACA,GAFD,MAEO;AACN,WAAOF,WAAW,IAAI,YAAf,IAA+B,CAAC,CAACD,QAAjC,GAA4C,IAA5C,GAAmD,IAA1D;AACA;AACD,CAND;;AAQA,SAASI,MAAT,CAAgBC,MAAhB,EAA6B;AAC5B,SAAO,CAAC,CAACA,MAAM,CAACC,OAAT,GAAmBD,MAAM,CAACE,GAAP,CAAWC,OAAX,CAAmBH,MAAM,CAACC,OAA1B,EAAmC,EAAnC,EAAuCG,KAAvC,CAA6C,GAA7C,EAAkD,CAAlD,CAAnB,GAA0EJ,MAAM,CAACE,GAAxF;AACA;;AAED,OAAO,MAAMG,YAAY,GAAG,YAAY;AACvC,QAAMC,OAAY,GAAG,MAAMd,UAAU,EAArC;AACA,SAAO,CAAC,CAACc,OAAF,IAAa,CAAC,CAACA,OAAO,CAACC,WAAvB,GAAqC;AAAEC,IAAAA,KAAK,EAAEF,OAAO,CAACC;AAAjB,GAArC,GAAsE,EAA7E;AACA,CAHM;AAIP,OAAO,MAAME,iBAAiB,GAAG,YAAY;AAC5C,QAAMH,OAAY,GAAG,MAAMd,UAAU,EAArC;AACA,SAAO,CAAC,CAACc,OAAF,IAAa,CAAC,CAACA,OAAO,CAACC,WAAvB,GAAqC;AAAEG,IAAAA,aAAa,EAAE,YAAYJ,OAAO,CAACC;AAArC,GAArC,GAA0F,EAAjG;AACA,CAHM;AAKP,OAAO,MAAMI,QAAQ,GAAGpB,KAAK,CAACqB,MAAN,CAAa;AACpCX,EAAAA,OAAO,EAAEP,CAAC,CAACmB,OADyB;AAEpCC,EAAAA,OAAO,EAAE;AACRC,IAAAA,MAAM,EAAE;AADA;AAF2B,CAAb,CAAjB;AAOPJ,QAAQ,CAACK,YAAT,CAAsBC,OAAtB,CAA8BC,GAA9B,CACC,MAAOlB,MAAP,IAAsC;AACrC,QAAME,GAAQ,GAAGH,MAAM,CAACC,MAAD,CAAvB;;AACA,MAAI,CAACE,GAAG,CAACiB,QAAJ,GAAeC,QAAf,CAAwB,QAAxB,CAAL,EAAwC;AACvC,UAAMC,UAAe,GAAG,MAAMhB,YAAY,EAA1C;AACAL,IAAAA,MAAM,CAACc,OAAP,mCACId,MAAM,CAACc,OADX,GAEIO,UAFJ;AAIA;;AACDxB,EAAAA,SAAS,CAACK,GAAD,CAAT,IAAkBoB,OAAO,CAACC,GAAR,CAAa,MAAKvB,MAAN,aAAMA,MAAN,uBAAMA,MAAM,CAAEwB,MAAR,CAAeC,WAAf,EAA6B,MAAKvB,GAAI,GAAxD,EAA4D,mCAA5D,EAAiGF,MAAjG,CAAlB;AACA,SAAOA,MAAP;AACA,CAZF,EAaE0B,KAAD,IAAgB;AAAA;;AACf7B,EAAAA,SAAS,CAAC,EAAD,CAAT,IAAiByB,OAAO,CAACC,GAAR,CAAa,MAAKG,KAAN,aAAMA,KAAN,0CAAMA,KAAK,CAAEC,QAAb,oDAAM,gBAAiBC,MAAO,KAA1C,EAAgD,+BAAhD,EAAiFF,KAAjF,aAAiFA,KAAjF,2CAAiFA,KAAK,CAAEC,QAAxF,qDAAiF,iBAAiBE,IAAlG,CAAjB;AACA,SAAOC,OAAO,CAACC,MAAR,CAAeL,KAAf,CAAP;AACA,CAhBF;;AAmBA,MAAMM,aAAa,GAAIN,KAAD,IAAgB;AAAA;;AACrC,UAAQA,KAAR,aAAQA,KAAR,2CAAQA,KAAK,CAAEC,QAAf,qDAAQ,iBAAiBC,MAAzB;AACC,SAAK,GAAL;AACCK,MAAAA,UAAU,CAAC,MAAM;AAChBxC,QAAAA,MAAM;AACN,OAFS,EAEP,IAFO,CAAV;AAGA;;AACD,SAAK,GAAL;AACC6B,MAAAA,OAAO,CAACC,GAAR,CAAa,aAAD,GAAiB,yBAA7B,EAAuD,+BAAvD,EAAwF,gBAAxF;AACAW,MAAAA,KAAK,CAAC,8BAAD,CAAL;AACA;;AACD,SAAK,GAAL;AACCZ,MAAAA,OAAO,CAACC,GAAR,CAAYG,KAAZ,aAAYA,KAAZ,2CAAYA,KAAK,CAAEC,QAAnB,qDAAY,iBAAiBQ,OAA7B;AACA;;AACD,SAAK,GAAL;AACCb,MAAAA,OAAO,CAACC,GAAR,CAAa,cAAD,GAAkB,aAA9B,EAA4C,+BAA5C,EAA6E,gBAA7E;AACA;;AACD;AACCD,MAAAA,OAAO,CAACC,GAAR,CAAa,MAAKG,KAAN,aAAMA,KAAN,uBAAMA,KAAK,CAAEC,QAAS,KAAlC,EAAwC,+BAAxC,EAAyED,KAAzE,aAAyEA,KAAzE,uBAAyEA,KAAK,CAAEC,QAAhF;AAjBF;AAmBA,CApBD;;AAsBAhB,QAAQ,CAACK,YAAT,CAAsBW,QAAtB,CAA+BT,GAA/B,CACES,QAAD,IAA6B;AAC5B,MAAIzB,GAAQ,GAAGH,MAAM,CAAC4B,QAAD,aAACA,QAAD,uBAACA,QAAQ,CAAE3B,MAAX,CAArB;AACAH,EAAAA,SAAS,CAACK,GAAD,CAAT,IAAkBoB,OAAO,CAACC,GAAR,CAAa,OAAMI,QAAP,aAAOA,QAAP,uBAAOA,QAAQ,CAAEC,MAAO,MAAK7B,MAAM,CAAC4B,QAAD,aAACA,QAAD,uBAACA,QAAQ,CAAE3B,MAAX,CAAmB,GAAlE,EAAsE,mCAAtE,EAA2G2B,QAA3G,CAAlB;AACA,SAAOA,QAAP;AACA,CALF,EAMC,UAAUD,KAAV,EAAsB;AACrB,MAAI,CAAC,EAACA,KAAD,aAACA,KAAD,eAACA,KAAK,CAAEC,QAAR,CAAL,EAAuB;AAAA;;AACtBK,IAAAA,aAAa,CAACN,KAAD,CAAb;AACA7B,IAAAA,SAAS,CAAC,EAAD,CAAT,IAAiByB,OAAO,CAACC,GAAR,CAAa,MAAKG,KAAN,aAAMA,KAAN,2CAAMA,KAAK,CAAEC,QAAb,qDAAM,iBAAiBC,MAAO,KAA1C,EAAgD,+BAAhD,EAAiFF,KAAjF,aAAiFA,KAAjF,2CAAiFA,KAAK,CAAEC,QAAxF,qDAAiF,iBAAiBE,IAAlG,CAAjB;AACA,WAAO,CAAC,EAACH,KAAD,aAACA,KAAD,mCAACA,KAAK,CAAEC,QAAR,6CAAC,iBAAiBE,IAAlB,CAAD,GAA0BC,OAAO,CAACC,MAAR,CAAeL,KAAK,CAACC,QAAN,CAAeE,IAA9B,CAA1B,GAAgEC,OAAO,CAACC,MAAR,CAAeL,KAAf,CAAvE;AACA,GAJD,MAIO,IAAIA,KAAK,CAACT,OAAV,EAAmB;AAAA;;AACzBpB,IAAAA,SAAS,CAAC,EAAD,CAAT,IAAiByB,OAAO,CAACC,GAAR,CAAa,MAAKa,IAAI,CAACC,SAAL,CAAeX,KAAf,CAAsB,KAAxC,EAA8C,+BAA9C,EAA+EA,KAA/E,aAA+EA,KAA/E,2CAA+EA,KAAK,CAAEC,QAAtF,qDAA+E,iBAAiBE,IAAhG,CAAjB;AACA,WAAO,CAAC,EAACH,KAAD,aAACA,KAAD,mCAACA,KAAK,CAAEC,QAAR,6CAAC,iBAAiBE,IAAlB,CAAD,GAA0BC,OAAO,CAACC,MAAR,CAAeL,KAAK,CAACC,QAAN,CAAeE,IAA9B,CAA1B,GAAgEC,OAAO,CAACC,MAAR,CAAeL,KAAf,CAAvE;AACA,GAHM,MAGA;AAAA;;AACN7B,IAAAA,SAAS,CAAC,EAAD,CAAT,IAAiByB,OAAO,CAACC,GAAR,CAAa,MAAKa,IAAI,CAACC,SAAL,CAAeX,KAAf,CAAsB,KAAxC,EAA8C,+BAA9C,EAA+E,yBAA/E,CAAjB;AACA,WAAO,CAAC,EAACA,KAAD,aAACA,KAAD,oCAACA,KAAK,CAAEC,QAAR,8CAAC,kBAAiBE,IAAlB,CAAD,GAA0BC,OAAO,CAACC,MAAR,CAAeL,KAAK,CAACC,QAAN,CAAeE,IAA9B,CAA1B,GAAgEC,OAAO,CAACC,MAAR,CAAeL,KAAf,CAAvE;AACA;AACD,CAlBF","sourcesContent":["import axios, { AxiosRequestConfig, AxiosResponse } from 'axios'\r\nimport { getSession, signIn } from 'next-auth/client'\r\nimport _ from '~/appConfig'\r\n\r\nconst SHOW_LOG = true\r\nconst NODE_STATUS: any = process.env.NODE_ENV\r\n\r\nconst isShowLog = (e: any) => {\r\n\tif (e === '/api/Idioms/getRandoms' || e === '/api/Rules') {\r\n\t\treturn false\r\n\t} else {\r\n\t\treturn NODE_STATUS == 'production' && !!SHOW_LOG ? true : true\r\n\t}\r\n}\r\n\r\nfunction getUrl(config: any) {\r\n\treturn !!config.baseURL ? config.url.replace(config.baseURL, '').split('?')[0] : config.url\r\n}\r\n\r\nexport const authHeader_X = async () => {\r\n\tconst session: any = await getSession()\r\n\treturn !!session && !!session.accessToken ? { token: session.accessToken } : {}\r\n}\r\nexport const authHeader_Bearer = async () => {\r\n\tconst session: any = await getSession()\r\n\treturn !!session && !!session.accessToken ? { Authorization: 'Bearer ' + session.accessToken } : {}\r\n}\r\n\r\nexport const instance = axios.create({\r\n\tbaseURL: _.hostURL,\r\n\theaders: {\r\n\t\tAccept: 'application/json'\r\n\t}\r\n})\r\n\r\ninstance.interceptors.request.use(\r\n\tasync (config: AxiosRequestConfig) => {\r\n\t\tconst url: any = getUrl(config)\r\n\t\tif (!url.toString().includes('/auth/')) {\r\n\t\t\tconst authHeader: any = await authHeader_X()\r\n\t\t\tconfig.headers = {\r\n\t\t\t\t...config.headers,\r\n\t\t\t\t...authHeader\r\n\t\t\t}\r\n\t\t}\r\n\t\tisShowLog(url) && console.log(`%c ${config?.method.toUpperCase()} - ${url}:`, 'color: #0086b3; font-weight: bold', config)\r\n\t\treturn config\r\n\t},\r\n\t(error: any) => {\r\n\t\tisShowLog('') && console.log(`%c ${error?.response?.status}  :`, 'color: red; font-weight: bold', error?.response?.data)\r\n\t\treturn Promise.reject(error)\r\n\t}\r\n)\r\n\r\nconst checkResponse = (error: any) => {\r\n\tswitch (error?.response?.status) {\r\n\t\tcase 401:\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tsignIn()\r\n\t\t\t}, 1000)\r\n\t\t\tbreak\r\n\t\tcase 403:\r\n\t\t\tconsole.log(`%ERROR 403:` + `%c DON'T HAVE PERMISSON`, 'color: red; font-weight: bold', 'color: yellow;')\r\n\t\t\talert('Bạn không có quyền thực hiện')\r\n\t\t\tbreak\r\n\t\tcase 400:\r\n\t\t\tconsole.log(error?.response?.message)\r\n\t\t\tbreak\r\n\t\tcase 500:\r\n\t\t\tconsole.log(`% ERROR 500:` + `%c BACK-END`, 'color: red; font-weight: bold', 'color: yellow;')\r\n\t\t\tbreak\r\n\t\tdefault:\r\n\t\t\tconsole.log(`%c ${error?.response}  :`, 'color: red; font-weight: bold', error?.response)\r\n\t}\r\n}\r\n\r\ninstance.interceptors.response.use(\r\n\t(response: AxiosResponse) => {\r\n\t\tlet url: any = getUrl(response?.config)\r\n\t\tisShowLog(url) && console.log(` %c ${response?.status} - ${getUrl(response?.config)}:`, 'color: #008000; font-weight: bold', response)\r\n\t\treturn response\r\n\t},\r\n\tfunction (error: any) {\r\n\t\tif (!!error?.response) {\r\n\t\t\tcheckResponse(error)\r\n\t\t\tisShowLog('') && console.log(`%c ${error?.response?.status}  :`, 'color: red; font-weight: bold', error?.response?.data)\r\n\t\t\treturn !!error?.response?.data ? Promise.reject(error.response.data) : Promise.reject(error)\r\n\t\t} else if (error.request) {\r\n\t\t\tisShowLog('') && console.log(`%c ${JSON.stringify(error)}  :`, 'color: red; font-weight: bold', error?.response?.data)\r\n\t\t\treturn !!error?.response?.data ? Promise.reject(error.response.data) : Promise.reject(error)\r\n\t\t} else {\r\n\t\t\tisShowLog('') && console.log(`%c ${JSON.stringify(error)}  :`, 'color: red; font-weight: bold', 'Hình như là setting sai')\r\n\t\t\treturn !!error?.response?.data ? Promise.reject(error.response.data) : Promise.reject(error)\r\n\t\t}\r\n\t}\r\n)\r\n"]},"metadata":{},"sourceType":"module"}