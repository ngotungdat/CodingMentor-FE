{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\MonaMedia\\\\Project\\\\IELTS-NguyenHuyen-FE\\\\IELTS-Nguyen-Huyen\\\\src\\\\components\\\\Global\\\\Package\\\\PayFixExam\\\\PayFixExamForm.tsx\";\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport { Form, Modal, Spin } from 'antd';\nimport React, { useEffect, useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport * as yup from 'yup';\nimport { payFixExamApi } from '~/apiBase';\nimport InputMoneyField from '~/components/FormControl/InputMoneyField';\nimport InputNumberField from '~/components/FormControl/InputNumberField';\nimport SelectField from '~/components/FormControl/SelectField';\nimport TextAreaField from '~/components/FormControl/TextAreaField';\nimport { useWrap } from '~/context/wrap';\nimport { numberWithCommas } from '~/utils/functions';\n\nconst PayFixExamForm = props => {\n  const {\n    dataStudent,\n    dataRow,\n    onFetchData,\n    onUpdateData,\n    dataLevel,\n    isBuy,\n    userID,\n    isOpenMarking\n  } = props;\n  const {\n    0: isModalVisible,\n    1: setIsModalVisible\n  } = useState(false);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(false);\n  const {\n    showNoti\n  } = useWrap();\n  const {\n    0: activePrice,\n    1: setActivePrice\n  } = useState(null);\n\n  const showModal = () => {\n    setIsModalVisible(true);\n  };\n\n  const handleOk = () => {\n    setIsModalVisible(false);\n  };\n\n  const handleCancel = () => {\n    setIsModalVisible(false);\n  };\n\n  const defaultValuesInit = {\n    StudentID: userID,\n    PriceFixExam: null,\n    Amount: 1,\n    Paid: null,\n    PaymentMethodsID: null,\n    //1-Tiền mặt 2-Chuyển khoản\n    Note: null\n  };\n  const schema = yup.object().shape({\n    PriceFixExam: yup.mixed().required('Vui lòng chọn thông tin'),\n    StudentID: yup.mixed().required('Vui lòng chọn thông tin'),\n    Amount: yup.mixed().required('Vui lòng nhập thông tin'),\n    Paid: yup.mixed().required('Vui lòng nhập thông tin'),\n    PaymentMethodsID: yup.mixed().required('Vui lòng nhập thông tin')\n  });\n  const form = useForm({\n    defaultValues: defaultValuesInit,\n    resolver: yupResolver(schema)\n  });\n\n  const onChange_SelectLevel = value => {\n    let priceLevel = dataLevel.find(item => item.value === value).price;\n    setActivePrice(priceLevel);\n    form.setValue('Amount', 1);\n    form.setValue('Paid', numberWithCommas(priceLevel));\n  };\n\n  const onChange_ChangeAmount = amount => {\n    if (activePrice) {\n      if (amount > 0) {\n        let totalPrice = amount * activePrice;\n        totalPrice = numberWithCommas(totalPrice);\n        form.setValue('Paid', totalPrice);\n      }\n    }\n  };\n\n  const onSubmit = async dataSubmit => {\n    dataSubmit.Paid = parseInt(dataSubmit.Paid.replace(/\\,/g, ''));\n    console.log('Data Submit: ', dataSubmit);\n    setIsLoading(true);\n    let res = null;\n\n    try {\n      res = await payFixExamApi.add(dataSubmit);\n\n      if (res.status === 200) {\n        onFetchData && onFetchData();\n        onUpdateData && onUpdateData();\n        setIsModalVisible(false);\n        form.reset(defaultValuesInit);\n        showNoti('success', !isBuy ? 'Thêm mới thành công' : 'Mua lượt chấm thành công');\n        '';\n      }\n    } catch (error) {\n      showNoti('danger', error.message);\n    } finally {\n      setIsLoading(false);\n    }\n  }; // useEffect(() => {\n  // \tif (isModalVisible) {\n  // \t\tif (userID) {\n  // \t\t\tform.setValue('StudentID', userID);\n  // \t\t}\n  // \t}\n  // }, [isModalVisible]);\n\n\n  useEffect(() => {\n    userID && form.setValue('StudentID', userID);\n  }, [userID]);\n  useEffect(() => {\n    if (isOpenMarking) {\n      setIsModalVisible(true);\n    }\n  }, [isOpenMarking]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [isBuy ? /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-warning\",\n      onClick: showModal,\n      children: \"Mua l\\u01B0\\u1EE3t ch\\u1EA5m b\\xE0i\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 5\n    }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-warning\",\n      onClick: showModal,\n      children: \"Th\\xEAm m\\u1EDBi\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      title: \"Mua l\\u01B0\\u1EE3t ch\\u1EA5m\",\n      visible: isModalVisible,\n      onOk: handleOk,\n      onCancel: handleCancel,\n      footer: null,\n      children: /*#__PURE__*/_jsxDEV(Form, {\n        layout: \"vertical\",\n        onFinish: form.handleSubmit(onSubmit),\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"container-fluid\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-12\",\n              children: /*#__PURE__*/_jsxDEV(SelectField, {\n                onChangeSelect: value => onChange_SelectLevel(value),\n                isRequired: true,\n                form: form,\n                name: \"PriceFixExam\",\n                label: \"Level\",\n                optionList: dataLevel\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 139,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 138,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-12\",\n              children: /*#__PURE__*/_jsxDEV(InputNumberField, {\n                handleChange: value => onChange_ChangeAmount(value),\n                isRequired: true,\n                form: form,\n                name: \"Amount\",\n                label: \"S\\u1ED1 l\\u01B0\\u1EE3t ch\\u1EA5m\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 149,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-12\",\n              children: /*#__PURE__*/_jsxDEV(InputMoneyField, {\n                isRequired: true,\n                form: form,\n                name: \"Paid\",\n                label: \"Gi\\xE1\",\n                disabled: true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 158,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 157,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-12\",\n              children: /*#__PURE__*/_jsxDEV(SelectField, {\n                isRequired: true,\n                form: form,\n                name: \"PaymentMethodsID\",\n                label: \"Ph\\u01B0\\u01A1ng th\\u1EE9c thanh to\\xE1n\",\n                optionList: [{\n                  title: 'Tiền mặt',\n                  value: 1\n                }, {\n                  title: 'Chuyển khoản',\n                  value: 2\n                }]\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 161,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-12 mb-3\",\n              children: /*#__PURE__*/_jsxDEV(TextAreaField, {\n                form: form,\n                name: \"Note\",\n                label: \"Ghi ch\\xFA\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 179,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 178,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-12 mt-5\",\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"submit\",\n                className: \"btn btn-primary w-100\",\n                children: [\"L\\u01B0u\", isLoading && /*#__PURE__*/_jsxDEV(Spin, {\n                  className: \"loading-base\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 184,\n                  columnNumber: 24\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 182,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true);\n};\n\nexport default PayFixExamForm;","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/components/Global/Package/PayFixExam/PayFixExamForm.tsx"],"names":["yupResolver","Form","Modal","Spin","React","useEffect","useState","useForm","yup","payFixExamApi","InputMoneyField","InputNumberField","SelectField","TextAreaField","useWrap","numberWithCommas","PayFixExamForm","props","dataStudent","dataRow","onFetchData","onUpdateData","dataLevel","isBuy","userID","isOpenMarking","isModalVisible","setIsModalVisible","isLoading","setIsLoading","showNoti","activePrice","setActivePrice","showModal","handleOk","handleCancel","defaultValuesInit","StudentID","PriceFixExam","Amount","Paid","PaymentMethodsID","Note","schema","object","shape","mixed","required","form","defaultValues","resolver","onChange_SelectLevel","value","priceLevel","find","item","price","setValue","onChange_ChangeAmount","amount","totalPrice","onSubmit","dataSubmit","parseInt","replace","console","log","res","add","status","reset","error","message","handleSubmit","title"],"mappings":"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","sourcesContent":["import { yupResolver } from '@hookform/resolvers/yup'\r\nimport { Form, Modal, Spin } from 'antd'\r\nimport React, { useEffect, useState } from 'react'\r\nimport { useForm } from 'react-hook-form'\r\nimport * as yup from 'yup'\r\nimport { payFixExamApi } from '~/apiBase'\r\nimport InputMoneyField from '~/components/FormControl/InputMoneyField'\r\nimport InputNumberField from '~/components/FormControl/InputNumberField'\r\nimport SelectField from '~/components/FormControl/SelectField'\r\nimport TextAreaField from '~/components/FormControl/TextAreaField'\r\nimport { useWrap } from '~/context/wrap'\r\nimport { numberWithCommas } from '~/utils/functions'\r\n\r\nconst PayFixExamForm = (props) => {\r\n\tconst { dataStudent, dataRow, onFetchData, onUpdateData, dataLevel, isBuy, userID, isOpenMarking } = props\r\n\tconst [isModalVisible, setIsModalVisible] = useState(false)\r\n\tconst [isLoading, setIsLoading] = useState(false)\r\n\tconst { showNoti } = useWrap()\r\n\tconst [activePrice, setActivePrice] = useState<number>(null)\r\n\r\n\tconst showModal = () => {\r\n\t\tsetIsModalVisible(true)\r\n\t}\r\n\r\n\tconst handleOk = () => {\r\n\t\tsetIsModalVisible(false)\r\n\t}\r\n\r\n\tconst handleCancel = () => {\r\n\t\tsetIsModalVisible(false)\r\n\t}\r\n\r\n\tconst defaultValuesInit = {\r\n\t\tStudentID: userID,\r\n\t\tPriceFixExam: null,\r\n\t\tAmount: 1,\r\n\t\tPaid: null,\r\n\t\tPaymentMethodsID: null, //1-Tiền mặt 2-Chuyển khoản\r\n\t\tNote: null\r\n\t}\r\n\tconst schema = yup.object().shape({\r\n\t\tPriceFixExam: yup.mixed().required('Vui lòng chọn thông tin'),\r\n\t\tStudentID: yup.mixed().required('Vui lòng chọn thông tin'),\r\n\t\tAmount: yup.mixed().required('Vui lòng nhập thông tin'),\r\n\t\tPaid: yup.mixed().required('Vui lòng nhập thông tin'),\r\n\t\tPaymentMethodsID: yup.mixed().required('Vui lòng nhập thông tin')\r\n\t})\r\n\r\n\tconst form = useForm({\r\n\t\tdefaultValues: defaultValuesInit,\r\n\t\tresolver: yupResolver(schema)\r\n\t})\r\n\r\n\tconst onChange_SelectLevel = (value) => {\r\n\t\tlet priceLevel = dataLevel.find((item) => item.value === value).price\r\n\t\tsetActivePrice(priceLevel)\r\n\t\tform.setValue('Amount', 1)\r\n\t\tform.setValue('Paid', numberWithCommas(priceLevel))\r\n\t}\r\n\r\n\tconst onChange_ChangeAmount = (amount) => {\r\n\t\tif (activePrice) {\r\n\t\t\tif (amount > 0) {\r\n\t\t\t\tlet totalPrice: any = amount * activePrice\r\n\t\t\t\ttotalPrice = numberWithCommas(totalPrice)\r\n\t\t\t\tform.setValue('Paid', totalPrice)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconst onSubmit = async (dataSubmit) => {\r\n\t\tdataSubmit.Paid = parseInt(dataSubmit.Paid.replace(/\\,/g, ''))\r\n\t\tconsole.log('Data Submit: ', dataSubmit)\r\n\t\tsetIsLoading(true)\r\n\r\n\t\tlet res = null\r\n\r\n\t\ttry {\r\n\t\t\tres = await payFixExamApi.add(dataSubmit)\r\n\r\n\t\t\tif (res.status === 200) {\r\n\t\t\t\tonFetchData && onFetchData()\r\n\t\t\t\tonUpdateData && onUpdateData()\r\n\t\t\t\tsetIsModalVisible(false)\r\n\t\t\t\tform.reset(defaultValuesInit)\r\n\t\t\t\tshowNoti('success', !isBuy ? 'Thêm mới thành công' : 'Mua lượt chấm thành công')\r\n\t\t\t\t;('')\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error.message)\r\n\t\t} finally {\r\n\t\t\tsetIsLoading(false)\r\n\t\t}\r\n\t}\r\n\r\n\t// useEffect(() => {\r\n\t// \tif (isModalVisible) {\r\n\t// \t\tif (userID) {\r\n\t// \t\t\tform.setValue('StudentID', userID);\r\n\t// \t\t}\r\n\t// \t}\r\n\t// }, [isModalVisible]);\r\n\tuseEffect(() => {\r\n\t\tuserID && form.setValue('StudentID', userID)\r\n\t}, [userID])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (isOpenMarking) {\r\n\t\t\tsetIsModalVisible(true)\r\n\t\t}\r\n\t}, [isOpenMarking])\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{isBuy ? (\r\n\t\t\t\t<button className=\"btn btn-warning\" onClick={showModal}>\r\n\t\t\t\t\tMua lượt chấm bài\r\n\t\t\t\t</button>\r\n\t\t\t) : (\r\n\t\t\t\t<button className=\"btn btn-warning\" onClick={showModal}>\r\n\t\t\t\t\tThêm mới\r\n\t\t\t\t</button>\r\n\t\t\t)}\r\n\t\t\t<Modal title=\"Mua lượt chấm\" visible={isModalVisible} onOk={handleOk} onCancel={handleCancel} footer={null}>\r\n\t\t\t\t<Form layout=\"vertical\" onFinish={form.handleSubmit(onSubmit)}>\r\n\t\t\t\t\t<div className=\"container-fluid\">\r\n\t\t\t\t\t\t<div className=\"row\">\r\n\t\t\t\t\t\t\t{/* <div className=\"col-12\">\r\n\t\t\t\t\t\t\t\t<SelectField\r\n\t\t\t\t\t\t\t\t\tdisabled={isBuy ? true : false}\r\n\t\t\t\t\t\t\t\t\tisRequired={true}\r\n\t\t\t\t\t\t\t\t\tform={form}\r\n\t\t\t\t\t\t\t\t\tname=\"StudentID\"\r\n\t\t\t\t\t\t\t\t\tlabel=\"Học viên\"\r\n\t\t\t\t\t\t\t\t\toptionList={dataStudent}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div> */}\r\n\t\t\t\t\t\t\t<div className=\"col-12\">\r\n\t\t\t\t\t\t\t\t<SelectField\r\n\t\t\t\t\t\t\t\t\tonChangeSelect={(value) => onChange_SelectLevel(value)}\r\n\t\t\t\t\t\t\t\t\tisRequired={true}\r\n\t\t\t\t\t\t\t\t\tform={form}\r\n\t\t\t\t\t\t\t\t\tname=\"PriceFixExam\"\r\n\t\t\t\t\t\t\t\t\tlabel=\"Level\"\r\n\t\t\t\t\t\t\t\t\toptionList={dataLevel}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"col-12\">\r\n\t\t\t\t\t\t\t\t<InputNumberField\r\n\t\t\t\t\t\t\t\t\thandleChange={(value) => onChange_ChangeAmount(value)}\r\n\t\t\t\t\t\t\t\t\tisRequired={true}\r\n\t\t\t\t\t\t\t\t\tform={form}\r\n\t\t\t\t\t\t\t\t\tname=\"Amount\"\r\n\t\t\t\t\t\t\t\t\tlabel=\"Số lượt chấm\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"col-12\">\r\n\t\t\t\t\t\t\t\t<InputMoneyField isRequired={true} form={form} name=\"Paid\" label=\"Giá\" disabled={true} />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"col-12\">\r\n\t\t\t\t\t\t\t\t<SelectField\r\n\t\t\t\t\t\t\t\t\tisRequired={true}\r\n\t\t\t\t\t\t\t\t\tform={form}\r\n\t\t\t\t\t\t\t\t\tname=\"PaymentMethodsID\"\r\n\t\t\t\t\t\t\t\t\tlabel=\"Phương thức thanh toán\"\r\n\t\t\t\t\t\t\t\t\toptionList={[\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: 'Tiền mặt',\r\n\t\t\t\t\t\t\t\t\t\t\tvalue: 1\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: 'Chuyển khoản',\r\n\t\t\t\t\t\t\t\t\t\t\tvalue: 2\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"col-12 mb-3\">\r\n\t\t\t\t\t\t\t\t<TextAreaField form={form} name=\"Note\" label=\"Ghi chú\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"col-12 mt-5\">\r\n\t\t\t\t\t\t\t\t<button type=\"submit\" className=\"btn btn-primary w-100\">\r\n\t\t\t\t\t\t\t\t\tLưu\r\n\t\t\t\t\t\t\t\t\t{isLoading && <Spin className=\"loading-base\" />}\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</Form>\r\n\t\t\t</Modal>\r\n\t\t</>\r\n\t)\r\n}\r\n\r\nexport default PayFixExamForm\r\n"]},"metadata":{},"sourceType":"module"}