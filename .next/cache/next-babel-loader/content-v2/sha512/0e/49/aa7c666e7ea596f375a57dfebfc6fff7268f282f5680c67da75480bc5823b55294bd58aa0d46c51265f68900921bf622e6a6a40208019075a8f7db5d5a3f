{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\MonaMedia\\\\Project\\\\IELTS-NguyenHuyen-FE\\\\IELTS-Nguyen-Huyen\\\\src\\\\pages\\\\video-learning\\\\index.tsx\";\nimport { Card, Drawer, Spin } from 'antd';\nimport { useRouter } from 'next/router';\nimport React, { useEffect, useRef, useState } from 'react';\nimport 'react-circular-progressbar/dist/styles.css';\nimport { VideoCourseOfStudent, VideoCourses } from '~/apiBase/video-learning';\nimport HeaderVideo from '~/components/VideoLearning/header';\nimport VideoList from '~/components/VideoLearning/list-video';\nimport VideoTabs from '~/components/VideoLearning/tabs';\nimport { useWrap } from '~/context/wrap';\nimport { usePageVisibility } from '~/utils/functions';\nimport Lottie from 'react-lottie-player';\nimport empty from '~/components/json/empty-box.json';\nconst FAKE_IFRAME_VIDEO = 'https://www.youtube.com/embed/czXeFkQZZPs';\nlet numberRender = 1;\n\nconst useUnload = fn => {\n  const cb = useRef(fn);\n  useEffect(() => {\n    cb.current = fn;\n  }, [fn]);\n  useEffect(() => {\n    const onUnload = (...args) => {\n      var _cb$current;\n\n      return (_cb$current = cb.current) === null || _cb$current === void 0 ? void 0 : _cb$current.call(cb, ...args);\n    };\n\n    window.addEventListener('beforeunload', onUnload);\n    return () => window.removeEventListener('beforeunload', onUnload);\n  }, []);\n};\n\nconst useBeforeUnload = fn => {\n  window.onbeforeunload = function () {\n    fn();\n    return 'Bạn thật sự muốn đóng video đang xem?';\n  };\n};\n\nconst VideoLearning = () => {\n  const router = useRouter();\n  const {\n    userInformation,\n    showNoti\n  } = useWrap();\n  const videoStudy = useRef(null);\n  const {\n    0: currentVideo,\n    1: setCurrentVideo\n  } = useState(null);\n  const {\n    0: videos,\n    1: setVideos\n  } = useState([]);\n  const {\n    0: currentLession,\n    1: setCurrentLession\n  } = useState({\n    ID: '',\n    Title: '',\n    Description: '',\n    Type: 0,\n    SectionID: '',\n    Second: 0\n  });\n  useEffect(() => {\n    if (router.query.course !== undefined) {\n      getVideos();\n    }\n  }, []); // RELOAD TAB\n\n  useUnload(e => {\n    updateTime();\n    e.preventDefault();\n    e.returnValue = '';\n  }); // CLOSE WINDOW OR TAB\n\n  if (false) {\n    useBeforeUnload(() => updateTime());\n  } // HANDLE VISIT PAGE\n\n\n  const handleVisibilityChange = visible => {\n    if (videoStudy.current !== null) {\n      if (videoStudy.current.currentTime !== 0) {\n        updateTime();\n      }\n    }\n  };\n\n  usePageVisibility(handleVisibilityChange);\n\n  const updateTime = async () => {\n    if (videoStudy.current !== null) {\n      if (videoStudy.current.currentTime !== 0 && currentLession.ID !== '') {\n        let temp = {\n          VideoCourseOfStudentID: router.query.ID,\n          SectionID: currentLession.SectionID,\n          LessonID: currentLession.ID,\n          IsSeen: videoStudy.current.duration / 2 < videoStudy.current.currentTime ? 'True' : 'False',\n          // True - False: đánh dấu đã xem video\n          TimeWatched: videoStudy.current.currentTime // (giây) Thời gian đã xem video\n\n        };\n\n        try {\n          const res = await VideoCourseOfStudent.UpdateSeenAndTimeWatchedVideo(temp);\n        } catch (error) {}\n      }\n    }\n  }; // //GET DATA\n\n\n  const getVideos = async () => {\n    try {\n      const res = await VideoCourses.ListSection(router.query.course);\n      res.status == 200 && setVideos(res.data.data);\n    } catch (err) {\n      showNoti('danger', err === null || err === void 0 ? void 0 : err.message);\n    }\n  }; // // DRAWER VIDEO LIST STATE\n\n\n  const {\n    0: visible,\n    1: setVisible\n  } = useState(false);\n\n  function Iframe(props) {\n    const {\n      src\n    } = props; // console.log('src: ', src)\n\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [!!src && /*#__PURE__*/_jsxDEV(\"iframe\", {\n        id: \"video__course__iframe\",\n        className: \"responsive-iframe\",\n        ref: videoStudy,\n        src: src,\n        allowFullScreen: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 15\n      }, this), ' ', !src && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-center responsive-iframe\",\n        style: {\n          background: '#000'\n        },\n        children: /*#__PURE__*/_jsxDEV(Spin, {\n          size: \"large\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 7\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true);\n  }\n\n  console.log('--- RENDER: ', numberRender);\n  numberRender = numberRender + 1; // RENDER\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"w-video-learning custom-scroll-bar\",\n    children: [/*#__PURE__*/_jsxDEV(HeaderVideo, {\n      params: router.query,\n      onClick: () => setVisible(!visible)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row w-100 m-0 p-0 pt-3 w-main\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-9 col-12 scrollable\",\n        children: /*#__PURE__*/_jsxDEV(Card, {\n          className: \"card-main box-shadow\",\n          children: [!!currentVideo ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"video\",\n            children: /*#__PURE__*/_jsxDEV(Iframe, {\n              src: currentVideo\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 136,\n              columnNumber: 9\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 8\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"none-video\",\n            children: [/*#__PURE__*/_jsxDEV(Lottie, {\n              loop: true,\n              animationData: empty,\n              play: true,\n              className: \"inner\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"size-16 text\",\n              children: \"Kh\\xF4ng c\\xF3 video\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 142,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 139,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(VideoTabs, {\n            lession: currentLession\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-3 col-12 scrollable\",\n        children: /*#__PURE__*/_jsxDEV(Card, {\n          className: \"w-100 card-list box-shadow\",\n          children: /*#__PURE__*/_jsxDEV(VideoList, {\n            onPress: p => {\n              setCurrentLession(p);\n              p.Type === 0 ? setCurrentVideo(p.LinkVideo) : setCurrentVideo(p.LinkHtml);\n            },\n            videos: videos\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 151,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(Drawer, {\n      title: \"N\\u1ED9i dung kh\\xF3a h\\u1ECDc\",\n      placement: \"right\",\n      onClose: () => setVisible(false),\n      visible: visible,\n      className: \"video-drawer custom-scroll-bar\",\n      headerStyle: {\n        paddingTop: 24,\n        paddingBottom: 24,\n        background: '#fff'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wrap-menu-drawer \",\n        children: /*#__PURE__*/_jsxDEV(VideoList, {\n          onPress: p => {\n            setCurrentLession(p);\n            setCurrentVideo(p === null || p === void 0 ? void 0 : p.LinkVideo);\n          },\n          videos: videos\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 129,\n    columnNumber: 3\n  }, this);\n};\n\nexport default VideoLearning;","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/pages/video-learning/index.tsx"],"names":["Card","Drawer","Spin","useRouter","React","useEffect","useRef","useState","VideoCourseOfStudent","VideoCourses","HeaderVideo","VideoList","VideoTabs","useWrap","usePageVisibility","Lottie","empty","FAKE_IFRAME_VIDEO","numberRender","useUnload","fn","cb","current","onUnload","args","window","addEventListener","removeEventListener","useBeforeUnload","onbeforeunload","VideoLearning","router","userInformation","showNoti","videoStudy","currentVideo","setCurrentVideo","videos","setVideos","currentLession","setCurrentLession","ID","Title","Description","Type","SectionID","Second","query","course","undefined","getVideos","e","updateTime","preventDefault","returnValue","handleVisibilityChange","visible","currentTime","temp","VideoCourseOfStudentID","LessonID","IsSeen","duration","TimeWatched","res","UpdateSeenAndTimeWatchedVideo","error","ListSection","status","data","err","message","setVisible","Iframe","props","src","background","console","log","p","LinkVideo","LinkHtml","paddingTop","paddingBottom"],"mappings":"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","sourcesContent":["import { Card, Drawer, Spin } from 'antd'\r\nimport { useRouter } from 'next/router'\r\nimport React, { useEffect, useRef, useState } from 'react'\r\nimport 'react-circular-progressbar/dist/styles.css'\r\nimport { VideoCourseOfStudent, VideoCourses } from '~/apiBase/video-learning'\r\nimport HeaderVideo from '~/components/VideoLearning/header'\r\nimport VideoList from '~/components/VideoLearning/list-video'\r\nimport VideoTabs from '~/components/VideoLearning/tabs'\r\nimport { useWrap } from '~/context/wrap'\r\nimport { usePageVisibility } from '~/utils/functions'\r\nimport Lottie from 'react-lottie-player'\r\n\r\nimport empty from '~/components/json/empty-box.json'\r\n\r\nconst FAKE_IFRAME_VIDEO = 'https://www.youtube.com/embed/czXeFkQZZPs'\r\n\r\nlet numberRender: number = 1\r\n\r\nconst useUnload = (fn) => {\r\n\tconst cb = useRef(fn)\r\n\r\n\tuseEffect(() => {\r\n\t\tcb.current = fn\r\n\t}, [fn])\r\n\r\n\tuseEffect(() => {\r\n\t\tconst onUnload = (...args) => cb.current?.(...args)\r\n\t\twindow.addEventListener('beforeunload', onUnload)\r\n\t\treturn () => window.removeEventListener('beforeunload', onUnload)\r\n\t}, [])\r\n}\r\n\r\nconst useBeforeUnload = (fn) => {\r\n\twindow.onbeforeunload = function () {\r\n\t\tfn()\r\n\t\treturn 'Bạn thật sự muốn đóng video đang xem?'\r\n\t}\r\n}\r\n\r\nconst VideoLearning = () => {\r\n\tconst router = useRouter()\r\n\tconst { userInformation, showNoti } = useWrap()\r\n\r\n\tconst videoStudy = useRef(null)\r\n\tconst [currentVideo, setCurrentVideo] = useState(null)\r\n\tconst [videos, setVideos] = useState([])\r\n\tconst [currentLession, setCurrentLession] = useState({ ID: '', Title: '', Description: '', Type: 0, SectionID: '', Second: 0 })\r\n\r\n\tuseEffect(() => {\r\n\t\tif (router.query.course !== undefined) {\r\n\t\t\tgetVideos()\r\n\t\t}\r\n\t}, [])\r\n\r\n\t// RELOAD TAB\r\n\tuseUnload((e) => {\r\n\t\tupdateTime()\r\n\t\te.preventDefault()\r\n\t\te.returnValue = ''\r\n\t})\r\n\r\n\t// CLOSE WINDOW OR TAB\r\n\tif (typeof window !== 'undefined') {\r\n\t\tuseBeforeUnload(() => updateTime())\r\n\t}\r\n\r\n\t// HANDLE VISIT PAGE\r\n\tconst handleVisibilityChange = (visible) => {\r\n\t\tif (videoStudy.current !== null) {\r\n\t\t\tif (videoStudy.current.currentTime !== 0) {\r\n\t\t\t\tupdateTime()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tusePageVisibility(handleVisibilityChange)\r\n\r\n\tconst updateTime = async () => {\r\n\t\tif (videoStudy.current !== null) {\r\n\t\t\tif (videoStudy.current.currentTime !== 0 && currentLession.ID !== '') {\r\n\t\t\t\tlet temp = {\r\n\t\t\t\t\tVideoCourseOfStudentID: router.query.ID,\r\n\t\t\t\t\tSectionID: currentLession.SectionID,\r\n\t\t\t\t\tLessonID: currentLession.ID,\r\n\t\t\t\t\tIsSeen: videoStudy.current.duration / 2 < videoStudy.current.currentTime ? 'True' : 'False', // True - False: đánh dấu đã xem video\r\n\t\t\t\t\tTimeWatched: videoStudy.current.currentTime // (giây) Thời gian đã xem video\r\n\t\t\t\t}\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst res = await VideoCourseOfStudent.UpdateSeenAndTimeWatchedVideo(temp)\r\n\t\t\t\t} catch (error) {}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// //GET DATA\r\n\tconst getVideos = async () => {\r\n\t\ttry {\r\n\t\t\tconst res = await VideoCourses.ListSection(router.query.course)\r\n\t\t\tres.status == 200 && setVideos(res.data.data)\r\n\t\t} catch (err) {\r\n\t\t\tshowNoti('danger', err?.message)\r\n\t\t}\r\n\t}\r\n\r\n\t// // DRAWER VIDEO LIST STATE\r\n\tconst [visible, setVisible] = useState(false)\r\n\r\n\tfunction Iframe(props) {\r\n\t\tconst { src } = props\r\n\t\t// console.log('src: ', src)\r\n\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t{!!src && <iframe id=\"video__course__iframe\" className=\"responsive-iframe\" ref={videoStudy} src={src} allowFullScreen />}{' '}\r\n\t\t\t\t{!src && (\r\n\t\t\t\t\t<div className=\"flex-center responsive-iframe\" style={{ background: '#000' }}>\r\n\t\t\t\t\t\t<Spin size=\"large\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t</>\r\n\t\t)\r\n\t}\r\n\r\n\tconsole.log('--- RENDER: ', numberRender)\r\n\tnumberRender = numberRender + 1\r\n\r\n\t// RENDER\r\n\treturn (\r\n\t\t<div className=\"w-video-learning custom-scroll-bar\">\r\n\t\t\t<HeaderVideo params={router.query} onClick={() => setVisible(!visible)} />\r\n\t\t\t<div className=\"row w-100 m-0 p-0 pt-3 w-main\">\r\n\t\t\t\t<div className=\"col-md-9 col-12 scrollable\">\r\n\t\t\t\t\t<Card className=\"card-main box-shadow\">\r\n\t\t\t\t\t\t{!!currentVideo ? (\r\n\t\t\t\t\t\t\t<div className=\"video\">\r\n\t\t\t\t\t\t\t\t<Iframe src={currentVideo} />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<div className=\"none-video\">\r\n\t\t\t\t\t\t\t\t{/* @ts-ignore */}\r\n\t\t\t\t\t\t\t\t<Lottie loop animationData={empty} play className=\"inner\" />\r\n\t\t\t\t\t\t\t\t<div className=\"size-16 text\">Không có video</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t<VideoTabs lession={currentLession} />\r\n\t\t\t\t\t</Card>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"col-md-3 col-12 scrollable\">\r\n\t\t\t\t\t<Card className=\"w-100 card-list box-shadow\">\r\n\t\t\t\t\t\t<VideoList\r\n\t\t\t\t\t\t\tonPress={(p) => {\r\n\t\t\t\t\t\t\t\tsetCurrentLession(p)\r\n\t\t\t\t\t\t\t\tp.Type === 0 ? setCurrentVideo(p.LinkVideo) : setCurrentVideo(p.LinkHtml)\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tvideos={videos}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</Card>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<Drawer\r\n\t\t\t\ttitle=\"Nội dung khóa học\"\r\n\t\t\t\tplacement=\"right\"\r\n\t\t\t\tonClose={() => setVisible(false)}\r\n\t\t\t\tvisible={visible}\r\n\t\t\t\tclassName=\"video-drawer custom-scroll-bar\"\r\n\t\t\t\theaderStyle={{\r\n\t\t\t\t\tpaddingTop: 24,\r\n\t\t\t\t\tpaddingBottom: 24,\r\n\t\t\t\t\tbackground: '#fff'\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<div className=\"wrap-menu-drawer \">\r\n\t\t\t\t\t<VideoList\r\n\t\t\t\t\t\tonPress={(p) => {\r\n\t\t\t\t\t\t\tsetCurrentLession(p)\r\n\t\t\t\t\t\t\tsetCurrentVideo(p?.LinkVideo)\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tvideos={videos}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</Drawer>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport default VideoLearning\r\n"]},"metadata":{},"sourceType":"module"}