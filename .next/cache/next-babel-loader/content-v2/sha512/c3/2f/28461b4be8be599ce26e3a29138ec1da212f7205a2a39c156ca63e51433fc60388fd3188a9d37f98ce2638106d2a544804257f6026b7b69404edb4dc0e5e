{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"D:\\\\MonaMedia\\\\Project\\\\IELTS-NguyenHuyen-FE\\\\IELTS-Nguyen-Huyen\\\\src\\\\components\\\\Profile\\\\ProfileCustomer\\\\InfoPaymentCard\\\\PaymentCourseTable.tsx\",\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport moment from 'moment';\nimport PropTypes from 'prop-types';\nimport { useEffect, useRef, useState } from 'react';\nimport { invoiceApi } from '~/apiBase';\nimport { billCourseApi } from '~/apiBase/course/bill-course';\nimport { ExpandPaymentRow } from '~/components/Elements/ExpandBox';\nimport ExpandTable from '~/components/ExpandTable';\nimport { useWrap } from '~/context/wrap';\nimport { numberWithCommas } from '~/utils/functions';\nPaymentCourseTable.propTypes = {\n  studentID: PropTypes.number\n};\nPaymentCourseTable.defaultProps = {\n  studentID: 0\n};\n\nfunction PaymentCourseTable(props) {\n  _s();\n\n  var _this = this;\n\n  var studentID = props.studentID;\n\n  var _useWrap = useWrap(),\n      showNoti = _useWrap.showNoti;\n\n  var _useState = useState({\n    type: null,\n    status: false\n  }),\n      isLoading = _useState[0],\n      setIsLoading = _useState[1];\n\n  var _useState2 = useState([]),\n      paymentHistoryList = _useState2[0],\n      setPaymentHistoryList = _useState2[1];\n\n  var _useState3 = useState(null),\n      totalPage = _useState3[0],\n      setTotalPage = _useState3[1];\n\n  var _useState4 = useState([]),\n      infoInvoiceList = _useState4[0],\n      setInfoInvoiceList = _useState4[1];\n\n  var listFieldInit = {\n    pageIndex: 1,\n    pageSize: 10,\n    StudentID: studentID\n  };\n  var refValue = useRef({\n    pageIndex: 1,\n    pageSize: 10\n  });\n\n  var _useState5 = useState(listFieldInit),\n      filters = _useState5[0],\n      setFilters = _useState5[1]; // PAGINATION\n\n\n  var getPagination = function getPagination(pageIndex, pageSize) {\n    if (!pageSize) pageSize = 10;\n    refValue.current = _objectSpread(_objectSpread({}, refValue.current), {}, {\n      pageSize: pageSize,\n      pageIndex: pageIndex\n    });\n    setFilters(_objectSpread(_objectSpread({}, filters), refValue.current));\n  };\n\n  var getCourseOfStudentPrice = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              setIsLoading({\n                type: 'GET_ALL',\n                status: true\n              });\n              _context.next = 4;\n              return billCourseApi.getAll(filters);\n\n            case 4:\n              res = _context.sent;\n\n              if (res.status === 200) {\n                setPaymentHistoryList(res.data.data);\n                setTotalPage(res.data.totalRow);\n              }\n\n              _context.next = 11;\n              break;\n\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](0);\n              showNoti('danger', _context.t0.message);\n\n            case 11:\n              _context.prev = 11;\n              setIsLoading({\n                type: 'GET_ALL',\n                status: false\n              });\n              return _context.finish(11);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 8, 11, 14]]);\n    }));\n\n    return function getCourseOfStudentPrice() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    getCourseOfStudentPrice();\n  }, [filters]);\n  var columns = [{\n    title: 'Ngày tạo',\n    dataIndex: 'CreatedOn',\n    render: function render(date) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"font-weight-black\",\n        children: moment(date).format('DD/MM/YYYY')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 22\n      }, _this);\n    }\n  }, {\n    title: 'Tổng thanh toán',\n    dataIndex: 'Price',\n    render: function render(price) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        children: numberWithCommas(price)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 12\n      }, _this);\n    }\n  }, {\n    title: 'Giảm giá',\n    dataIndex: 'Reduced',\n    render: function render(price) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        children: numberWithCommas(price)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 12\n      }, _this);\n    }\n  }, {\n    title: '\tĐã thanh toán',\n    dataIndex: 'Paid',\n    render: function render(price) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        children: numberWithCommas(price)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 12\n      }, _this);\n    }\n  }, {\n    title: 'Số tiền còn lại',\n    dataIndex: 'MoneyInDebt',\n    render: function render(price) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"font-weight-primary\",\n        children: numberWithCommas(price)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 12\n      }, _this);\n    }\n  }, {\n    title: 'Hình thức',\n    dataIndex: 'PaymentMethodsName'\n  }, {\n    title: 'Ngày hẹn trả',\n    dataIndex: 'PayDate',\n    render: function render(date) {\n      return date ? moment(date).format('DD/MM/YYYY') : '';\n    }\n  }]; //\n\n  var fetchInfoInvoice = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(ID) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              setIsLoading({\n                type: 'FETCH_INFO_INVOICE',\n                status: true\n              });\n              _context2.next = 4;\n              return invoiceApi.getAll({\n                PayID: ID,\n                StyleID: 1\n              });\n\n            case 4:\n              res = _context2.sent;\n\n              if (res.status === 200) {\n                setInfoInvoiceList(res.data.data);\n              }\n\n              if (res.status === 204) {\n                setInfoInvoiceList(null);\n              }\n\n              _context2.next = 12;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.log(fetchInfoInvoice, _context2.t0.message);\n\n            case 12:\n              _context2.prev = 12;\n              setIsLoading({\n                type: 'FETCH_INFO_INVOICE',\n                status: false\n              });\n              return _context2.finish(12);\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 9, 12, 15]]);\n    }));\n\n    return function fetchInfoInvoice(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var expandableObj = {\n    expandedRowRender: function expandedRowRender(record) {\n      return /*#__PURE__*/_jsxDEV(ExpandPaymentRow, {\n        isLoading: isLoading,\n        dataRow: record,\n        infoInvoiceList: infoInvoiceList\n      }, record.ID, false, {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 4\n      }, _this);\n    },\n    onExpand: function onExpand(expanded, record) {\n      if (expanded) {\n        fetchInfoInvoice(record.ID);\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(ExpandTable, {\n    loading: isLoading,\n    currentPage: filters.pageIndex,\n    totalPage: totalPage,\n    getPagination: getPagination,\n    noScroll: true,\n    dataSource: paymentHistoryList,\n    columns: columns,\n    Extra: /*#__PURE__*/_jsxDEV(\"h5\", {\n      children: \"L\\u1ECBch s\\u1EED thanh to\\xE1n kh\\xF3a h\\u1ECDc\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 11\n    }, this),\n    expandable: expandableObj\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 162,\n    columnNumber: 3\n  }, this);\n}\n\n_s(PaymentCourseTable, \"6tlv/gy2vT3JCbYyufEgo/4OZLs=\", false, function () {\n  return [useWrap];\n});\n\n_c = PaymentCourseTable;\nexport default PaymentCourseTable;\n\nvar _c;\n\n$RefreshReg$(_c, \"PaymentCourseTable\");","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/components/Profile/ProfileCustomer/InfoPaymentCard/PaymentCourseTable.tsx"],"names":["moment","PropTypes","useEffect","useRef","useState","invoiceApi","billCourseApi","ExpandPaymentRow","ExpandTable","useWrap","numberWithCommas","PaymentCourseTable","propTypes","studentID","number","defaultProps","props","showNoti","type","status","isLoading","setIsLoading","paymentHistoryList","setPaymentHistoryList","totalPage","setTotalPage","infoInvoiceList","setInfoInvoiceList","listFieldInit","pageIndex","pageSize","StudentID","refValue","filters","setFilters","getPagination","current","getCourseOfStudentPrice","getAll","res","data","totalRow","message","columns","title","dataIndex","render","date","format","price","fetchInfoInvoice","ID","PayID","StyleID","console","log","expandableObj","expandedRowRender","record","onExpand","expanded"],"mappings":";;;;;;;;;;;;AAAA,OAAOA,MAAP,MAAmB,QAAnB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,SAAT,EAAoBC,MAApB,EAA4BC,QAA5B,QAA4C,OAA5C;AACA,SAASC,UAAT,QAA2B,WAA3B;AACA,SAASC,aAAT,QAA8B,8BAA9B;AACA,SAASC,gBAAT,QAAiC,iCAAjC;AACA,OAAOC,WAAP,MAAwB,0BAAxB;AACA,SAASC,OAAT,QAAwB,gBAAxB;AACA,SAASC,gBAAT,QAAiC,mBAAjC;AAEAC,kBAAkB,CAACC,SAAnB,GAA+B;AAC9BC,EAAAA,SAAS,EAAEZ,SAAS,CAACa;AADS,CAA/B;AAGAH,kBAAkB,CAACI,YAAnB,GAAkC;AACjCF,EAAAA,SAAS,EAAE;AADsB,CAAlC;;AAIA,SAASF,kBAAT,CAA4BK,KAA5B,EAAmC;AAAA;;AAAA;;AAAA,MAC1BH,SAD0B,GACZG,KADY,CAC1BH,SAD0B;;AAAA,iBAEbJ,OAAO,EAFM;AAAA,MAE1BQ,QAF0B,YAE1BA,QAF0B;;AAAA,kBAGAb,QAAQ,CAAC;AAC1Cc,IAAAA,IAAI,EAAE,IADoC;AAE1CC,IAAAA,MAAM,EAAE;AAFkC,GAAD,CAHR;AAAA,MAG3BC,SAH2B;AAAA,MAGhBC,YAHgB;;AAAA,mBAOkBjB,QAAQ,CAA0B,EAA1B,CAP1B;AAAA,MAO3BkB,kBAP2B;AAAA,MAOPC,qBAPO;;AAAA,mBAQAnB,QAAQ,CAAC,IAAD,CARR;AAAA,MAQ3BoB,SAR2B;AAAA,MAQhBC,YARgB;;AAAA,mBASYrB,QAAQ,CAAa,EAAb,CATpB;AAAA,MAS3BsB,eAT2B;AAAA,MASVC,kBATU;;AAWlC,MAAMC,aAAa,GAAG;AACrBC,IAAAA,SAAS,EAAE,CADU;AAErBC,IAAAA,QAAQ,EAAE,EAFW;AAIrBC,IAAAA,SAAS,EAAElB;AAJU,GAAtB;AAMA,MAAImB,QAAQ,GAAG7B,MAAM,CAAC;AACrB0B,IAAAA,SAAS,EAAE,CADU;AAErBC,IAAAA,QAAQ,EAAE;AAFW,GAAD,CAArB;;AAjBkC,mBAqBJ1B,QAAQ,CAACwB,aAAD,CArBJ;AAAA,MAqB3BK,OArB2B;AAAA,MAqBlBC,UArBkB,kBAuBlC;;;AACA,MAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACN,SAAD,EAAoBC,QAApB,EAAyC;AAC9D,QAAI,CAACA,QAAL,EAAeA,QAAQ,GAAG,EAAX;AACfE,IAAAA,QAAQ,CAACI,OAAT,mCACIJ,QAAQ,CAACI,OADb;AAECN,MAAAA,QAAQ,EAARA,QAFD;AAGCD,MAAAA,SAAS,EAATA;AAHD;AAKAK,IAAAA,UAAU,iCACND,OADM,GAEND,QAAQ,CAACI,OAFH,EAAV;AAIA,GAXD;;AAaA,MAAMC,uBAAuB;AAAA,wEAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAE9BhB,cAAAA,YAAY,CAAC;AACZH,gBAAAA,IAAI,EAAE,SADM;AAEZC,gBAAAA,MAAM,EAAE;AAFI,eAAD,CAAZ;AAF8B;AAAA,qBAMZb,aAAa,CAACgC,MAAd,CAAqBL,OAArB,CANY;;AAAA;AAMxBM,cAAAA,GANwB;;AAO9B,kBAAIA,GAAG,CAACpB,MAAJ,KAAe,GAAnB,EAAwB;AACvBI,gBAAAA,qBAAqB,CAACgB,GAAG,CAACC,IAAJ,CAASA,IAAV,CAArB;AACAf,gBAAAA,YAAY,CAACc,GAAG,CAACC,IAAJ,CAASC,QAAV,CAAZ;AACA;;AAV6B;AAAA;;AAAA;AAAA;AAAA;AAY9BxB,cAAAA,QAAQ,CAAC,QAAD,EAAW,YAAMyB,OAAjB,CAAR;;AAZ8B;AAAA;AAc9BrB,cAAAA,YAAY,CAAC;AACZH,gBAAAA,IAAI,EAAE,SADM;AAEZC,gBAAAA,MAAM,EAAE;AAFI,eAAD,CAAZ;AAd8B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAvBkB,uBAAuB;AAAA;AAAA;AAAA,KAA7B;;AAqBAnC,EAAAA,SAAS,CAAC,YAAM;AACfmC,IAAAA,uBAAuB;AACvB,GAFQ,EAEN,CAACJ,OAAD,CAFM,CAAT;AAIA,MAAMU,OAAO,GAAG,CACf;AACCC,IAAAA,KAAK,EAAE,UADR;AAECC,IAAAA,SAAS,EAAE,WAFZ;AAGCC,IAAAA,MAAM,EAAE,gBAACC,IAAD;AAAA,0BAAU;AAAG,QAAA,SAAS,EAAC,mBAAb;AAAA,kBAAkC/C,MAAM,CAAC+C,IAAD,CAAN,CAAaC,MAAb,CAAoB,YAApB;AAAlC;AAAA;AAAA;AAAA;AAAA,eAAV;AAAA;AAHT,GADe,EAMf;AACCJ,IAAAA,KAAK,EAAE,iBADR;AAECC,IAAAA,SAAS,EAAE,OAFZ;AAGCC,IAAAA,MAAM,EAAE,gBAACG,KAAD,EAAW;AAClB,0BAAO;AAAA,kBAAIvC,gBAAgB,CAACuC,KAAD;AAApB;AAAA;AAAA;AAAA;AAAA,eAAP;AACA;AALF,GANe,EAaf;AACCL,IAAAA,KAAK,EAAE,UADR;AAECC,IAAAA,SAAS,EAAE,SAFZ;AAGCC,IAAAA,MAAM,EAAE,gBAACG,KAAD,EAAW;AAClB,0BAAO;AAAA,kBAAIvC,gBAAgB,CAACuC,KAAD;AAApB;AAAA;AAAA;AAAA;AAAA,eAAP;AACA;AALF,GAbe,EAoBf;AACCL,IAAAA,KAAK,EAAE,gBADR;AAECC,IAAAA,SAAS,EAAE,MAFZ;AAGCC,IAAAA,MAAM,EAAE,gBAACG,KAAD,EAAW;AAClB,0BAAO;AAAA,kBAAIvC,gBAAgB,CAACuC,KAAD;AAApB;AAAA;AAAA;AAAA;AAAA,eAAP;AACA;AALF,GApBe,EA2Bf;AACCL,IAAAA,KAAK,EAAE,iBADR;AAECC,IAAAA,SAAS,EAAE,aAFZ;AAGCC,IAAAA,MAAM,EAAE,gBAACG,KAAD,EAAW;AAClB,0BAAO;AAAG,QAAA,SAAS,EAAC,qBAAb;AAAA,kBAAoCvC,gBAAgB,CAACuC,KAAD;AAApD;AAAA;AAAA;AAAA;AAAA,eAAP;AACA;AALF,GA3Be,EAkCf;AACCL,IAAAA,KAAK,EAAE,WADR;AAECC,IAAAA,SAAS,EAAE;AAFZ,GAlCe,EAsCf;AACCD,IAAAA,KAAK,EAAE,cADR;AAECC,IAAAA,SAAS,EAAE,SAFZ;AAGCC,IAAAA,MAAM,EAAE,gBAACC,IAAD;AAAA,aAAWA,IAAI,GAAG/C,MAAM,CAAC+C,IAAD,CAAN,CAAaC,MAAb,CAAoB,YAApB,CAAH,GAAuC,EAAtD;AAAA;AAHT,GAtCe,CAAhB,CA9DkC,CA0GlC;;AACA,MAAME,gBAAgB;AAAA,yEAAG,kBAAOC,EAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEvB9B,cAAAA,YAAY,CAAC;AACZH,gBAAAA,IAAI,EAAE,oBADM;AAEZC,gBAAAA,MAAM,EAAE;AAFI,eAAD,CAAZ;AAFuB;AAAA,qBAMLd,UAAU,CAACiC,MAAX,CAAkB;AACnCc,gBAAAA,KAAK,EAAED,EAD4B;AAEnCE,gBAAAA,OAAO,EAAE;AAF0B,eAAlB,CANK;;AAAA;AAMjBd,cAAAA,GANiB;;AAUvB,kBAAIA,GAAG,CAACpB,MAAJ,KAAe,GAAnB,EAAwB;AACvBQ,gBAAAA,kBAAkB,CAACY,GAAG,CAACC,IAAJ,CAASA,IAAV,CAAlB;AACA;;AACD,kBAAID,GAAG,CAACpB,MAAJ,KAAe,GAAnB,EAAwB;AACvBQ,gBAAAA,kBAAkB,CAAC,IAAD,CAAlB;AACA;;AAfsB;AAAA;;AAAA;AAAA;AAAA;AAiBvB2B,cAAAA,OAAO,CAACC,GAAR,CAAYL,gBAAZ,EAA8B,aAAMR,OAApC;;AAjBuB;AAAA;AAmBvBrB,cAAAA,YAAY,CAAC;AACZH,gBAAAA,IAAI,EAAE,oBADM;AAEZC,gBAAAA,MAAM,EAAE;AAFI,eAAD,CAAZ;AAnBuB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAhB+B,gBAAgB;AAAA;AAAA;AAAA,KAAtB;;AA0BA,MAAMM,aAAa,GAAG;AACrBC,IAAAA,iBAAiB,EAAE,2BAACC,MAAD;AAAA,0BAClB,QAAC,gBAAD;AAAkB,QAAA,SAAS,EAAEtC,SAA7B;AAAwD,QAAA,OAAO,EAAEsC,MAAjE;AAAyE,QAAA,eAAe,EAAEhC;AAA1F,SAA6CgC,MAAM,CAACP,EAApD;AAAA;AAAA;AAAA;AAAA,eADkB;AAAA,KADE;AAIrBQ,IAAAA,QAAQ,EAAE,kBAACC,QAAD,EAAWF,MAAX,EAAsB;AAC/B,UAAIE,QAAJ,EAAc;AACbV,QAAAA,gBAAgB,CAACQ,MAAM,CAACP,EAAR,CAAhB;AACA;AACD;AARoB,GAAtB;AAUA,sBACC,QAAC,WAAD;AACC,IAAA,OAAO,EAAE/B,SADV;AAEC,IAAA,WAAW,EAAEa,OAAO,CAACJ,SAFtB;AAGC,IAAA,SAAS,EAAEL,SAHZ;AAIC,IAAA,aAAa,EAAEW,aAJhB;AAKC,IAAA,QAAQ,MALT;AAMC,IAAA,UAAU,EAAEb,kBANb;AAOC,IAAA,OAAO,EAAEqB,OAPV;AAQC,IAAA,KAAK,eAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YARR;AASC,IAAA,UAAU,EAAEa;AATb;AAAA;AAAA;AAAA;AAAA,UADD;AAaA;;GA5JQ7C,kB;UAEaF,O;;;KAFbE,kB;AA6JT,eAAeA,kBAAf","sourcesContent":["import moment from 'moment'\r\nimport PropTypes from 'prop-types'\r\nimport { useEffect, useRef, useState } from 'react'\r\nimport { invoiceApi } from '~/apiBase'\r\nimport { billCourseApi } from '~/apiBase/course/bill-course'\r\nimport { ExpandPaymentRow } from '~/components/Elements/ExpandBox'\r\nimport ExpandTable from '~/components/ExpandTable'\r\nimport { useWrap } from '~/context/wrap'\r\nimport { numberWithCommas } from '~/utils/functions'\r\n\r\nPaymentCourseTable.propTypes = {\r\n\tstudentID: PropTypes.number\r\n}\r\nPaymentCourseTable.defaultProps = {\r\n\tstudentID: 0\r\n}\r\n\r\nfunction PaymentCourseTable(props) {\r\n\tconst { studentID } = props\r\n\tconst { showNoti } = useWrap()\r\n\tconst [isLoading, setIsLoading] = useState({\r\n\t\ttype: null,\r\n\t\tstatus: false\r\n\t})\r\n\tconst [paymentHistoryList, setPaymentHistoryList] = useState<ICourseOfStudentPrice[]>([])\r\n\tconst [totalPage, setTotalPage] = useState(null)\r\n\tconst [infoInvoiceList, setInfoInvoiceList] = useState<IInvoice[]>([])\r\n\r\n\tconst listFieldInit = {\r\n\t\tpageIndex: 1,\r\n\t\tpageSize: 10,\r\n\r\n\t\tStudentID: studentID\r\n\t}\r\n\tlet refValue = useRef({\r\n\t\tpageIndex: 1,\r\n\t\tpageSize: 10\r\n\t})\r\n\tconst [filters, setFilters] = useState(listFieldInit)\r\n\r\n\t// PAGINATION\r\n\tconst getPagination = (pageIndex: number, pageSize: number) => {\r\n\t\tif (!pageSize) pageSize = 10\r\n\t\trefValue.current = {\r\n\t\t\t...refValue.current,\r\n\t\t\tpageSize,\r\n\t\t\tpageIndex\r\n\t\t}\r\n\t\tsetFilters({\r\n\t\t\t...filters,\r\n\t\t\t...refValue.current\r\n\t\t})\r\n\t}\r\n\r\n\tconst getCourseOfStudentPrice = async () => {\r\n\t\ttry {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'GET_ALL',\r\n\t\t\t\tstatus: true\r\n\t\t\t})\r\n\t\t\tconst res = await billCourseApi.getAll(filters)\r\n\t\t\tif (res.status === 200) {\r\n\t\t\t\tsetPaymentHistoryList(res.data.data)\r\n\t\t\t\tsetTotalPage(res.data.totalRow)\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error.message)\r\n\t\t} finally {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'GET_ALL',\r\n\t\t\t\tstatus: false\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tgetCourseOfStudentPrice()\r\n\t}, [filters])\r\n\r\n\tconst columns = [\r\n\t\t{\r\n\t\t\ttitle: 'Ngày tạo',\r\n\t\t\tdataIndex: 'CreatedOn',\r\n\t\t\trender: (date) => <p className=\"font-weight-black\">{moment(date).format('DD/MM/YYYY')}</p>\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Tổng thanh toán',\r\n\t\t\tdataIndex: 'Price',\r\n\t\t\trender: (price) => {\r\n\t\t\t\treturn <p>{numberWithCommas(price)}</p>\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Giảm giá',\r\n\t\t\tdataIndex: 'Reduced',\r\n\t\t\trender: (price) => {\r\n\t\t\t\treturn <p>{numberWithCommas(price)}</p>\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: '\tĐã thanh toán',\r\n\t\t\tdataIndex: 'Paid',\r\n\t\t\trender: (price) => {\r\n\t\t\t\treturn <p>{numberWithCommas(price)}</p>\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Số tiền còn lại',\r\n\t\t\tdataIndex: 'MoneyInDebt',\r\n\t\t\trender: (price) => {\r\n\t\t\t\treturn <p className=\"font-weight-primary\">{numberWithCommas(price)}</p>\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Hình thức',\r\n\t\t\tdataIndex: 'PaymentMethodsName'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Ngày hẹn trả',\r\n\t\t\tdataIndex: 'PayDate',\r\n\t\t\trender: (date) => (date ? moment(date).format('DD/MM/YYYY') : '')\r\n\t\t}\r\n\t]\r\n\t//\r\n\tconst fetchInfoInvoice = async (ID: number) => {\r\n\t\ttry {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'FETCH_INFO_INVOICE',\r\n\t\t\t\tstatus: true\r\n\t\t\t})\r\n\t\t\tconst res = await invoiceApi.getAll({\r\n\t\t\t\tPayID: ID,\r\n\t\t\t\tStyleID: 1\r\n\t\t\t})\r\n\t\t\tif (res.status === 200) {\r\n\t\t\t\tsetInfoInvoiceList(res.data.data)\r\n\t\t\t}\r\n\t\t\tif (res.status === 204) {\r\n\t\t\t\tsetInfoInvoiceList(null)\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log(fetchInfoInvoice, error.message)\r\n\t\t} finally {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'FETCH_INFO_INVOICE',\r\n\t\t\t\tstatus: false\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tconst expandableObj = {\r\n\t\texpandedRowRender: (record) => (\r\n\t\t\t<ExpandPaymentRow isLoading={isLoading} key={record.ID} dataRow={record} infoInvoiceList={infoInvoiceList} />\r\n\t\t),\r\n\t\tonExpand: (expanded, record) => {\r\n\t\t\tif (expanded) {\r\n\t\t\t\tfetchInfoInvoice(record.ID)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn (\r\n\t\t<ExpandTable\r\n\t\t\tloading={isLoading}\r\n\t\t\tcurrentPage={filters.pageIndex}\r\n\t\t\ttotalPage={totalPage}\r\n\t\t\tgetPagination={getPagination}\r\n\t\t\tnoScroll\r\n\t\t\tdataSource={paymentHistoryList}\r\n\t\t\tcolumns={columns}\r\n\t\t\tExtra={<h5>Lịch sử thanh toán khóa học</h5>}\r\n\t\t\texpandable={expandableObj}\r\n\t\t/>\r\n\t)\r\n}\r\nexport default PaymentCourseTable\r\n"]},"metadata":{},"sourceType":"module"}