{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\MonaMedia\\\\Project\\\\IELTS-NguyenHuyen-FE\\\\IELTS-Nguyen-Huyen\\\\src\\\\pages\\\\course\\\\calendar\\\\index.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Card } from 'antd';\nimport moment from 'moment';\nimport { useRouter } from 'next/router';\nimport React, { useLayoutEffect } from 'react';\nimport { useState } from 'react';\nimport { CalendarApi } from '~/apiBase/Calendar/calendar';\nimport CourseCalendar from '~/components/CourseCalendar';\nimport FillterCalendar from '~/components/Global/Option/FilterTable/FillterCalendar';\nimport LayoutBase from '~/components/LayoutBase';\nimport { useWrap } from '~/context/wrap';\nimport socketIOClient from 'socket.io-client';\nconst _HOST = 'ischau.herokuapp.com';\nlet socketIO = '';\nconst now = new Date();\n\nconst getNum = num => {\n  return num > 9 ? num : '0' + num;\n};\n\nconst todoApiInit = {\n  status: null,\n  teacherId: null,\n  fromDate: moment(now).format('YYYY/MM') + '/01',\n  toDate: moment(now).format('YYYY') + '/' + getNum(parseInt(moment(now).format('MM')) + 1) + '/01'\n};\nconst options = {\n  status: {\n    teacher: [{\n      ID: null,\n      title: 'Tất cả'\n    }, {\n      ID: 1,\n      title: 'Đang mở'\n    }, {\n      ID: 2,\n      title: 'Đã hủy'\n    }, {\n      ID: 3,\n      title: 'Đã đặt lịch'\n    }, {\n      ID: 4,\n      title: 'Đã hoàn thành'\n    }, {\n      ID: 5,\n      title: 'Đã xác nhận dạy'\n    }, {\n      ID: 6,\n      title: 'Sự cố'\n    }, {\n      ID: 7,\n      title: 'Đang diễn ra'\n    }, {\n      ID: 8,\n      title: 'Đã kết thúc'\n    }, {\n      ID: 9,\n      title: 'Đã tạo phòng'\n    }],\n    student: [{\n      ID: null,\n      title: 'Tất cả'\n    }, {\n      ID: 1,\n      title: 'Đang mở'\n    }, {\n      ID: 3,\n      title: 'Đã đặt lịch'\n    }, {\n      ID: 4,\n      title: 'Đã hoàn thành'\n    }, {\n      ID: 5,\n      title: 'Đã xác nhận dạy'\n    }, {\n      ID: 6,\n      title: 'Sự cố'\n    }, {\n      ID: 7,\n      title: 'Đang diễn ra'\n    }, {\n      ID: 8,\n      title: 'Đã kết thúc'\n    }, {\n      ID: 9,\n      title: 'Đã tạo phòng'\n    }]\n  }\n};\n\nconst CouCalen = () => {\n  const {\n    getTitlePage,\n    showNoti,\n    userInformation\n  } = useWrap();\n  const {\n    0: calendarEvents,\n    1: setEvents\n  } = useState([]);\n  const {\n    0: videoCourses,\n    1: setVideoCourses\n  } = useState([]);\n  const {\n    0: todoApi,\n    1: setTodoApi\n  } = useState(todoApiInit);\n  const route = useRouter();\n  const query = route.query;\n\n  const isTeach = () => {\n    return !!userInformation && userInformation.RoleID == 2 ? true : false;\n  };\n\n  const isAdOrTeach = () => {\n    return !!userInformation && (userInformation.RoleID == 1 || isTeach()) ? true : false;\n  };\n\n  const socket = () => {\n    if (socketIO !== '') {\n      socketIO.disconnect();\n    } // @ts-ignore\n\n\n    socketIO = socketIOClient.connect(_HOST);\n    socketIO.on('getId', data => {\n      console.log(data);\n    });\n    socketIO.on('teacher-change-data', dataGot => {\n      // console.log('teacher-change-data: ', dataGot)\n      if (!isTeach()) {\n        let data = dataGot === null || dataGot === void 0 ? void 0 : dataGot.data;\n\n        if ((data === null || data === void 0 ? void 0 : data.Teacher) == (query === null || query === void 0 ? void 0 : query.teacher)) {\n          getTeacherEvents();\n        } else {\n          for (let i = 0; i < calendarEvents.length; i++) {\n            const e = calendarEvents[i];\n\n            if ((data === null || data === void 0 ? void 0 : data.ID) == (e === null || e === void 0 ? void 0 : e.ID)) {\n              // console.log('data?.ID == e?.ID')\n              getTeacherEvents();\n            }\n          }\n        }\n      }\n    });\n    socketIO.on('student-change-data', dataGot => {\n      if (isTeach()) {\n        let data = dataGot === null || dataGot === void 0 ? void 0 : dataGot.data;\n\n        for (let i = 0; i < calendarEvents.length; i++) {\n          const e = calendarEvents[i];\n\n          if ((data === null || data === void 0 ? void 0 : data.ID) == (e === null || e === void 0 ? void 0 : e.ID)) {\n            getTeacherEvents();\n          }\n        }\n      }\n    });\n    return () => {\n      socketIO.disconnect();\n    };\n  };\n\n  const teacherChangeData = param => {\n    socketIO.emit('teacher-change-data', param);\n  };\n\n  const studentChangeData = param => {\n    socketIO.emit('student-change-data', param);\n  };\n\n  const callApi = () => {\n    isAdOrTeach() ? setTodoApi(_objectSpread(_objectSpread({}, todoApi), {}, {\n      teacherId: userInformation === null || userInformation === void 0 ? void 0 : userInformation.UserInformationID\n    })) : !!(query !== null && query !== void 0 && query.teacher) ? setTodoApi(_objectSpread(_objectSpread({}, todoApi), {}, {\n      teacherId: parseInt(query.teacher)\n    })) : setTodoApi(_objectSpread(_objectSpread({}, todoApi), {}, {\n      teacherId: 0\n    }));\n  };\n\n  const _leave = async () => {\n    if (!!(query !== null && query !== void 0 && query.ID)) {\n      try {\n        if (isTeach()) {\n          const parseID = parseInt(query === null || query === void 0 ? void 0 : query.ID.toString());\n          await CalendarApi.exitRoom(parseID);\n          teacherChangeData({\n            Teacher: userInformation.UserInformationID,\n            ID: query === null || query === void 0 ? void 0 : query.ID\n          });\n        }\n\n        callApi();\n      } catch (error) {\n        callApi();\n      }\n    } else {\n      callApi();\n    }\n  };\n\n  useLayoutEffect(() => {\n    if (!!userInformation) {\n      _leave();\n    }\n  }, [userInformation]);\n  useLayoutEffect(() => {\n    if (!!userInformation) {\n      _leave();\n    }\n  }, []);\n  useLayoutEffect(() => {\n    todoApi !== todoApiInit && getTeacherEvents();\n  }, [todoApi]);\n\n  const _getData = () => {\n    isAdOrTeach() && getTeacherEvents();\n  };\n\n  const getID = () => {\n    return isAdOrTeach() ? userInformation === null || userInformation === void 0 ? void 0 : userInformation.UserInformationID : !!(query !== null && query !== void 0 && query.teacher) ? parseInt(query.teacher) : 0;\n  };\n\n  useLayoutEffect(() => {\n    socket();\n  }, [calendarEvents]);\n\n  const getTeacherEvents = async () => {\n    try {\n      const res = await CalendarApi.getCalendarEvents(_objectSpread(_objectSpread({}, todoApi), {}, {\n        teacherId: getID()\n      }));\n\n      if (res.status == 200) {\n        setEvents(res.data.data);\n      }\n    } catch (error) {\n      showNoti('danger', error === null || error === void 0 ? void 0 : error.message);\n    } finally {\n      isTeach() && getVideoCourseCalendar();\n    }\n  };\n\n  const getVideoCourseCalendar = async () => {\n    try {\n      const res = await CalendarApi.getOpenCalendar();\n      res.status == 200 && setVideoCourses(res.data.data);\n    } catch (error) {\n      showNoti('danger', error === null || error === void 0 ? void 0 : error.message);\n    }\n  };\n\n  const _formatEvents = param => {\n    let temp = [];\n\n    if (!!param) {\n      for (let i = 0; i < param.length; i++) {\n        let event = param[i];\n        temp.push({\n          id: event === null || event === void 0 ? void 0 : event.ID,\n          name: event === null || event === void 0 ? void 0 : event.Title,\n          title: (event === null || event === void 0 ? void 0 : event.sTime) + ' - ' + (event === null || event === void 0 ? void 0 : event.eTime),\n          allDay: false,\n          start: new Date(event === null || event === void 0 ? void 0 : event.sDateTime),\n          end: new Date(event === null || event === void 0 ? void 0 : event.eDateTime),\n          sTime: event === null || event === void 0 ? void 0 : event.sTime,\n          eTime: event === null || event === void 0 ? void 0 : event.eTime,\n          OpenDate: event === null || event === void 0 ? void 0 : event.OpenDate,\n          resource: event\n        });\n      }\n    }\n\n    return temp;\n  };\n\n  const _reset = () => {\n    setTodoApi(_objectSpread(_objectSpread({}, todoApiInit), {}, {\n      pageIndex: 1\n    }));\n  };\n\n  const _filter = paramFilter => {\n    let newTodoApi = _objectSpread(_objectSpread({}, todoApiInit), paramFilter);\n\n    setTodoApi(newTodoApi);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Card, {\n    title: /*#__PURE__*/_jsxDEV(FillterCalendar, {\n      handleReset: _reset,\n      data: options,\n      handleFilter: value => _filter(value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 16\n    }, this),\n    children: [getTitlePage(`Quản lý lịch ${isAdOrTeach() ? 'dạy' : 'học'}`), /*#__PURE__*/_jsxDEV(CourseCalendar, {\n      onRangeChange: e => setTodoApi(_objectSpread(_objectSpread({}, todoApi), {}, {\n        fromDate: e === null || e === void 0 ? void 0 : e.fromDate,\n        toDate: e === null || e === void 0 ? void 0 : e.toDate\n      })),\n      getData: getTeacherEvents,\n      events: _formatEvents(calendarEvents),\n      courses: videoCourses,\n      teacherChangeData: teacherChangeData,\n      studentChangeData: studentChangeData\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 241,\n    columnNumber: 3\n  }, this);\n};\n\nCouCalen.layout = LayoutBase;\nexport default CouCalen;","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/pages/course/calendar/index.tsx"],"names":["Card","moment","useRouter","React","useLayoutEffect","useState","CalendarApi","CourseCalendar","FillterCalendar","LayoutBase","useWrap","socketIOClient","_HOST","socketIO","now","Date","getNum","num","todoApiInit","status","teacherId","fromDate","format","toDate","parseInt","options","teacher","ID","title","student","CouCalen","getTitlePage","showNoti","userInformation","calendarEvents","setEvents","videoCourses","setVideoCourses","todoApi","setTodoApi","route","query","isTeach","RoleID","isAdOrTeach","socket","disconnect","connect","on","data","console","log","dataGot","Teacher","getTeacherEvents","i","length","e","teacherChangeData","param","emit","studentChangeData","callApi","UserInformationID","_leave","parseID","toString","exitRoom","error","_getData","getID","res","getCalendarEvents","message","getVideoCourseCalendar","getOpenCalendar","_formatEvents","temp","event","push","id","name","Title","sTime","eTime","allDay","start","sDateTime","end","eDateTime","OpenDate","resource","_reset","pageIndex","_filter","paramFilter","newTodoApi","value","layout"],"mappings":"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","sourcesContent":["import { Card } from 'antd'\r\nimport moment from 'moment'\r\nimport { useRouter } from 'next/router'\r\nimport React, { useEffect, useLayoutEffect } from 'react'\r\nimport { useState } from 'react'\r\nimport { CalendarApi } from '~/apiBase/Calendar/calendar'\r\nimport CourseCalendar from '~/components/CourseCalendar'\r\nimport FillterCalendar from '~/components/Global/Option/FilterTable/FillterCalendar'\r\nimport LayoutBase from '~/components/LayoutBase'\r\nimport { useWrap } from '~/context/wrap'\r\nimport socketIOClient from 'socket.io-client'\r\n\r\nconst _HOST = 'ischau.herokuapp.com'\r\n\r\nlet socketIO: any = ''\r\n\r\nconst now = new Date()\r\n\r\nconst getNum = (num) => {\r\n\treturn num > 9 ? num : '0' + num\r\n}\r\n\r\nconst todoApiInit = {\r\n\tstatus: null,\r\n\tteacherId: null,\r\n\tfromDate: moment(now).format('YYYY/MM') + '/01',\r\n\ttoDate: moment(now).format('YYYY') + '/' + getNum(parseInt(moment(now).format('MM')) + 1) + '/01'\r\n}\r\n\r\nconst options = {\r\n\tstatus: {\r\n\t\tteacher: [\r\n\t\t\t{ ID: null, title: 'Tất cả' },\r\n\t\t\t{ ID: 1, title: 'Đang mở' },\r\n\t\t\t{ ID: 2, title: 'Đã hủy' },\r\n\t\t\t{ ID: 3, title: 'Đã đặt lịch' },\r\n\t\t\t{ ID: 4, title: 'Đã hoàn thành' },\r\n\t\t\t{ ID: 5, title: 'Đã xác nhận dạy' },\r\n\t\t\t{ ID: 6, title: 'Sự cố' },\r\n\t\t\t{ ID: 7, title: 'Đang diễn ra' },\r\n\t\t\t{ ID: 8, title: 'Đã kết thúc' },\r\n\t\t\t{ ID: 9, title: 'Đã tạo phòng' }\r\n\t\t],\r\n\t\tstudent: [\r\n\t\t\t{ ID: null, title: 'Tất cả' },\r\n\t\t\t{ ID: 1, title: 'Đang mở' },\r\n\t\t\t{ ID: 3, title: 'Đã đặt lịch' },\r\n\t\t\t{ ID: 4, title: 'Đã hoàn thành' },\r\n\t\t\t{ ID: 5, title: 'Đã xác nhận dạy' },\r\n\t\t\t{ ID: 6, title: 'Sự cố' },\r\n\t\t\t{ ID: 7, title: 'Đang diễn ra' },\r\n\t\t\t{ ID: 8, title: 'Đã kết thúc' },\r\n\t\t\t{ ID: 9, title: 'Đã tạo phòng' }\r\n\t\t]\r\n\t}\r\n}\r\n\r\nconst CouCalen = () => {\r\n\tconst { getTitlePage, showNoti, userInformation } = useWrap()\r\n\r\n\tconst [calendarEvents, setEvents] = useState([])\r\n\tconst [videoCourses, setVideoCourses] = useState([])\r\n\tconst [todoApi, setTodoApi] = useState<any>(todoApiInit)\r\n\r\n\tconst route = useRouter()\r\n\r\n\tconst query: any = route.query\r\n\r\n\tconst isTeach = () => {\r\n\t\treturn !!userInformation && userInformation.RoleID == 2 ? true : false\r\n\t}\r\n\r\n\tconst isAdOrTeach = () => {\r\n\t\treturn !!userInformation && (userInformation.RoleID == 1 || isTeach()) ? true : false\r\n\t}\r\n\r\n\tconst socket = () => {\r\n\t\tif (socketIO !== '') {\r\n\t\t\tsocketIO.disconnect()\r\n\t\t}\r\n\r\n\t\t// @ts-ignore\r\n\t\tsocketIO = socketIOClient.connect(_HOST)\r\n\r\n\t\tsocketIO.on('getId', (data) => {\r\n\t\t\tconsole.log(data)\r\n\t\t})\r\n\r\n\t\tsocketIO.on('teacher-change-data', (dataGot) => {\r\n\t\t\t// console.log('teacher-change-data: ', dataGot)\r\n\r\n\t\t\tif (!isTeach()) {\r\n\t\t\t\tlet data = dataGot?.data\r\n\t\t\t\tif (data?.Teacher == query?.teacher) {\r\n\t\t\t\t\tgetTeacherEvents()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (let i = 0; i < calendarEvents.length; i++) {\r\n\t\t\t\t\t\tconst e = calendarEvents[i]\r\n\t\t\t\t\t\tif (data?.ID == e?.ID) {\r\n\t\t\t\t\t\t\t// console.log('data?.ID == e?.ID')\r\n\r\n\t\t\t\t\t\t\tgetTeacherEvents()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tsocketIO.on('student-change-data', (dataGot) => {\r\n\t\t\tif (isTeach()) {\r\n\t\t\t\tlet data = dataGot?.data\r\n\t\t\t\tfor (let i = 0; i < calendarEvents.length; i++) {\r\n\t\t\t\t\tconst e = calendarEvents[i]\r\n\t\t\t\t\tif (data?.ID == e?.ID) {\r\n\t\t\t\t\t\tgetTeacherEvents()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\treturn () => {\r\n\t\t\tsocketIO.disconnect()\r\n\t\t}\r\n\t}\r\n\r\n\tconst teacherChangeData = (param: any) => {\r\n\t\tsocketIO.emit('teacher-change-data', param)\r\n\t}\r\n\r\n\tconst studentChangeData = (param: any) => {\r\n\t\tsocketIO.emit('student-change-data', param)\r\n\t}\r\n\r\n\tconst callApi = () => {\r\n\t\tisAdOrTeach()\r\n\t\t\t? setTodoApi({ ...todoApi, teacherId: userInformation?.UserInformationID })\r\n\t\t\t: !!query?.teacher\r\n\t\t\t? setTodoApi({ ...todoApi, teacherId: parseInt(query.teacher) })\r\n\t\t\t: setTodoApi({ ...todoApi, teacherId: 0 })\r\n\t}\r\n\r\n\tconst _leave = async () => {\r\n\t\tif (!!query?.ID) {\r\n\t\t\ttry {\r\n\t\t\t\tif (isTeach()) {\r\n\t\t\t\t\tconst parseID = parseInt(query?.ID.toString())\r\n\t\t\t\t\tawait CalendarApi.exitRoom(parseID)\r\n\t\t\t\t\tteacherChangeData({ Teacher: userInformation.UserInformationID, ID: query?.ID })\r\n\t\t\t\t}\r\n\t\t\t\tcallApi()\r\n\t\t\t} catch (error) {\r\n\t\t\t\tcallApi()\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcallApi()\r\n\t\t}\r\n\t}\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\tif (!!userInformation) {\r\n\t\t\t_leave()\r\n\t\t}\r\n\t}, [userInformation])\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\tif (!!userInformation) {\r\n\t\t\t_leave()\r\n\t\t}\r\n\t}, [])\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\ttodoApi !== todoApiInit && getTeacherEvents()\r\n\t}, [todoApi])\r\n\r\n\tconst _getData = () => {\r\n\t\tisAdOrTeach() && getTeacherEvents()\r\n\t}\r\n\r\n\tconst getID = () => {\r\n\t\treturn isAdOrTeach() ? userInformation?.UserInformationID : !!query?.teacher ? parseInt(query.teacher) : 0\r\n\t}\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\tsocket()\r\n\t}, [calendarEvents])\r\n\r\n\tconst getTeacherEvents = async () => {\r\n\t\ttry {\r\n\t\t\tconst res: any = await CalendarApi.getCalendarEvents({ ...todoApi, teacherId: getID() })\r\n\t\t\tif (res.status == 200) {\r\n\t\t\t\tsetEvents(res.data.data)\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error?.message)\r\n\t\t} finally {\r\n\t\t\tisTeach() && getVideoCourseCalendar()\r\n\t\t}\r\n\t}\r\n\r\n\tconst getVideoCourseCalendar = async () => {\r\n\t\ttry {\r\n\t\t\tconst res: any = await CalendarApi.getOpenCalendar()\r\n\t\t\tres.status == 200 && setVideoCourses(res.data.data)\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error?.message)\r\n\t\t}\r\n\t}\r\n\r\n\tconst _formatEvents = (param: any) => {\r\n\t\tlet temp: any = []\r\n\t\tif (!!param) {\r\n\t\t\tfor (let i = 0; i < param.length; i++) {\r\n\t\t\t\tlet event = param[i]\r\n\t\t\t\ttemp.push({\r\n\t\t\t\t\tid: event?.ID,\r\n\t\t\t\t\tname: event?.Title,\r\n\t\t\t\t\ttitle: event?.sTime + ' - ' + event?.eTime,\r\n\t\t\t\t\tallDay: false,\r\n\t\t\t\t\tstart: new Date(event?.sDateTime),\r\n\t\t\t\t\tend: new Date(event?.eDateTime),\r\n\t\t\t\t\tsTime: event?.sTime,\r\n\t\t\t\t\teTime: event?.eTime,\r\n\t\t\t\t\tOpenDate: event?.OpenDate,\r\n\t\t\t\t\tresource: event\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn temp\r\n\t}\r\n\r\n\tconst _reset = () => {\r\n\t\tsetTodoApi({ ...todoApiInit, pageIndex: 1 })\r\n\t}\r\n\r\n\tconst _filter = (paramFilter: any) => {\r\n\t\tlet newTodoApi = { ...todoApiInit, ...paramFilter }\r\n\t\tsetTodoApi(newTodoApi)\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Card title={<FillterCalendar handleReset={_reset} data={options} handleFilter={(value: any) => _filter(value)} />}>\r\n\t\t\t{getTitlePage(`Quản lý lịch ${isAdOrTeach() ? 'dạy' : 'học'}`)}\r\n\t\t\t<CourseCalendar\r\n\t\t\t\tonRangeChange={(e: any) => setTodoApi({ ...todoApi, fromDate: e?.fromDate, toDate: e?.toDate })}\r\n\t\t\t\tgetData={getTeacherEvents}\r\n\t\t\t\tevents={_formatEvents(calendarEvents)}\r\n\t\t\t\tcourses={videoCourses}\r\n\t\t\t\tteacherChangeData={teacherChangeData}\r\n\t\t\t\tstudentChangeData={studentChangeData}\r\n\t\t\t/>\r\n\t\t</Card>\r\n\t)\r\n}\r\n\r\nCouCalen.layout = LayoutBase\r\nexport default CouCalen\r\n"]},"metadata":{},"sourceType":"module"}