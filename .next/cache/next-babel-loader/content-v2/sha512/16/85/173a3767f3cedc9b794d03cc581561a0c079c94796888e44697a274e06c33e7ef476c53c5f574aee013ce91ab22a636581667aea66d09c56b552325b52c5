{"ast":null,"code":"import _defineProperty from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport axios from 'axios';\nimport { getSession, signIn } from 'next-auth/client';\n\nfunction getUrl(config) {\n  if (config.baseURL) {\n    return config.url.replace(config.baseURL, '').split('?')[0];\n  }\n\n  return config.url;\n}\n\nexport var authHeader_X = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var session;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return getSession();\n\n          case 2:\n            session = _context.sent;\n\n            if (!(session && session.accessToken)) {\n              _context.next = 7;\n              break;\n            }\n\n            return _context.abrupt(\"return\", {\n              token: session.accessToken\n            });\n\n          case 7:\n            return _context.abrupt(\"return\", {});\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function authHeader_X() {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var authHeader_Bearer = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    var session;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return getSession();\n\n          case 2:\n            session = _context2.sent;\n\n            if (!(session && session.accessToken)) {\n              _context2.next = 7;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", {\n              Authorization: 'Bearer ' + session.accessToken\n            });\n\n          case 7:\n            return _context2.abrupt(\"return\", {});\n\n          case 8:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function authHeader_Bearer() {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var instance = axios.create({\n  baseURL: process.env.NEXT_PUBLIC_API_ENDPOINT,\n  headers: {\n    Accept: 'application/json'\n  }\n});\ninstance.interceptors.request.use( /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(config) {\n    var url, authHeader;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            url = getUrl(config);\n\n            if (url.toString().includes('/auth/')) {\n              _context3.next = 6;\n              break;\n            }\n\n            _context3.next = 4;\n            return authHeader_X();\n\n          case 4:\n            authHeader = _context3.sent;\n            config.headers = _objectSpread(_objectSpread({}, config.headers), authHeader);\n\n          case 6:\n            if (url !== '/api/Idioms/getRandoms' && url !== '/api/Rules') {\n              console.log(\"%c \".concat(config.method.toUpperCase(), \" - \").concat(url, \":\"), 'color: #0086b3; font-weight: bold', config);\n            }\n\n            return _context3.abrupt(\"return\", config);\n\n          case 8:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function (_x) {\n    return _ref3.apply(this, arguments);\n  };\n}(), function (error) {\n  var _error$response, _error$response2;\n\n  console.log(\"%c \".concat(error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status, \"  :\"), 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data);\n  return Promise.reject(error);\n});\n\nvar checkResponse = function checkResponse(error) {\n  var _error$response3, _error$response4;\n\n  switch (error === null || error === void 0 ? void 0 : (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.status) {\n    case 401:\n      setTimeout(function () {\n        signIn();\n      }, 1000);\n      break;\n\n    case 403:\n      alert('Bạn không có quyền thực hiện');\n      break;\n\n    case 400:\n      console.log(error === null || error === void 0 ? void 0 : (_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.message);\n      break;\n\n    default:\n      console.log(\"%c \".concat(error === null || error === void 0 ? void 0 : error.response, \"  :\"), 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : error.response);\n  }\n};\n\ninstance.interceptors.response.use(function (response) {\n  var url = getUrl(response === null || response === void 0 ? void 0 : response.config);\n\n  if (url !== '/api/Idioms/getRandoms' && url !== '/api/Rules') {\n    console.log(\" %c \".concat(response === null || response === void 0 ? void 0 : response.status, \" - \").concat(getUrl(response === null || response === void 0 ? void 0 : response.config), \":\"), 'color: #008000; font-weight: bold', response);\n  }\n\n  return response;\n}, function (error) {\n  if (error.response) {\n    var _error$response5, _error$response6;\n\n    checkResponse(error); // server trả response về là lỗi code đã handle\n\n    console.log(\"%c \".concat(error === null || error === void 0 ? void 0 : (_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : _error$response5.status, \"  :\"), 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : (_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : _error$response6.data);\n    return Promise.reject(error);\n  } else if (error.request) {\n    var _error$response7;\n\n    // request mãi mãi ko thấy response\n    // `error.request` là XMLHttpRequest trong website còn nodejs là http.ClientRequest\n    console.log(\"%c \".concat(JSON.stringify(error), \"  :\"), 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : (_error$response7 = error.response) === null || _error$response7 === void 0 ? void 0 : _error$response7.data);\n    return Promise.reject(error);\n  } else {\n    // có gì đó sai sai, hình như là hàm request sai\n    console.log(\"%c \".concat(JSON.stringify(error), \"  :\"), 'color: red; font-weight: bold', 'có gì đó sai sai, hình như là setting sai');\n    return Promise.reject(error);\n  }\n});","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/apiBase/instance.ts"],"names":["axios","getSession","signIn","getUrl","config","baseURL","url","replace","split","authHeader_X","session","accessToken","token","authHeader_Bearer","Authorization","instance","create","process","env","NEXT_PUBLIC_API_ENDPOINT","headers","Accept","interceptors","request","use","toString","includes","authHeader","console","log","method","toUpperCase","error","response","status","data","Promise","reject","checkResponse","setTimeout","alert","message","JSON","stringify"],"mappings":"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","sourcesContent":["import axios, { AxiosRequestConfig, AxiosResponse } from 'axios'\r\nimport { getSession, signIn } from 'next-auth/client'\r\n\r\nfunction getUrl(config) {\r\n\tif (config.baseURL) {\r\n\t\treturn config.url.replace(config.baseURL, '').split('?')[0]\r\n\t}\r\n\treturn config.url\r\n}\r\n\r\nexport const authHeader_X = async () => {\r\n\tconst session = await getSession()\r\n\tif (session && session.accessToken) {\r\n\t\treturn { token: session.accessToken }\r\n\t} else {\r\n\t\treturn {}\r\n\t}\r\n}\r\nexport const authHeader_Bearer = async () => {\r\n\tconst session = await getSession()\r\n\r\n\tif (session && session.accessToken) {\r\n\t\treturn { Authorization: 'Bearer ' + session.accessToken }\r\n\t} else {\r\n\t\treturn {}\r\n\t}\r\n}\r\n\r\nexport const instance = axios.create({\r\n\tbaseURL: process.env.NEXT_PUBLIC_API_ENDPOINT,\r\n\theaders: {\r\n\t\tAccept: 'application/json'\r\n\t}\r\n})\r\n\r\ninstance.interceptors.request.use(\r\n\tasync (config: AxiosRequestConfig) => {\r\n\t\tconst url = getUrl(config)\r\n\t\tif (!url.toString().includes('/auth/')) {\r\n\t\t\tconst authHeader = await authHeader_X()\r\n\t\t\tconfig.headers = {\r\n\t\t\t\t...config.headers,\r\n\t\t\t\t...authHeader\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (url !== '/api/Idioms/getRandoms' && url !== '/api/Rules') {\r\n\t\t\tconsole.log(`%c ${config.method.toUpperCase()} - ${url}:`, 'color: #0086b3; font-weight: bold', config)\r\n\t\t}\r\n\t\treturn config\r\n\t},\r\n\t(error) => {\r\n\t\tconsole.log(`%c ${error?.response?.status}  :`, 'color: red; font-weight: bold', error?.response?.data)\r\n\t\treturn Promise.reject(error)\r\n\t}\r\n)\r\n\r\nconst checkResponse = (error) => {\r\n\tswitch (error?.response?.status) {\r\n\t\tcase 401:\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tsignIn()\r\n\t\t\t}, 1000)\r\n\t\t\tbreak\r\n\t\tcase 403:\r\n\t\t\talert('Bạn không có quyền thực hiện')\r\n\t\t\tbreak\r\n\t\tcase 400:\r\n\t\t\tconsole.log(error?.response?.message)\r\n\t\t\tbreak\r\n\t\tdefault:\r\n\t\t\tconsole.log(`%c ${error?.response}  :`, 'color: red; font-weight: bold', error?.response)\r\n\t}\r\n}\r\n\r\ninstance.interceptors.response.use(\r\n\t(response: AxiosResponse) => {\r\n\t\tlet url = getUrl(response?.config)\r\n\t\tif (url !== '/api/Idioms/getRandoms' && url !== '/api/Rules') {\r\n\t\t\tconsole.log(` %c ${response?.status} - ${getUrl(response?.config)}:`, 'color: #008000; font-weight: bold', response)\r\n\t\t}\r\n\t\treturn response\r\n\t},\r\n\tfunction (error) {\r\n\t\tif (error.response) {\r\n\t\t\tcheckResponse(error)\r\n\t\t\t// server trả response về là lỗi code đã handle\r\n\t\t\tconsole.log(`%c ${error?.response?.status}  :`, 'color: red; font-weight: bold', error?.response?.data)\r\n\t\t\treturn Promise.reject(error)\r\n\t\t} else if (error.request) {\r\n\t\t\t// request mãi mãi ko thấy response\r\n\t\t\t// `error.request` là XMLHttpRequest trong website còn nodejs là http.ClientRequest\r\n\t\t\tconsole.log(`%c ${JSON.stringify(error)}  :`, 'color: red; font-weight: bold', error?.response?.data)\r\n\t\t\treturn Promise.reject(error)\r\n\t\t} else {\r\n\t\t\t// có gì đó sai sai, hình như là hàm request sai\r\n\t\t\tconsole.log(`%c ${JSON.stringify(error)}  :`, 'color: red; font-weight: bold', 'có gì đó sai sai, hình như là setting sai')\r\n\t\t\treturn Promise.reject(error)\r\n\t\t}\r\n\t}\r\n)\r\n"]},"metadata":{},"sourceType":"module"}