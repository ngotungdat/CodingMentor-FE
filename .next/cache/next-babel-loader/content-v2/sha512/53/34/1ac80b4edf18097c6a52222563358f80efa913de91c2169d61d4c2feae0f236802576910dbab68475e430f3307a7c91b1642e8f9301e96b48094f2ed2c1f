{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\MonaMedia\\\\Project\\\\IELTS-NguyenHuyen-FE\\\\IELTS-Nguyen-Huyen\\\\src\\\\components\\\\Global\\\\Option\\\\DayOff\\\\DayOff.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport moment from 'moment';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { dayOffApi } from '~/apiBase';\nimport DeleteTableRow from '~/components/Elements/DeleteTableRow/DeleteTableRow';\nimport SortBox from '~/components/Elements/SortBox';\nimport DayOffForm from '~/components/Global/Option/DayOff/DayOffForm';\nimport PowerTable from '~/components/PowerTable';\nimport FilterColumn from '~/components/Tables/FilterColumn';\nimport { useWrap } from '~/context/wrap';\nimport DayOffFilterForm from './DayOffFilterForm';\n\nconst DayOff = () => {\n  const {\n    0: dayOffList,\n    1: setDayOffList\n  } = useState([]);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState({\n    type: '',\n    status: false\n  });\n  const {\n    0: totalPage,\n    1: setTotalPage\n  } = useState(null);\n  const {\n    showNoti,\n    pageSize,\n    isAdmin\n  } = useWrap();\n  const {\n    0: activeColumnSearch,\n    1: setActiveColumnSearch\n  } = useState(''); // FILTER\n\n  const listFieldInit = {\n    pageIndex: 1,\n    pageSize: pageSize,\n    sort: -1,\n    sortType: false,\n    DayOff: '',\n    DayOffName: '',\n    fromDate: '',\n    toDate: ''\n  };\n  let refValue = useRef({\n    pageIndex: 1,\n    pageSize: 10,\n    sort: -1,\n    sortType: false\n  });\n  const {\n    0: filters,\n    1: setFilters\n  } = useState(listFieldInit); // SORT OPTION\n\n  const sortOptionList = [{\n    dataSort: {\n      sort: 0,\n      sortType: true\n    },\n    value: 1,\n    text: 'Ngày tăng dần'\n  }, {\n    dataSort: {\n      sort: 0,\n      sortType: false\n    },\n    value: 2,\n    text: 'Ngày giảm dần'\n  }, {\n    dataSort: {\n      sort: 1,\n      sortType: true\n    },\n    value: 3,\n    text: 'Tên tăng dần'\n  }, {\n    dataSort: {\n      sort: 1,\n      sortType: false\n    },\n    value: 4,\n    text: 'Tên giảm dần'\n  }]; // FILTER\n\n  const onFilter = obj => {\n    setFilters(_objectSpread(_objectSpread(_objectSpread({}, listFieldInit), refValue.current), {}, {\n      pageIndex: 1,\n      fromDate: moment(obj.fromDate).format('YYYY/MM/DD'),\n      toDate: moment(obj.toDate).format('YYYY/MM/DD')\n    }));\n  }; // PAGINATION\n\n\n  const getPagination = (pageIndex, pageSize) => {\n    if (!pageSize) pageSize = 10;\n    refValue.current = _objectSpread(_objectSpread({}, refValue.current), {}, {\n      pageSize,\n      pageIndex\n    });\n    setFilters(_objectSpread(_objectSpread({}, filters), refValue.current));\n  }; // SORT\n\n\n  const onSort = option => {\n    refValue.current = _objectSpread(_objectSpread({}, refValue.current), {}, {\n      sort: option.title.sort,\n      sortType: option.title.sortType\n    });\n    setFilters(_objectSpread(_objectSpread({}, listFieldInit), refValue.current));\n  }; // RESET SEARCH\n\n\n  const onResetSearch = () => {\n    setActiveColumnSearch('');\n    setFilters(_objectSpread(_objectSpread({}, listFieldInit), {}, {\n      pageSize: refValue.current.pageSize\n    }));\n  }; // ACTION SEARCH\n\n\n  const onSearch = (valueSearch, dataIndex) => {\n    setActiveColumnSearch(dataIndex);\n    setFilters(_objectSpread(_objectSpread(_objectSpread({}, listFieldInit), refValue.current), {}, {\n      pageIndex: 1,\n      [dataIndex]: valueSearch\n    }));\n  }; // GET DATA IN FIRST TIME\n\n\n  const fetchDayOffList = async () => {\n    setIsLoading({\n      type: 'GET_ALL',\n      status: true\n    });\n\n    try {\n      let res = await dayOffApi.getAll(filters);\n\n      if (res.status === 200) {\n        if (res.data.totalRow && res.data.data.length) {\n          setDayOffList(res.data.data);\n          setTotalPage(res.data.totalRow);\n        }\n      } else if (res.status === 204) {\n        showNoti('danger', 'Không tìm thấy');\n        setDayOffList([]);\n      }\n    } catch (error) {\n      showNoti('danger', error.message);\n    } finally {\n      setIsLoading({\n        type: 'GET_ALL',\n        status: false\n      });\n    }\n  };\n\n  useEffect(() => {\n    fetchDayOffList();\n  }, [filters]); // CREATE\n\n  const onCreateDayOff = async data => {\n    setIsLoading({\n      type: 'ADD_DATA',\n      status: true\n    });\n    let res;\n\n    try {\n      res = await dayOffApi.add(_objectSpread(_objectSpread({}, data), {}, {\n        Enable: true\n      }));\n      res.status === 200 && showNoti('success', res.data.message);\n      onResetSearch(); // <== khi tạo xong r reset search để trở về trang đầu tiên\n    } catch (error) {\n      showNoti('danger', error.message);\n    } finally {\n      setIsLoading({\n        type: 'ADD_DATA',\n        status: false\n      });\n    }\n\n    return res;\n  }; // UPDATE\n\n\n  const onUpdateDayOff = async (newObj, idx) => {\n    setIsLoading({\n      type: 'ADD_DATA',\n      status: true\n    });\n    let res;\n\n    try {\n      res = await dayOffApi.update(newObj);\n\n      if (res.status === 200) {\n        const newDayOffList = [...dayOffList];\n        newDayOffList.splice(idx, 1, newObj);\n        setDayOffList(newDayOffList);\n        showNoti('success', res.data.message);\n      }\n    } catch (error) {\n      showNoti('danger', error.message);\n    } finally {\n      setIsLoading({\n        type: 'ADD_DATA',\n        status: false\n      });\n      return res;\n    }\n  }; // DELETE\n\n\n  const onDeleteDayOff = idx => {\n    return async () => {\n      setIsLoading({\n        type: 'GET_ALL',\n        status: true\n      });\n\n      try {\n        const delObj = dayOffList[idx];\n        const res = await dayOffApi.delete(_objectSpread(_objectSpread({}, delObj), {}, {\n          Enable: false\n        }));\n        res.status === 200 && showNoti('success', res.data.message);\n\n        if (dayOffList.length === 1) {\n          filters.pageIndex === 1 ? (setFilters(_objectSpread(_objectSpread(_objectSpread({}, listFieldInit), refValue.current), {}, {\n            pageIndex: 1\n          })), setDayOffList([])) : setFilters(_objectSpread(_objectSpread(_objectSpread({}, filters), refValue.current), {}, {\n            pageIndex: filters.pageIndex - 1\n          }));\n          return;\n        }\n\n        fetchDayOffList();\n      } catch (error) {\n        showNoti('danger', error.message);\n      } finally {\n        setIsLoading({\n          type: 'GET_ALL',\n          status: false\n        });\n      }\n    };\n  }; // COLUMN FOR TABLE\n\n\n  const columns = [_objectSpread(_objectSpread({\n    title: 'Ngày nghỉ',\n    dataIndex: 'DayOff'\n  }, FilterColumn('DayOff', onSearch, onResetSearch, 'date')), {}, {\n    render: date => moment(date).format('DD/MM/YYYY'),\n    className: activeColumnSearch === 'DayOff' ? 'active-column-search' : ''\n  }), _objectSpread(_objectSpread({\n    title: 'Ghi chú',\n    dataIndex: 'DayOffName'\n  }, FilterColumn('DayOffName', onSearch, onResetSearch, 'text')), {}, {\n    className: activeColumnSearch === 'DayOffName' ? 'active-column-search' : ''\n  }), {\n    title: 'Ngày khởi tạo',\n    dataIndex: 'CreatedOn',\n    render: date => moment(date).format('DD/MM/YYYY')\n  }, {\n    title: 'Được tạo bởi',\n    dataIndex: 'CreatedBy'\n  }, {\n    align: 'center',\n    render: (value, _, idx) =>\n    /*#__PURE__*/\n    // VÌ KHI CLICK VÀO THẰNG TALBE THÌ TRIGGER LUÔN CẢ FUNCTION CỦA CÁC THẰNG BÊN TRONG\n    _jsxDEV(\"div\", {\n      onClick: e => e.stopPropagation(),\n      children: isAdmin && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(DayOffForm, {\n          isLoading: isLoading,\n          isUpdate: true,\n          updateObj: value,\n          indexUpdateObj: idx,\n          handleUpdateDayOff: onUpdateDayOff\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 8\n        }, this), /*#__PURE__*/_jsxDEV(DeleteTableRow, {\n          handleDelete: onDeleteDayOff(idx)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 8\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 5\n    }, this)\n  }]; // RETURN\n\n  return /*#__PURE__*/_jsxDEV(PowerTable, {\n    currentPage: filters.pageIndex,\n    totalPage: totalPage,\n    getPagination: getPagination,\n    loading: isLoading,\n    addClass: \"basic-header\",\n    TitlePage: \"Ng\\xE0y ngh\\u1EC9\",\n    TitleCard: isAdmin && /*#__PURE__*/_jsxDEV(DayOffForm, {\n      isLoading: isLoading,\n      isUpdate: false,\n      handleCreateDayOff: onCreateDayOff\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 303,\n      columnNumber: 26\n    }, this),\n    dataSource: dayOffList,\n    columns: columns,\n    Extra: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"extra-table\",\n      children: [/*#__PURE__*/_jsxDEV(DayOffFilterForm, {\n        handleFilter: onFilter,\n        handleResetFilter: onResetSearch\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(SortBox, {\n        handleSort: onSort,\n        dataOption: sortOptionList\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 296,\n    columnNumber: 3\n  }, this);\n};\n\nexport default DayOff;","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/components/Global/Option/DayOff/DayOff.tsx"],"names":["moment","React","useEffect","useRef","useState","dayOffApi","DeleteTableRow","SortBox","DayOffForm","PowerTable","FilterColumn","useWrap","DayOffFilterForm","DayOff","dayOffList","setDayOffList","isLoading","setIsLoading","type","status","totalPage","setTotalPage","showNoti","pageSize","isAdmin","activeColumnSearch","setActiveColumnSearch","listFieldInit","pageIndex","sort","sortType","DayOffName","fromDate","toDate","refValue","filters","setFilters","sortOptionList","dataSort","value","text","onFilter","obj","current","format","getPagination","onSort","option","title","onResetSearch","onSearch","valueSearch","dataIndex","fetchDayOffList","res","getAll","data","totalRow","length","error","message","onCreateDayOff","add","Enable","onUpdateDayOff","newObj","idx","update","newDayOffList","splice","onDeleteDayOff","delObj","delete","columns","render","date","className","align","_","e","stopPropagation"],"mappings":"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","sourcesContent":["import moment from 'moment';\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { dayOffApi } from '~/apiBase';\r\nimport DeleteTableRow from '~/components/Elements/DeleteTableRow/DeleteTableRow';\r\nimport SortBox from '~/components/Elements/SortBox';\r\nimport DayOffForm from '~/components/Global/Option/DayOff/DayOffForm';\r\nimport PowerTable from '~/components/PowerTable';\r\nimport FilterColumn from '~/components/Tables/FilterColumn';\r\nimport { useWrap } from '~/context/wrap';\r\nimport DayOffFilterForm from './DayOffFilterForm';\r\n\r\nconst DayOff = () => {\r\n\tconst [dayOffList, setDayOffList] = useState<IDayOff[]>([]);\r\n\tconst [isLoading, setIsLoading] = useState({\r\n\t\ttype: '',\r\n\t\tstatus: false\r\n\t});\r\n\tconst [totalPage, setTotalPage] = useState(null);\r\n\tconst { showNoti, pageSize, isAdmin } = useWrap();\r\n\tconst [activeColumnSearch, setActiveColumnSearch] = useState('');\r\n\t// FILTER\r\n\tconst listFieldInit = {\r\n\t\tpageIndex: 1,\r\n\t\tpageSize: pageSize,\r\n\t\tsort: -1,\r\n\t\tsortType: false,\r\n\t\tDayOff: '',\r\n\t\tDayOffName: '',\r\n\t\tfromDate: '',\r\n\t\ttoDate: ''\r\n\t};\r\n\tlet refValue = useRef({\r\n\t\tpageIndex: 1,\r\n\t\tpageSize: 10,\r\n\t\tsort: -1,\r\n\t\tsortType: false\r\n\t});\r\n\tconst [filters, setFilters] = useState(listFieldInit);\r\n\t// SORT OPTION\r\n\tconst sortOptionList = [\r\n\t\t{\r\n\t\t\tdataSort: {\r\n\t\t\t\tsort: 0,\r\n\t\t\t\tsortType: true\r\n\t\t\t},\r\n\t\t\tvalue: 1,\r\n\t\t\ttext: 'Ngày tăng dần'\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataSort: {\r\n\t\t\t\tsort: 0,\r\n\t\t\t\tsortType: false\r\n\t\t\t},\r\n\t\t\tvalue: 2,\r\n\t\t\ttext: 'Ngày giảm dần'\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataSort: {\r\n\t\t\t\tsort: 1,\r\n\t\t\t\tsortType: true\r\n\t\t\t},\r\n\t\t\tvalue: 3,\r\n\t\t\ttext: 'Tên tăng dần'\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataSort: {\r\n\t\t\t\tsort: 1,\r\n\t\t\t\tsortType: false\r\n\t\t\t},\r\n\t\t\tvalue: 4,\r\n\t\t\ttext: 'Tên giảm dần'\r\n\t\t}\r\n\t];\r\n\t// FILTER\r\n\tconst onFilter = (obj) => {\r\n\t\tsetFilters({\r\n\t\t\t...listFieldInit,\r\n\t\t\t...refValue.current,\r\n\t\t\tpageIndex: 1,\r\n\t\t\tfromDate: moment(obj.fromDate).format('YYYY/MM/DD'),\r\n\t\t\ttoDate: moment(obj.toDate).format('YYYY/MM/DD')\r\n\t\t});\r\n\t};\r\n\t// PAGINATION\r\n\tconst getPagination = (pageIndex: number, pageSize: number) => {\r\n\t\tif (!pageSize) pageSize = 10;\r\n\t\trefValue.current = {\r\n\t\t\t...refValue.current,\r\n\t\t\tpageSize,\r\n\t\t\tpageIndex\r\n\t\t};\r\n\t\tsetFilters({\r\n\t\t\t...filters,\r\n\t\t\t...refValue.current\r\n\t\t});\r\n\t};\r\n\t// SORT\r\n\tconst onSort = (option) => {\r\n\t\trefValue.current = {\r\n\t\t\t...refValue.current,\r\n\t\t\tsort: option.title.sort,\r\n\t\t\tsortType: option.title.sortType\r\n\t\t};\r\n\t\tsetFilters({\r\n\t\t\t...listFieldInit,\r\n\t\t\t...refValue.current\r\n\t\t});\r\n\t};\r\n\t// RESET SEARCH\r\n\tconst onResetSearch = () => {\r\n\t\tsetActiveColumnSearch('');\r\n\t\tsetFilters({\r\n\t\t\t...listFieldInit,\r\n\t\t\tpageSize: refValue.current.pageSize\r\n\t\t});\r\n\t};\r\n\t// ACTION SEARCH\r\n\tconst onSearch = (valueSearch, dataIndex) => {\r\n\t\tsetActiveColumnSearch(dataIndex);\r\n\t\tsetFilters({\r\n\t\t\t...listFieldInit,\r\n\t\t\t...refValue.current,\r\n\t\t\tpageIndex: 1,\r\n\t\t\t[dataIndex]: valueSearch\r\n\t\t});\r\n\t};\r\n\r\n\t// GET DATA IN FIRST TIME\r\n\tconst fetchDayOffList = async () => {\r\n\t\tsetIsLoading({\r\n\t\t\ttype: 'GET_ALL',\r\n\t\t\tstatus: true\r\n\t\t});\r\n\t\ttry {\r\n\t\t\tlet res = await dayOffApi.getAll(filters);\r\n\r\n\t\t\tif (res.status === 200) {\r\n\t\t\t\tif (res.data.totalRow && res.data.data.length) {\r\n\t\t\t\t\tsetDayOffList(res.data.data);\r\n\t\t\t\t\tsetTotalPage(res.data.totalRow);\r\n\t\t\t\t}\r\n\t\t\t} else if (res.status === 204) {\r\n\t\t\t\tshowNoti('danger', 'Không tìm thấy');\r\n\t\t\t\tsetDayOffList([]);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error.message);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'GET_ALL',\r\n\t\t\t\tstatus: false\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tfetchDayOffList();\r\n\t}, [filters]);\r\n\r\n\t// CREATE\r\n\tconst onCreateDayOff = async (data: any) => {\r\n\t\tsetIsLoading({\r\n\t\t\ttype: 'ADD_DATA',\r\n\t\t\tstatus: true\r\n\t\t});\r\n\t\tlet res;\r\n\t\ttry {\r\n\t\t\tres = await dayOffApi.add({\r\n\t\t\t\t...data,\r\n\t\t\t\tEnable: true\r\n\t\t\t});\r\n\t\t\tres.status === 200 && showNoti('success', res.data.message);\r\n\t\t\tonResetSearch(); // <== khi tạo xong r reset search để trở về trang đầu tiên\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error.message);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'ADD_DATA',\r\n\t\t\t\tstatus: false\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\t// UPDATE\r\n\tconst onUpdateDayOff = async (newObj: any, idx: number) => {\r\n\t\tsetIsLoading({\r\n\t\t\ttype: 'ADD_DATA',\r\n\t\t\tstatus: true\r\n\t\t});\r\n\t\tlet res;\r\n\t\ttry {\r\n\t\t\tres = await dayOffApi.update(newObj);\r\n\t\t\tif (res.status === 200) {\r\n\t\t\t\tconst newDayOffList = [...dayOffList];\r\n\t\t\t\tnewDayOffList.splice(idx, 1, newObj);\r\n\t\t\t\tsetDayOffList(newDayOffList);\r\n\t\t\t\tshowNoti('success', res.data.message);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tshowNoti('danger', error.message);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'ADD_DATA',\r\n\t\t\t\tstatus: false\r\n\t\t\t});\r\n\t\t\treturn res;\r\n\t\t}\r\n\t};\r\n\t// DELETE\r\n\tconst onDeleteDayOff = (idx: number) => {\r\n\t\treturn async () => {\r\n\t\t\tsetIsLoading({\r\n\t\t\t\ttype: 'GET_ALL',\r\n\t\t\t\tstatus: true\r\n\t\t\t});\r\n\t\t\ttry {\r\n\t\t\t\tconst delObj = dayOffList[idx];\r\n\t\t\t\tconst res = await dayOffApi.delete({\r\n\t\t\t\t\t...delObj,\r\n\t\t\t\t\tEnable: false\r\n\t\t\t\t});\r\n\t\t\t\tres.status === 200 && showNoti('success', res.data.message);\r\n\t\t\t\tif (dayOffList.length === 1) {\r\n\t\t\t\t\tfilters.pageIndex === 1\r\n\t\t\t\t\t\t? (setFilters({\r\n\t\t\t\t\t\t\t\t...listFieldInit,\r\n\t\t\t\t\t\t\t\t...refValue.current,\r\n\t\t\t\t\t\t\t\tpageIndex: 1\r\n\t\t\t\t\t\t  }),\r\n\t\t\t\t\t\t  setDayOffList([]))\r\n\t\t\t\t\t\t: setFilters({\r\n\t\t\t\t\t\t\t\t...filters,\r\n\t\t\t\t\t\t\t\t...refValue.current,\r\n\t\t\t\t\t\t\t\tpageIndex: filters.pageIndex - 1\r\n\t\t\t\t\t\t  });\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tfetchDayOffList();\r\n\t\t\t} catch (error) {\r\n\t\t\t\tshowNoti('danger', error.message);\r\n\t\t\t} finally {\r\n\t\t\t\tsetIsLoading({\r\n\t\t\t\t\ttype: 'GET_ALL',\r\n\t\t\t\t\tstatus: false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\t// COLUMN FOR TABLE\r\n\tconst columns = [\r\n\t\t{\r\n\t\t\ttitle: 'Ngày nghỉ',\r\n\t\t\tdataIndex: 'DayOff',\r\n\t\t\t...FilterColumn('DayOff', onSearch, onResetSearch, 'date'),\r\n\t\t\trender: (date) => moment(date).format('DD/MM/YYYY'),\r\n\t\t\tclassName: activeColumnSearch === 'DayOff' ? 'active-column-search' : ''\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Ghi chú',\r\n\t\t\tdataIndex: 'DayOffName',\r\n\t\t\t...FilterColumn('DayOffName', onSearch, onResetSearch, 'text'),\r\n\t\t\tclassName: activeColumnSearch === 'DayOffName' ? 'active-column-search' : ''\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Ngày khởi tạo',\r\n\t\t\tdataIndex: 'CreatedOn',\r\n\t\t\trender: (date) => moment(date).format('DD/MM/YYYY')\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Được tạo bởi',\r\n\t\t\tdataIndex: 'CreatedBy'\r\n\t\t},\r\n\t\t{\r\n\t\t\talign: 'center',\r\n\t\t\trender: (value, _, idx) => (\r\n\t\t\t\t// VÌ KHI CLICK VÀO THẰNG TALBE THÌ TRIGGER LUÔN CẢ FUNCTION CỦA CÁC THẰNG BÊN TRONG\r\n\t\t\t\t<div onClick={(e) => e.stopPropagation()}>\r\n\t\t\t\t\t{isAdmin && (\r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t<DayOffForm\r\n\t\t\t\t\t\t\t\tisLoading={isLoading}\r\n\t\t\t\t\t\t\t\tisUpdate={true}\r\n\t\t\t\t\t\t\t\tupdateObj={value}\r\n\t\t\t\t\t\t\t\tindexUpdateObj={idx}\r\n\t\t\t\t\t\t\t\thandleUpdateDayOff={onUpdateDayOff}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t<DeleteTableRow handleDelete={onDeleteDayOff(idx)} />\r\n\t\t\t\t\t\t</>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t)\r\n\t\t}\r\n\t];\r\n\t// RETURN\r\n\treturn (\r\n\t\t<PowerTable\r\n\t\t\tcurrentPage={filters.pageIndex}\r\n\t\t\ttotalPage={totalPage}\r\n\t\t\tgetPagination={getPagination}\r\n\t\t\tloading={isLoading}\r\n\t\t\taddClass=\"basic-header\"\r\n\t\t\tTitlePage=\"Ngày nghỉ\"\r\n\t\t\tTitleCard={isAdmin && <DayOffForm isLoading={isLoading} isUpdate={false} handleCreateDayOff={onCreateDayOff} />}\r\n\t\t\tdataSource={dayOffList}\r\n\t\t\tcolumns={columns}\r\n\t\t\tExtra={\r\n\t\t\t\t<div className=\"extra-table\">\r\n\t\t\t\t\t<DayOffFilterForm handleFilter={onFilter} handleResetFilter={onResetSearch} />\r\n\t\t\t\t\t<SortBox handleSort={onSort} dataOption={sortOptionList} />\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t/>\r\n\t);\r\n};\r\n\r\nexport default DayOff;\r\n"]},"metadata":{},"sourceType":"module"}