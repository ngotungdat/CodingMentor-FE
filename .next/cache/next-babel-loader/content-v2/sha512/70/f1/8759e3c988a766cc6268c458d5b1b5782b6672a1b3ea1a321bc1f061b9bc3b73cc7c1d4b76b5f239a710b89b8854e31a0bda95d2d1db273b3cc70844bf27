{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport axios from 'axios';\nimport { getSession, signIn } from 'next-auth/client';\n\nfunction getUrl(config) {\n  if (config.baseURL) {\n    return config.url.replace(config.baseURL, '').split('?')[0];\n  }\n\n  return config.url;\n}\n\nexport const authHeader_X = async () => {\n  const session = await getSession();\n\n  if (session && session.accessToken) {\n    return {\n      token: session.accessToken\n    };\n  } else {\n    return {};\n  }\n};\nexport const authHeader_Bearer = async () => {\n  const session = await getSession();\n\n  if (session && session.accessToken) {\n    return {\n      Authorization: 'Bearer ' + session.accessToken\n    };\n  } else {\n    return {};\n  }\n};\nexport const instance = axios.create({\n  baseURL: process.env.NEXT_PUBLIC_API_ENDPOINT,\n  headers: {\n    Accept: 'application/json'\n  }\n});\ninstance.interceptors.request.use(async config => {\n  const url = getUrl(config);\n\n  if (!url.toString().includes('/auth/')) {\n    const authHeader = await authHeader_X();\n    config.headers = _objectSpread(_objectSpread({}, config.headers), authHeader);\n  }\n\n  if (url !== '/api/Idioms/getRandoms' && url !== '/api/Rules') {\n    console.log(`%c ${config.method.toUpperCase()} - ${url}:`, 'color: #0086b3; font-weight: bold', config);\n  }\n\n  return config;\n}, error => {\n  var _error$response, _error$response2;\n\n  console.log(`%c ${error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status}  :`, 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data);\n  return Promise.reject(error);\n});\n\nconst checkResponse = error => {\n  var _error$response3, _error$response4;\n\n  switch (error === null || error === void 0 ? void 0 : (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.status) {\n    case 401:\n      setTimeout(() => {\n        signIn();\n      }, 1000);\n      break;\n\n    case 403:\n      alert('Bạn không có quyền thực hiện');\n      break;\n\n    case 400:\n      console.log(error === null || error === void 0 ? void 0 : (_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.message);\n      break;\n\n    default:\n      console.log(`%c ${error === null || error === void 0 ? void 0 : error.response}  :`, 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : error.response);\n  }\n};\n\ninstance.interceptors.response.use(response => {\n  let url = getUrl(response === null || response === void 0 ? void 0 : response.config);\n\n  if (url !== '/api/Idioms/getRandoms' && url !== '/api/Rules') {\n    console.log(` %c ${response === null || response === void 0 ? void 0 : response.status} - ${getUrl(response === null || response === void 0 ? void 0 : response.config)}:`, 'color: #008000; font-weight: bold', response);\n  }\n\n  return response;\n}, function (error) {\n  if (error.response) {\n    var _error$response5, _error$response6;\n\n    checkResponse(error); // server trả response về là lỗi code đã handle\n\n    console.log(`%c ${error === null || error === void 0 ? void 0 : (_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : _error$response5.status}  :`, 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : (_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : _error$response6.data);\n    return Promise.reject(error);\n  } else if (error.request) {\n    var _error$response7;\n\n    // request mãi mãi ko thấy response\n    // `error.request` là XMLHttpRequest trong website còn nodejs là http.ClientRequest\n    console.log(`%c ${JSON.stringify(error)}  :`, 'color: red; font-weight: bold', error === null || error === void 0 ? void 0 : (_error$response7 = error.response) === null || _error$response7 === void 0 ? void 0 : _error$response7.data);\n    return Promise.reject(error);\n  } else {\n    // có gì đó sai sai, hình như là hàm request sai\n    console.log(`%c ${JSON.stringify(error)}  :`, 'color: red; font-weight: bold', 'có gì đó sai sai, hình như là setting sai');\n    return Promise.reject(error);\n  }\n});","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/apiBase/instance.ts"],"names":["axios","getSession","signIn","getUrl","config","baseURL","url","replace","split","authHeader_X","session","accessToken","token","authHeader_Bearer","Authorization","instance","create","process","env","NEXT_PUBLIC_API_ENDPOINT","headers","Accept","interceptors","request","use","toString","includes","authHeader","console","log","method","toUpperCase","error","response","status","data","Promise","reject","checkResponse","setTimeout","alert","message","JSON","stringify"],"mappings":"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","sourcesContent":["import axios, { AxiosRequestConfig, AxiosResponse } from 'axios'\r\nimport { getSession, signIn } from 'next-auth/client'\r\n\r\nfunction getUrl(config) {\r\n\tif (config.baseURL) {\r\n\t\treturn config.url.replace(config.baseURL, '').split('?')[0]\r\n\t}\r\n\treturn config.url\r\n}\r\n\r\nexport const authHeader_X = async () => {\r\n\tconst session = await getSession()\r\n\tif (session && session.accessToken) {\r\n\t\treturn { token: session.accessToken }\r\n\t} else {\r\n\t\treturn {}\r\n\t}\r\n}\r\nexport const authHeader_Bearer = async () => {\r\n\tconst session = await getSession()\r\n\r\n\tif (session && session.accessToken) {\r\n\t\treturn { Authorization: 'Bearer ' + session.accessToken }\r\n\t} else {\r\n\t\treturn {}\r\n\t}\r\n}\r\n\r\nexport const instance = axios.create({\r\n\tbaseURL: process.env.NEXT_PUBLIC_API_ENDPOINT,\r\n\theaders: {\r\n\t\tAccept: 'application/json'\r\n\t}\r\n})\r\n\r\ninstance.interceptors.request.use(\r\n\tasync (config: AxiosRequestConfig) => {\r\n\t\tconst url = getUrl(config)\r\n\t\tif (!url.toString().includes('/auth/')) {\r\n\t\t\tconst authHeader = await authHeader_X()\r\n\t\t\tconfig.headers = {\r\n\t\t\t\t...config.headers,\r\n\t\t\t\t...authHeader\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (url !== '/api/Idioms/getRandoms' && url !== '/api/Rules') {\r\n\t\t\tconsole.log(`%c ${config.method.toUpperCase()} - ${url}:`, 'color: #0086b3; font-weight: bold', config)\r\n\t\t}\r\n\t\treturn config\r\n\t},\r\n\t(error) => {\r\n\t\tconsole.log(`%c ${error?.response?.status}  :`, 'color: red; font-weight: bold', error?.response?.data)\r\n\t\treturn Promise.reject(error)\r\n\t}\r\n)\r\n\r\nconst checkResponse = (error) => {\r\n\tswitch (error?.response?.status) {\r\n\t\tcase 401:\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tsignIn()\r\n\t\t\t}, 1000)\r\n\t\t\tbreak\r\n\t\tcase 403:\r\n\t\t\talert('Bạn không có quyền thực hiện')\r\n\t\t\tbreak\r\n\t\tcase 400:\r\n\t\t\tconsole.log(error?.response?.message)\r\n\t\t\tbreak\r\n\t\tdefault:\r\n\t\t\tconsole.log(`%c ${error?.response}  :`, 'color: red; font-weight: bold', error?.response)\r\n\t}\r\n}\r\n\r\ninstance.interceptors.response.use(\r\n\t(response: AxiosResponse) => {\r\n\t\tlet url = getUrl(response?.config)\r\n\t\tif (url !== '/api/Idioms/getRandoms' && url !== '/api/Rules') {\r\n\t\t\tconsole.log(` %c ${response?.status} - ${getUrl(response?.config)}:`, 'color: #008000; font-weight: bold', response)\r\n\t\t}\r\n\t\treturn response\r\n\t},\r\n\tfunction (error) {\r\n\t\tif (error.response) {\r\n\t\t\tcheckResponse(error)\r\n\t\t\t// server trả response về là lỗi code đã handle\r\n\t\t\tconsole.log(`%c ${error?.response?.status}  :`, 'color: red; font-weight: bold', error?.response?.data)\r\n\t\t\treturn Promise.reject(error)\r\n\t\t} else if (error.request) {\r\n\t\t\t// request mãi mãi ko thấy response\r\n\t\t\t// `error.request` là XMLHttpRequest trong website còn nodejs là http.ClientRequest\r\n\t\t\tconsole.log(`%c ${JSON.stringify(error)}  :`, 'color: red; font-weight: bold', error?.response?.data)\r\n\t\t\treturn Promise.reject(error)\r\n\t\t} else {\r\n\t\t\t// có gì đó sai sai, hình như là hàm request sai\r\n\t\t\tconsole.log(`%c ${JSON.stringify(error)}  :`, 'color: red; font-weight: bold', 'có gì đó sai sai, hình như là setting sai')\r\n\t\t\treturn Promise.reject(error)\r\n\t\t}\r\n\t}\r\n)\r\n"]},"metadata":{},"sourceType":"module"}