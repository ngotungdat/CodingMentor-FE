{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"D:\\\\MonaMedia\\\\Project\\\\IELTS-NguyenHuyen-FE\\\\IELTS-Nguyen-Huyen\\\\src\\\\pages\\\\video-learning\\\\index.tsx\",\n    _s = $RefreshSig$(),\n    _this = this,\n    _s2 = $RefreshSig$();\n\nimport { Card, Drawer } from 'antd';\nimport { useRouter } from 'next/router';\nimport React, { useEffect, useRef, useState } from 'react';\nimport 'react-circular-progressbar/dist/styles.css';\nimport { VideoCourseOfStudent, VideoCourses } from '~/apiBase/video-learning';\nimport HeaderVideo from '~/components/VideoLearning/header';\nimport VideoList from '~/components/VideoLearning/list-video';\nimport VideoTabs from '~/components/VideoLearning/tabs';\nimport { useWrap } from '~/context/wrap';\nimport { usePageVisibility } from '~/utils/functions';\nvar FAKE_IFRAME_VIDEO = 'https://www.youtube.com/embed/czXeFkQZZPs';\n\nvar useUnload = function useUnload(fn) {\n  _s();\n\n  var cb = useRef(fn);\n  useEffect(function () {\n    cb.current = fn;\n  }, [fn]);\n  useEffect(function () {\n    var onUnload = function onUnload() {\n      var _cb$current;\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return (_cb$current = cb.current) === null || _cb$current === void 0 ? void 0 : _cb$current.call.apply(_cb$current, [cb].concat(args));\n    };\n\n    window.addEventListener('beforeunload', onUnload);\n    return function () {\n      return window.removeEventListener('beforeunload', onUnload);\n    };\n  }, []);\n};\n\n_s(useUnload, \"1QkGLhN67LEP1/FcABelHHfYlL0=\");\n\nvar useBeforeUnload = function useBeforeUnload(fn) {\n  window.onbeforeunload = function () {\n    fn();\n    return 'Bạn thật sự muốn đóng video đang xem?';\n  };\n};\n\nvar VideoLearning = function VideoLearning() {\n  _s2();\n\n  var router = useRouter();\n\n  var _useWrap = useWrap(),\n      userInformation = _useWrap.userInformation,\n      showNoti = _useWrap.showNoti;\n\n  var videoStudy = useRef(null);\n\n  var _useState = useState(null),\n      currentVideo = _useState[0],\n      setCurrentVideo = _useState[1];\n\n  var _useState2 = useState([]),\n      videos = _useState2[0],\n      setVideos = _useState2[1];\n\n  var _useState3 = useState({\n    ID: '',\n    Title: '',\n    Description: '',\n    Type: 0,\n    SectionID: '',\n    Second: 0\n  }),\n      currentLession = _useState3[0],\n      setCurrentLession = _useState3[1];\n\n  useEffect(function () {\n    if (router.query.course !== undefined) {\n      getVideos();\n    }\n  }, []); // RELOAD TAB\n\n  useUnload(function (e) {\n    updateTime();\n    e.preventDefault();\n    e.returnValue = '';\n  }); // CLOSE WINDOW OR TAB\n\n  if (true) {\n    useBeforeUnload(function () {\n      return updateTime();\n    });\n  } // HANDLE VISIT PAGE\n\n\n  var handleVisibilityChange = function handleVisibilityChange(visible) {\n    if (videoStudy.current !== null) {\n      if (videoStudy.current.currentTime !== 0) {\n        updateTime();\n      }\n    }\n  };\n\n  usePageVisibility(handleVisibilityChange);\n\n  var updateTime = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var temp, res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(videoStudy.current !== null)) {\n                _context.next = 11;\n                break;\n              }\n\n              if (!(videoStudy.current.currentTime !== 0 && currentLession.ID !== '')) {\n                _context.next = 11;\n                break;\n              }\n\n              temp = {\n                VideoCourseOfStudentID: router.query.ID,\n                SectionID: currentLession.SectionID,\n                LessonID: currentLession.ID,\n                IsSeen: videoStudy.current.duration / 2 < videoStudy.current.currentTime ? 'True' : 'False',\n                // True - False: đánh dấu đã xem video\n                TimeWatched: videoStudy.current.currentTime // (giây) Thời gian đã xem video\n\n              };\n              _context.prev = 3;\n              _context.next = 6;\n              return VideoCourseOfStudent.UpdateSeenAndTimeWatchedVideo(temp);\n\n            case 6:\n              res = _context.sent;\n              _context.next = 11;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](3);\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 9]]);\n    }));\n\n    return function updateTime() {\n      return _ref.apply(this, arguments);\n    };\n  }(); //GET DATA\n\n\n  var getVideos = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return VideoCourses.ListSection(router.query.course);\n\n            case 3:\n              res = _context2.sent;\n              res.status == 200 && setVideos(res.data.data);\n              _context2.next = 10;\n              break;\n\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n              showNoti('danger', _context2.t0 === null || _context2.t0 === void 0 ? void 0 : _context2.t0.message);\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 7]]);\n    }));\n\n    return function getVideos() {\n      return _ref2.apply(this, arguments);\n    };\n  }(); // DRAWER VIDEO LIST STATE\n\n\n  var _useState4 = useState(false),\n      visible = _useState4[0],\n      setVisible = _useState4[1]; // OPEN DRAWER VIDEO LIST\n\n\n  var showDrawer = function showDrawer() {\n    setVisible(!visible);\n  }; // CLOSE DRAWER VIDEO LIST\n\n\n  var onClose = function onClose() {\n    setVisible(false);\n  };\n\n  function Iframe(props) {\n    var src = props.src;\n    return /*#__PURE__*/_jsxDEV(\"iframe\", {\n      id: \"video__course__iframe\",\n      className: \"responsive-iframe\",\n      ref: videoStudy,\n      src: src,\n      allowFullScreen: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 10\n    }, this);\n  } // RENDER\n\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"w-video-learning custom-scroll-bar\",\n    children: [/*#__PURE__*/_jsxDEV(HeaderVideo, {\n      params: router.query,\n      onClick: showDrawer\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 4\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row w-100 m-0 p-0 pt-3 w-main\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-9 col-12 scrollable\",\n        children: /*#__PURE__*/_jsxDEV(Card, {\n          className: \"card-main box-shadow\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"video\",\n            children: /*#__PURE__*/_jsxDEV(Iframe, {\n              src: FAKE_IFRAME_VIDEO\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 126,\n              columnNumber: 8\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 125,\n            columnNumber: 7\n          }, _this), /*#__PURE__*/_jsxDEV(VideoTabs, {\n            lession: currentLession\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 7\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 6\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 5\n      }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-3 col-12 scrollable\",\n        children: /*#__PURE__*/_jsxDEV(Card, {\n          className: \"w-100 card-list box-shadow\",\n          style: {\n            height: 2000\n          },\n          children: /*#__PURE__*/_jsxDEV(VideoList, {\n            onPress: function onPress(p) {\n              setCurrentLession(p);\n              p.Type === 0 ? setCurrentVideo(p.LinkVideo) : setCurrentVideo(p.LinkHtml);\n            },\n            videos: videos\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 7\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 6\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 5\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 4\n    }, _this), /*#__PURE__*/_jsxDEV(Drawer, {\n      title: \"N\\u1ED9i dung kh\\xF3a h\\u1ECDc\",\n      placement: \"right\",\n      onClose: onClose,\n      visible: visible,\n      className: \"video-drawer\",\n      headerStyle: {\n        paddingTop: 24,\n        paddingBottom: 24,\n        background: '#fff'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wrap-menu-drawer\",\n        children: /*#__PURE__*/_jsxDEV(VideoList, {\n          onPress: function onPress(p) {\n            setCurrentLession(p);\n            setCurrentVideo(p.LinkVideo);\n          },\n          videos: videos\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 6\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 5\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 4\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 120,\n    columnNumber: 3\n  }, _this);\n};\n\n_s2(VideoLearning, \"3zsDifW2p18DOZa3cJYdXUQH2EU=\", false, function () {\n  return [useRouter, useWrap, useUnload, useBeforeUnload, usePageVisibility];\n});\n\n_c = VideoLearning;\nexport default VideoLearning;\n\nvar _c;\n\n$RefreshReg$(_c, \"VideoLearning\");","map":{"version":3,"sources":["D:/MonaMedia/Project/IELTS-NguyenHuyen-FE/IELTS-Nguyen-Huyen/src/pages/video-learning/index.tsx"],"names":["Card","Drawer","useRouter","React","useEffect","useRef","useState","VideoCourseOfStudent","VideoCourses","HeaderVideo","VideoList","VideoTabs","useWrap","usePageVisibility","FAKE_IFRAME_VIDEO","useUnload","fn","cb","current","onUnload","args","window","addEventListener","removeEventListener","useBeforeUnload","onbeforeunload","VideoLearning","router","userInformation","showNoti","videoStudy","currentVideo","setCurrentVideo","videos","setVideos","ID","Title","Description","Type","SectionID","Second","currentLession","setCurrentLession","query","course","undefined","getVideos","e","updateTime","preventDefault","returnValue","handleVisibilityChange","visible","currentTime","temp","VideoCourseOfStudentID","LessonID","IsSeen","duration","TimeWatched","UpdateSeenAndTimeWatchedVideo","res","ListSection","status","data","message","setVisible","showDrawer","onClose","Iframe","props","src","height","p","LinkVideo","LinkHtml","paddingTop","paddingBottom","background"],"mappings":"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","sourcesContent":["import { Card, Drawer } from 'antd'\r\nimport { useRouter } from 'next/router'\r\nimport React, { useEffect, useRef, useState } from 'react'\r\nimport 'react-circular-progressbar/dist/styles.css'\r\nimport { VideoCourseOfStudent, VideoCourses } from '~/apiBase/video-learning'\r\nimport HeaderVideo from '~/components/VideoLearning/header'\r\nimport VideoList from '~/components/VideoLearning/list-video'\r\nimport VideoTabs from '~/components/VideoLearning/tabs'\r\nimport { useWrap } from '~/context/wrap'\r\nimport { usePageVisibility } from '~/utils/functions'\r\n\r\nconst FAKE_IFRAME_VIDEO = 'https://www.youtube.com/embed/czXeFkQZZPs'\r\n\r\nconst useUnload = (fn) => {\r\n\tconst cb = useRef(fn)\r\n\r\n\tuseEffect(() => {\r\n\t\tcb.current = fn\r\n\t}, [fn])\r\n\r\n\tuseEffect(() => {\r\n\t\tconst onUnload = (...args) => cb.current?.(...args)\r\n\t\twindow.addEventListener('beforeunload', onUnload)\r\n\t\treturn () => window.removeEventListener('beforeunload', onUnload)\r\n\t}, [])\r\n}\r\n\r\nconst useBeforeUnload = (fn) => {\r\n\twindow.onbeforeunload = function () {\r\n\t\tfn()\r\n\t\treturn 'Bạn thật sự muốn đóng video đang xem?'\r\n\t}\r\n}\r\n\r\nconst VideoLearning = () => {\r\n\tconst router = useRouter()\r\n\tconst { userInformation, showNoti } = useWrap()\r\n\r\n\tconst videoStudy = useRef(null)\r\n\tconst [currentVideo, setCurrentVideo] = useState(null)\r\n\tconst [videos, setVideos] = useState([])\r\n\tconst [currentLession, setCurrentLession] = useState({ ID: '', Title: '', Description: '', Type: 0, SectionID: '', Second: 0 })\r\n\r\n\tuseEffect(() => {\r\n\t\tif (router.query.course !== undefined) {\r\n\t\t\tgetVideos()\r\n\t\t}\r\n\t}, [])\r\n\r\n\t// RELOAD TAB\r\n\tuseUnload((e) => {\r\n\t\tupdateTime()\r\n\t\te.preventDefault()\r\n\t\te.returnValue = ''\r\n\t})\r\n\r\n\t// CLOSE WINDOW OR TAB\r\n\tif (typeof window !== 'undefined') {\r\n\t\tuseBeforeUnload(() => updateTime())\r\n\t}\r\n\r\n\t// HANDLE VISIT PAGE\r\n\tconst handleVisibilityChange = (visible) => {\r\n\t\tif (videoStudy.current !== null) {\r\n\t\t\tif (videoStudy.current.currentTime !== 0) {\r\n\t\t\t\tupdateTime()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tusePageVisibility(handleVisibilityChange)\r\n\r\n\tconst updateTime = async () => {\r\n\t\tif (videoStudy.current !== null) {\r\n\t\t\tif (videoStudy.current.currentTime !== 0 && currentLession.ID !== '') {\r\n\t\t\t\tlet temp = {\r\n\t\t\t\t\tVideoCourseOfStudentID: router.query.ID,\r\n\t\t\t\t\tSectionID: currentLession.SectionID,\r\n\t\t\t\t\tLessonID: currentLession.ID,\r\n\t\t\t\t\tIsSeen: videoStudy.current.duration / 2 < videoStudy.current.currentTime ? 'True' : 'False', // True - False: đánh dấu đã xem video\r\n\t\t\t\t\tTimeWatched: videoStudy.current.currentTime // (giây) Thời gian đã xem video\r\n\t\t\t\t}\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst res = await VideoCourseOfStudent.UpdateSeenAndTimeWatchedVideo(temp)\r\n\t\t\t\t} catch (error) {}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t//GET DATA\r\n\tconst getVideos = async () => {\r\n\t\ttry {\r\n\t\t\tconst res = await VideoCourses.ListSection(router.query.course)\r\n\t\t\tres.status == 200 && setVideos(res.data.data)\r\n\t\t} catch (err) {\r\n\t\t\tshowNoti('danger', err?.message)\r\n\t\t}\r\n\t}\r\n\r\n\t// DRAWER VIDEO LIST STATE\r\n\tconst [visible, setVisible] = useState(false)\r\n\r\n\t// OPEN DRAWER VIDEO LIST\r\n\tconst showDrawer = () => {\r\n\t\tsetVisible(!visible)\r\n\t}\r\n\r\n\t// CLOSE DRAWER VIDEO LIST\r\n\tconst onClose = () => {\r\n\t\tsetVisible(false)\r\n\t}\r\n\r\n\tfunction Iframe(props) {\r\n\t\tconst { src } = props\r\n\t\treturn <iframe id=\"video__course__iframe\" className=\"responsive-iframe\" ref={videoStudy} src={src} allowFullScreen />\r\n\t}\r\n\r\n\t// RENDER\r\n\treturn (\r\n\t\t<div className=\"w-video-learning custom-scroll-bar\">\r\n\t\t\t<HeaderVideo params={router.query} onClick={showDrawer} />\r\n\t\t\t<div className=\"row w-100 m-0 p-0 pt-3 w-main\">\r\n\t\t\t\t<div className=\"col-md-9 col-12 scrollable\">\r\n\t\t\t\t\t<Card className=\"card-main box-shadow\">\r\n\t\t\t\t\t\t<div className=\"video\">\r\n\t\t\t\t\t\t\t<Iframe src={FAKE_IFRAME_VIDEO} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<VideoTabs lession={currentLession} />\r\n\t\t\t\t\t</Card>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"col-md-3 col-12 scrollable\">\r\n\t\t\t\t\t<Card className=\"w-100 card-list box-shadow\" style={{ height: 2000 }}>\r\n\t\t\t\t\t\t<VideoList\r\n\t\t\t\t\t\t\tonPress={(p) => {\r\n\t\t\t\t\t\t\t\tsetCurrentLession(p)\r\n\t\t\t\t\t\t\t\tp.Type === 0 ? setCurrentVideo(p.LinkVideo) : setCurrentVideo(p.LinkHtml)\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tvideos={videos}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</Card>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<Drawer\r\n\t\t\t\ttitle=\"Nội dung khóa học\"\r\n\t\t\t\tplacement=\"right\"\r\n\t\t\t\tonClose={onClose}\r\n\t\t\t\tvisible={visible}\r\n\t\t\t\tclassName=\"video-drawer\"\r\n\t\t\t\theaderStyle={{\r\n\t\t\t\t\tpaddingTop: 24,\r\n\t\t\t\t\tpaddingBottom: 24,\r\n\t\t\t\t\tbackground: '#fff'\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<div className=\"wrap-menu-drawer\">\r\n\t\t\t\t\t<VideoList\r\n\t\t\t\t\t\tonPress={(p) => {\r\n\t\t\t\t\t\t\tsetCurrentLession(p)\r\n\t\t\t\t\t\t\tsetCurrentVideo(p.LinkVideo)\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tvideos={videos}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</Drawer>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport default VideoLearning\r\n"]},"metadata":{},"sourceType":"module"}